# äºŒæ‰‹äº¤æ˜“æ¨¡å—å¼€å‘æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [æ¨¡å—æ¦‚è¿°](#æ¨¡å—æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [æ•°æ®æ¥æº](#æ•°æ®æ¥æº)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [åç«¯å®ç°](#åç«¯å®ç°)
6. [å‰ç«¯å®ç°](#å‰ç«¯å®ç°)
7. [éƒ¨ç½²é…ç½®](#éƒ¨ç½²é…ç½®)
8. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
9. [æ•°æ®åŒæ­¥æœºåˆ¶](#æ•°æ®åŒæ­¥æœºåˆ¶)
10. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## æ¨¡å—æ¦‚è¿°

### åŠŸèƒ½æè¿°
äºŒæ‰‹äº¤æ˜“æ¨¡å—ä¸ºç”¨æˆ·æä¾›è¶Šå—äºŒæ‰‹æ‘©æ‰˜è½¦å’Œæ±½è½¦çš„äº¤æ˜“ä¿¡æ¯å±•ç¤ºå¹³å°ã€‚é€šè¿‡é›†æˆChá»£ Tá»‘tï¼ˆè¶Šå—é¢†å…ˆçš„äºŒæ‰‹äº¤æ˜“å¹³å°ï¼‰çš„å…¬å¼€APIï¼Œè‡ªåŠ¨æŠ“å–å¹¶å±•ç¤ºæœ€æ–°çš„äºŒæ‰‹è½¦è¾†ä¿¡æ¯ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- âœ… è‡ªåŠ¨æŠ“å–Chá»£ Tá»‘tå¹³å°çš„äºŒæ‰‹è½¦è¾†ä¿¡æ¯
- âœ… åªå±•ç¤ºæœ€è¿‘3å‘¨å†…å‘å¸ƒçš„æ–°é²œæ•°æ®
- âœ… **å››ç§è½¦è¾†ç±»å‹ç­›é€‰**ï¼šç‡ƒæ²¹æ‘©æ‰˜è½¦ã€ç”µåŠ¨æ‘©æ‰˜è½¦ã€ç‡ƒæ²¹æ±½è½¦ã€ç”µåŠ¨æ±½è½¦
- âœ… **æ™ºèƒ½åˆ†ç±»ç³»ç»Ÿ**ï¼šåŸºäºå…³é”®è¯è‡ªåŠ¨è¯†åˆ«ç‡ƒæ²¹/ç”µåŠ¨è½¦è¾†
- âœ… **å¹´ä»½æå–åŠŸèƒ½**ï¼šä»æ ‡é¢˜ä¸­æ™ºèƒ½æå–è½¦è¾†å¹´ä»½ä¿¡æ¯
- âœ… æ”¯æŒè½¦è¾†åˆ—è¡¨æµè§ˆå’Œåˆ†é¡µ
- âœ… **æŒ‰å¹´ä»½æ’åº**ï¼šæ”¯æŒæœ€æ–°/æœ€æ—§å¹´ä»½æ’åº
- âœ… æä¾›è¯¦ç»†çš„è½¦è¾†ä¿¡æ¯é¡µé¢ï¼ˆSSRæ¸²æŸ“ï¼‰
- âœ… ä¸€é”®è·³è½¬åˆ°åŸå§‹å¹³å°è”ç³»å–å®¶
- âœ… æ¯æ—¥è‡ªåŠ¨åŒæ­¥æ›´æ–°æ•°æ®
- âœ… **ç°ä»£åŒ–æ¯›ç»ç’ƒUIè®¾è®¡**

### æŠ€æœ¯äº®ç‚¹
- **æ•°æ®æ—¶æ•ˆæ€§**ï¼šåªä¿ç•™æœ€è¿‘3å‘¨çš„æ•°æ®ï¼Œç¡®ä¿ä¿¡æ¯æ–°é²œåº¦
- **SSRæ¸²æŸ“**ï¼šè¯¦æƒ…é¡µé‡‡ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼ŒSEOå‹å¥½
- **æ··åˆæ¸²æŸ“**ï¼šåˆ—è¡¨é¡µé™æ€é¢„æ¸²æŸ“ï¼Œè¯¦æƒ…é¡µåŠ¨æ€æ¸²æŸ“
- **è‡ªåŠ¨åŒ–åŒæ­¥**ï¼šé€šè¿‡å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ›´æ–°æ•°æ®
- **æ™ºèƒ½åˆ†ç±»**ï¼šåŸºäºå…³é”®è¯è‡ªåŠ¨è¯†åˆ«ç‡ƒæ²¹/ç”µåŠ¨è½¦è¾†ç±»å‹
- **å¹´ä»½æå–**ï¼šä»æ ‡é¢˜ä¸­æ™ºèƒ½æå–è½¦è¾†å¹´ä»½ï¼Œæ”¯æŒå¹´ä»½æ’åº
- **æ•°æ®é‡æ–°åˆ†ç±»**ï¼šæ”¯æŒå¯¹ç°æœ‰æ•°æ®è¿›è¡Œæ™ºèƒ½é‡æ–°åˆ†ç±»
- **Cursoré£æ ¼UI**ï¼šæ¯›ç»ç’ƒæ•ˆæœã€ç«‹ä½“æ„Ÿã€é«˜è´¨æ„Ÿè®¾è®¡

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æµè§ˆå™¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx (åå‘ä»£ç†)                           â”‚
â”‚  - é™æ€æ–‡ä»¶æœåŠ¡                                               â”‚
â”‚  - APIè¯·æ±‚ä»£ç†åˆ°åç«¯ (4001)                                   â”‚
â”‚  - SSRè¯·æ±‚ä»£ç†åˆ°AstroæœåŠ¡å™¨ (4321)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                           â”‚
             â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Astro SSR Server      â”‚    â”‚   Node.js Backend API        â”‚
â”‚  (Port 4321)           â”‚    â”‚   (Port 4001)                â”‚
â”‚  - è¯¦æƒ…é¡µåŠ¨æ€æ¸²æŸ“       â”‚    â”‚   - RESTful API              â”‚
â”‚  - åˆ—è¡¨é¡µé™æ€é¢„æ¸²æŸ“     â”‚    â”‚   - æ•°æ®åŒæ­¥æœåŠ¡             â”‚
â”‚  - å››ç§ç±»å‹ç­›é€‰         â”‚    â”‚   - å¤šåˆ†ç±»æ•°æ®æŠ“å–           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                           â”‚
             â”‚                           â–¼
             â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                â”‚   SQLite Database           â”‚
             â”‚                â”‚   - marketplace_vehiclesè¡¨   â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   - vehicle_typeå­—æ®µæ”¯æŒ4ç§  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â–²
                                         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Chá»£ Tá»‘t Public API         â”‚
                              â”‚  - è½¦è¾†åˆ—è¡¨API               â”‚
                              â”‚  - æ‘©æ‰˜è½¦åˆ†ç±»: 2020          â”‚
                              â”‚  - æ±½è½¦åˆ†ç±»: 2010            â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

#### å‰ç«¯
- **æ¡†æ¶**: Astro 5.14.4 (æ··åˆæ¸²æŸ“æ¨¡å¼ - Hybrid)
- **UIåº“**: React 18
- **æ ·å¼**: 
  - CSS Module (MarketplaceList.css)
  - Astro Scoped Styles
  - å…¨å±€æ ·å¼ç³»ç»Ÿ (global.css)
- **é€‚é…å™¨**: @astrojs/node (standaloneæ¨¡å¼)
- **æ¸²æŸ“æ¨¡å¼**: æ··åˆæ¸²æŸ“ (Hybrid Rendering)
  - åˆ—è¡¨é¡µ: é™æ€é¢„æ¸²æŸ“ (prerender: true)
  - è¯¦æƒ…é¡µ: æœåŠ¡ç«¯æ¸²æŸ“ (prerender: false)
- **è®¾è®¡é£æ ¼**: Cursoré£æ ¼ - æ¯›ç»ç’ƒã€æ¸å˜ã€ç«‹ä½“æ„Ÿ

#### åç«¯
- **è¿è¡Œæ—¶**: Node.js 20.x
- **æ¡†æ¶**: Express.js
- **è¯­è¨€**: TypeScript
- **ORM**: Sequelize
- **æ•°æ®åº“**: SQLite
- **HTTPå®¢æˆ·ç«¯**: Axios
- **å®šæ—¶ä»»åŠ¡**: node-cron

---

## æ•°æ®æ¥æº

### Chá»£ Tá»‘t API

#### APIç«¯ç‚¹
```
https://gateway.chotot.com/v1/public/ad-listing
```

**âš ï¸ é‡è¦è¯´æ˜**ï¼š
- Chá»£ Tá»‘t APIä½¿ç”¨HTTPS
- åç«¯åŒæ­¥æ•°æ®æ—¶ç›´æ¥è®¿é—®å¤–éƒ¨APIï¼ˆHTTPSï¼‰
- ä¸å—æœ¬åœ°åŸŸå+SSLé…ç½®å½±å“
- åç«¯è¿è¡Œåœ¨å†…ç½‘HTTPç¯å¢ƒï¼Œä½†å¯ä»¥æ­£å¸¸è¯·æ±‚å¤–éƒ¨HTTPS API

#### è½¦è¾†åˆ†ç±»æ˜ å°„
```typescript
const categories = {
  'moto-gas': '2020',      // ç‡ƒæ²¹æ‘©æ‰˜è½¦
  'moto-electric': '2020', // ç”µåŠ¨æ‘©æ‰˜è½¦ (åŒåˆ†ç±»ï¼Œé€šè¿‡å…¶ä»–å­—æ®µåŒºåˆ†)
  'car-gas': '2010',       // ç‡ƒæ²¹æ±½è½¦
  'car-electric': '2010',  // ç”µåŠ¨æ±½è½¦ (åŒåˆ†ç±»ï¼Œé€šè¿‡å…¶ä»–å­—æ®µåŒºåˆ†)
};
```

#### è¯·æ±‚å‚æ•°
| å‚æ•° | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|------|--------|
| cg | string | åˆ†ç±»ID | 2020 (æ‘©æ‰˜è½¦) / 2010 (æ±½è½¦) |
| st | string | çŠ¶æ€ç±»å‹ | s,k (å‡ºå”®ä¸­) |
| limit | number | è¿”å›æ•°é‡ | 20 |
| o | number | åç§»é‡ | 0 |

#### å“åº”æ•°æ®ç»“æ„
```typescript
interface ChoTotResponse {
  total: number;
  ads: ChoTotAd[];
}

interface ChoTotAd {
  ad_id: number;              // å¹¿å‘ŠID
  subject: string;            // æ ‡é¢˜
  body: string;               // æè¿°
  price: number;              // ä»·æ ¼
  image: string;              // ä¸»å›¾
  images: string[];           // å›¾ç‰‡åˆ—è¡¨
  motorbikebrand?: number;    // å“ç‰ŒID
  regdate?: number;           // æ³¨å†Œå¹´ä»½
  mileage_v2?: number;        // é‡Œç¨‹æ•°
  condition_ad?: number;      // è½¦å†µ
  condition_ad_name?: string; // è½¦å†µæè¿°
  region_name?: string;       // çœ/å¸‚
  area_name?: string;         // åŒº
  ward_name?: string;         // è¡—é“
  full_name?: string;         // å–å®¶å§“å
  account_id?: number;        // å–å®¶ID
  avatar?: string;            // å–å®¶å¤´åƒ
  average_rating?: number;    // å–å®¶è¯„åˆ†
  sold_ads?: number;          // å·²å”®æ•°é‡
  list_time?: number;         // å‘å¸ƒæ—¶é—´(æ¯«ç§’æ—¶é—´æˆ³)
  status?: string;            // çŠ¶æ€
}
```

#### å“ç‰Œæ˜ å°„è¡¨
```typescript
const brands: Record<number, string> = {
  1: 'Honda',
  2: 'Yamaha',
  3: 'Piaggio',
  4: 'Suzuki',
  5: 'SYM',
  6: 'Aprilia',
  9: 'BMW',
  12: 'Ducati',
  17: 'Kawasaki',
  20: 'KTM',
  21: 'Kymco',
};
```

### æ•°æ®è¿‡æ»¤è§„åˆ™

#### æ—¶é—´è¿‡æ»¤
- **è§„åˆ™**: åªä¿ç•™æœ€è¿‘3å‘¨ï¼ˆ21å¤©ï¼‰å†…å‘å¸ƒçš„æ•°æ®
- **å®ç°**: 
  ```typescript
  const threeWeeksAgo = Date.now() - (21 * 24 * 60 * 60 * 1000);
  const recentAds = ads.filter(ad => {
    if (!ad.list_time) return false;
    const adTime = ad.list_time * 1000;
    return adTime >= threeWeeksAgo;
  });
  ```

#### æ•°æ®é‡æ§åˆ¶
- **æ¯æ¬¡åŒæ­¥**: æ¯ç§ç±»å‹50æ¡æ•°æ®
- **APIè¯·æ±‚**: 150æ¡ï¼ˆlimit * 3ï¼‰ï¼Œè¿‡æ»¤åå–å‰50æ¡
- **æ€»æ•°æ®é‡**: 4ç§ç±»å‹ Ã— 50 = 200æ¡
- **åŸå› **: ç¡®ä¿è¿‡æ»¤åæœ‰è¶³å¤Ÿçš„æœ‰æ•ˆæ•°æ®

---

## æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„: marketplace_vehicles

```sql
CREATE TABLE IF NOT EXISTS marketplace_vehicles (
    -- ä¸»é”®å’Œå¤–éƒ¨æ ‡è¯†
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    external_id TEXT UNIQUE NOT NULL,           -- Chá»£ Tá»‘tçš„å¹¿å‘ŠID
    external_url TEXT,                          -- åŸå§‹é“¾æ¥
    source TEXT DEFAULT 'chotot',               -- æ•°æ®æ¥æº
    
    -- è½¦è¾†åˆ†ç±»ä¿¡æ¯ (æ–°å¢)
    type TEXT DEFAULT 'motorcycle',             -- å¤§ç±»: motorcycle/car
    vehicle_type TEXT DEFAULT 'moto-gas',       -- ç»†åˆ†ç±»å‹: moto-gas/moto-electric/car-gas/car-electric
    
    -- è½¦è¾†åŸºæœ¬ä¿¡æ¯
    brand TEXT,                                 -- å“ç‰Œ
    model TEXT,                                 -- å‹å·
    year INTEGER,                               -- å¹´ä»½
    price REAL NOT NULL,                        -- ä»·æ ¼
    title TEXT NOT NULL,                        -- æ ‡é¢˜
    description TEXT,                           -- æè¿°
    mileage INTEGER,                            -- é‡Œç¨‹æ•°
    
    -- è½¦å†µä¿¡æ¯
    condition_text TEXT,                        -- è½¦å†µæè¿°
    condition_rating INTEGER,                   -- è½¦å†µè¯„åˆ†(1-5)
    
    -- å›¾ç‰‡ä¿¡æ¯
    image_url TEXT,                             -- ä¸»å›¾URL
    images TEXT,                                -- å›¾ç‰‡åˆ—è¡¨(JSONå­—ç¬¦ä¸²)
    
    -- ä½ç½®ä¿¡æ¯
    city TEXT,                                  -- åŸå¸‚
    district TEXT,                              -- åŒº
    ward TEXT,                                  -- è¡—é“
    location TEXT,                              -- åæ ‡
    
    -- å–å®¶ä¿¡æ¯
    seller_name TEXT,                           -- å–å®¶å§“å
    seller_id TEXT,                             -- å–å®¶ID
    seller_avatar TEXT,                         -- å–å®¶å¤´åƒ
    seller_phone TEXT,                          -- å–å®¶ç”µè¯
    seller_rating REAL,                         -- å–å®¶è¯„åˆ†
    seller_sold_count INTEGER DEFAULT 0,        -- å·²å”®æ•°é‡
    
    -- ç»Ÿè®¡ä¿¡æ¯
    view_count INTEGER DEFAULT 0,               -- æµè§ˆæ¬¡æ•°
    favorites_count INTEGER DEFAULT 0,          -- æ”¶è—æ¬¡æ•°
    
    -- çŠ¶æ€å’Œæ ‡è®°
    status TEXT DEFAULT 'active',               -- çŠ¶æ€: active/inactive
    is_featured BOOLEAN DEFAULT 0,              -- æ˜¯å¦ç²¾é€‰
    
    -- æ—¶é—´æˆ³
    published_at DATETIME,                      -- å‘å¸ƒæ—¶é—´
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_marketplace_external_id ON marketplace_vehicles(external_id);
CREATE INDEX IF NOT EXISTS idx_marketplace_status ON marketplace_vehicles(status);
CREATE INDEX IF NOT EXISTS idx_marketplace_published_at ON marketplace_vehicles(published_at);
CREATE INDEX IF NOT EXISTS idx_marketplace_vehicle_type ON marketplace_vehicles(vehicle_type);  -- æ–°å¢
CREATE INDEX IF NOT EXISTS idx_marketplace_brand ON marketplace_vehicles(brand);
CREATE INDEX IF NOT EXISTS idx_marketplace_city ON marketplace_vehicles(city);
```

### å…³é”®å­—æ®µè¯´æ˜

#### vehicle_typeï¼ˆæ–°å¢æ ¸å¿ƒå­—æ®µï¼‰
- **ç±»å‹**: TEXT
- **ä½œç”¨**: åŒºåˆ†å››ç§è½¦è¾†ç±»å‹
- **å¯é€‰å€¼**:
  - `moto-gas`: ç‡ƒæ²¹æ‘©æ‰˜è½¦
  - `moto-electric`: ç”µåŠ¨æ‘©æ‰˜è½¦
  - `car-gas`: ç‡ƒæ²¹æ±½è½¦
  - `car-electric`: ç”µåŠ¨æ±½è½¦
- **ç”¨é€”**: å‰ç«¯ç­›é€‰æ ‡ç­¾çš„æ•°æ®æº

#### å…¶ä»–å…³é”®å­—æ®µ
- **external_id**: Chá»£ Tá»‘tçš„å¹¿å‘ŠIDï¼Œç”¨äºå»é‡å’Œæ›´æ–°
- **images**: JSONå­—ç¬¦ä¸²ï¼Œå­˜å‚¨å¤šå¼ å›¾ç‰‡URL
- **seller_phone**: å–å®¶ç”µè¯ä¿¡æ¯
- **published_at**: ç”¨äºæ—¶é—´è¿‡æ»¤ï¼Œåªä¿ç•™æœ€è¿‘3å‘¨çš„æ•°æ®

---

## åç«¯å®ç°

### ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ MarketplaceVehicle.ts          # Sequelizeæ¨¡å‹ (å«vehicle_typeå­—æ®µ)
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ ChoTotService.ts               # Chá»£ Tá»‘t APIæœåŠ¡ (æ”¯æŒ4ç§ç±»å‹)
â”‚   â”‚   â””â”€â”€ MarketplaceScheduler.ts        # å®šæ—¶åŒæ­¥ä»»åŠ¡
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ marketplace.ts                 # APIè·¯ç”± (æ”¯æŒvehicle_typeç­›é€‰)
â”‚   â””â”€â”€ index.ts                           # ä¸»å…¥å£
â”œâ”€â”€ database/
â”‚   â””â”€â”€ init-marketplace-table.sql         # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â””â”€â”€ package.json
```

### æ ¸å¿ƒæœåŠ¡: ChoTotService.ts

#### ä¸»è¦åŠŸèƒ½
1. **å¤šç±»å‹æ•°æ®æŠ“å–**: æ”¯æŒ4ç§è½¦è¾†ç±»å‹çš„ç‹¬ç«‹æŠ“å–
2. **æ™ºèƒ½åˆ†ç±»ç³»ç»Ÿ**: åŸºäºå…³é”®è¯è‡ªåŠ¨è¯†åˆ«ç‡ƒæ²¹/ç”µåŠ¨è½¦è¾†
3. **å¹´ä»½æå–åŠŸèƒ½**: ä»æ ‡é¢˜ä¸­æ™ºèƒ½æå–è½¦è¾†å¹´ä»½ä¿¡æ¯
4. **æ•°æ®è¿‡æ»¤**: åªä¿ç•™æœ€è¿‘3å‘¨çš„æ•°æ®
5. **æ•°æ®è½¬æ¢**: å°†APIæ•°æ®è½¬æ¢ä¸ºæ•°æ®åº“æ¨¡å‹
6. **æ•°æ®ä¿å­˜**: ä½¿ç”¨upserté¿å…é‡å¤
7. **æ•°æ®é‡æ–°åˆ†ç±»**: æ”¯æŒå¯¹ç°æœ‰æ•°æ®è¿›è¡Œæ™ºèƒ½é‡æ–°åˆ†ç±»

#### å…³é”®ä»£ç 

```typescript
class ChoTotService {
  private baseUrl = 'https://gateway.chotot.com/v1/public/ad-listing';
  
  // åˆ†ç±»IDæ˜ å°„
  private categories = {
    'moto-gas': '2020',      // ç‡ƒæ²¹æ‘©æ‰˜è½¦
    'moto-electric': '2020', // ç”µåŠ¨æ‘©æ‰˜è½¦
    'car-gas': '2010',       // ç‡ƒæ²¹æ±½è½¦
    'car-electric': '2010',  // ç”µåŠ¨æ±½è½¦
  };
  
  /**
   * è·å–è½¦è¾†åˆ—è¡¨ï¼ˆåªè·å–æœ€è¿‘3å‘¨çš„æ•°æ®ï¼‰
   * @param vehicleType - è½¦è¾†ç±»å‹
   * @param limit - éœ€è¦çš„æ•°é‡
   */
  async fetchVehicles(vehicleType: string, limit: number = 50): Promise<ChoTotAd[]> {
    const category = this.categories[vehicleType] || '2020';
    
    const response = await axios.get(this.baseUrl, {
      params: {
        cg: category,
        st: 's,k',
        limit: limit * 3, // å¤šè·å–ä»¥ç¡®ä¿è¿‡æ»¤åæœ‰è¶³å¤Ÿæ•°æ®
        o: 0,
      },
      headers: {
        'User-Agent': 'Mozilla/5.0...',
        'Accept': 'application/json',
      },
      timeout: 15000,
    });
    
    // æ—¶é—´è¿‡æ»¤
    const threeWeeksAgo = Date.now() - (21 * 24 * 60 * 60 * 1000);
    const recentAds = response.data.ads.filter(ad => {
      if (!ad.list_time) return false;
      const adTime = ad.list_time * 1000;
      return adTime >= threeWeeksAgo;
    }).slice(0, limit);
    
    return recentAds;
  }
  
  /**
   * ä»æ ‡é¢˜ä¸­æå–å¹´ä»½
   * @param title - è½¦è¾†æ ‡é¢˜
   * @returns æå–åˆ°çš„å¹´ä»½ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›null
   */
  private extractYearFromTitle(title: string): number | null {
    if (!title) return null;
    
    // åŒ¹é…4ä½æ•°å­—å¹´ä»½ (1990-2030)
    const yearMatch = title.match(/\b(19[9]\d|20[0-2]\d|2030)\b/);
    if (yearMatch) {
      const year = parseInt(yearMatch[1]);
      if (year >= 1990 && year <= 2030) {
        return year;
      }
    }
    
    return null;
  }
  
  /**
   * æ™ºèƒ½åˆ¤æ–­è½¦è¾†ç±»å‹ï¼ˆç‡ƒæ²¹ vs ç”µåŠ¨ï¼‰
   * @param ad - å¹¿å‘Šæ•°æ®
   * @param requestedType - è¯·æ±‚çš„ç±»å‹
   * @returns å®é™…åº”è¯¥åˆ†ç±»çš„ç±»å‹
   */
  private determineVehicleType(ad: ChoTotAd, requestedType: string): string {
    const title = (ad.subject || '').toLowerCase();
    const description = (ad.body || '').toLowerCase();
    const text = `${title} ${description}`;
    
    // ç”µåŠ¨å…³é”®è¯
    const electricKeywords = [
      'Ä‘iá»‡n', 'electric', 'e-', 'ev', 'xe Ä‘iá»‡n', 'xe mÃ¡y Ä‘iá»‡n', 'Ã´ tÃ´ Ä‘iá»‡n',
      'pin', 'battery', 'sáº¡c', 'charging', 'hybrid', 'hÃ­brido'
    ];
    
    // ç‡ƒæ²¹å…³é”®è¯
    const gasKeywords = [
      'xÄƒng', 'gas', 'petrol', 'diesel', 'dáº§u', 'nhiÃªn liá»‡u', 'Ä‘á»™ng cÆ¡',
      'mÃ¡y', 'engine', 'cc', 'cm3', 'phÃ¢n khá»‘i'
    ];
    
    const hasElectricKeywords = electricKeywords.some(keyword => 
      text.includes(keyword.toLowerCase())
    );
    const hasGasKeywords = gasKeywords.some(keyword => 
      text.includes(keyword.toLowerCase())
    );
    
    // æ ¹æ®è¯·æ±‚ç±»å‹å’Œå…³é”®è¯åˆ¤æ–­
    if (requestedType.startsWith('moto')) {
      if (hasElectricKeywords && !hasGasKeywords) {
        return 'moto-electric';
      } else if (hasGasKeywords && !hasElectricKeywords) {
        return 'moto-gas';
      } else {
        return requestedType;
      }
    } else if (requestedType.startsWith('car')) {
      if (hasElectricKeywords && !hasGasKeywords) {
        return 'car-electric';
      } else if (hasGasKeywords && !hasElectricKeywords) {
        return 'car-gas';
      } else {
        return requestedType;
      }
    }
    
    return requestedType;
  }
  
  /**
   * ä¿å­˜åˆ°æ•°æ®åº“
   */
  async saveToDatabase(ads: ChoTotAd[], vehicleType: string): Promise<number> {
    let savedCount = 0;
    
    for (const ad of ads) {
      // æ™ºèƒ½åˆ¤æ–­å®é™…è½¦è¾†ç±»å‹
      const actualVehicleType = this.determineVehicleType(ad, vehicleType);
      const isMotorcycle = actualVehicleType.startsWith('moto');
      
      // ä»æ ‡é¢˜ä¸­æå–å¹´ä»½
      const extractedYear = this.extractYearFromTitle(ad.subject);
      const finalYear = ad.regdate || extractedYear || undefined;
      
      console.log(`ğŸ” è½¦è¾†åˆ†ç±»: ${ad.subject} -> ${vehicleType} -> ${actualVehicleType}, å¹´ä»½: ${finalYear}`);
      
      const data = {
        external_id: ad.ad_id.toString(),
        external_url: `https://xe.chotot.com/${ad.ad_id}`,
        type: isMotorcycle ? 'motorcycle' : 'car',
        vehicle_type: actualVehicleType, // ä½¿ç”¨æ™ºèƒ½åˆ¤æ–­çš„ç»“æœ
        brand: this.getBrandName(ad.motorbikebrand),
        year: finalYear, // ä½¿ç”¨æå–çš„å¹´ä»½
        price: ad.price,
        title: ad.subject,
        description: ad.body,
        mileage: ad.mileage_v2,
        condition_text: ad.condition_ad_name,
        image_url: ad.image,
        images: JSON.stringify(ad.images || []),
        city: ad.region_name,
        district: ad.area_name,
        seller_name: ad.full_name,
        seller_rating: ad.average_rating,
        published_at: new Date(ad.list_time),
        // ... å…¶ä»–å­—æ®µ
      };
      
      await MarketplaceVehicle.upsert(data);
      savedCount++;
      
      // å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
      await new Promise(resolve => setTimeout(resolve, 500));
    }
    
    return savedCount;
  }
  
  /**
   * é‡æ–°åˆ†ç±»ç°æœ‰æ•°æ®
   */
  async reclassifyExistingData(): Promise<{ processed: number; updated: number }> {
    console.log('\nğŸ”„ å¼€å§‹é‡æ–°åˆ†ç±»ç°æœ‰æ•°æ®...');
    const vehicles = await MarketplaceVehicle.findAll({
      where: { status: 'active' },
      attributes: ['id', 'title', 'description', 'vehicle_type', 'external_id']
    });
    
    let processed = 0;
    let updated = 0;
    
    for (const vehicle of vehicles) {
      try {
        const ad: ChoTotAd = {
          ad_id: parseInt(vehicle.external_id),
          subject: vehicle.title,
          body: vehicle.description || '',
          price: 0,
          image: '',
          images: [],
        };
        
        // æ™ºèƒ½åˆ¤æ–­æ­£ç¡®çš„ç±»å‹
        const correctType = this.determineVehicleType(ad, vehicle.vehicle_type);
        
        // ä»æ ‡é¢˜ä¸­æå–å¹´ä»½
        const extractedYear = this.extractYearFromTitle(vehicle.title);
        const finalYear = vehicle.year || extractedYear || undefined;
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°
        const needsUpdate = correctType !== vehicle.vehicle_type || finalYear !== vehicle.year;
        
        if (needsUpdate) {
          const updateData: any = {};
          if (correctType !== vehicle.vehicle_type) {
            updateData.vehicle_type = correctType;
          }
          if (finalYear !== vehicle.year) {
            updateData.year = finalYear;
          }
          
          await vehicle.update(updateData);
          console.log(`âœ… é‡æ–°åˆ†ç±»: ${vehicle.title} -> ${vehicle.vehicle_type} -> ${correctType}, å¹´ä»½: ${vehicle.year} -> ${finalYear}`);
          updated++;
        }
        
        processed++;
      } catch (error: any) {
        console.error(`âŒ é‡æ–°åˆ†ç±»å¤±è´¥ ${vehicle.id}:`, error.message);
      }
    }
    
    console.log(`\nğŸ“Š é‡æ–°åˆ†ç±»å®Œæˆ: å¤„ç† ${processed} æ¡, æ›´æ–° ${updated} æ¡\n`);
    return { processed, updated };
  }
  
  /**
   * åŒæ­¥æ‰€æœ‰åˆ†ç±»çš„æ•°æ®
   */
  async fetchAndSaveAll(limitPerType: number = 50): Promise<Record<string, any>> {
    const types = ['moto-gas', 'moto-electric', 'car-gas', 'car-electric'];
    const results: Record<string, any> = {};
    
    for (const type of types) {
      results[type] = await this.fetchAndSaveByType(type, limitPerType);
      // åˆ†ç±»ä¹‹é—´å»¶è¿Ÿ
      await new Promise(resolve => setTimeout(resolve, 2000));
    }
    
    return results;
  }
}
```

### APIè·¯ç”±: marketplace.ts

#### ç«¯ç‚¹åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/marketplace` | è·å–è½¦è¾†åˆ—è¡¨(åˆ†é¡µã€ç­›é€‰ã€æ’åº) |
| GET | `/api/marketplace/:id` | è·å–è½¦è¾†è¯¦æƒ… |
| POST | `/api/marketplace/sync` | æ‰‹åŠ¨è§¦å‘åŒæ­¥ |
| POST | `/api/marketplace/reclassify` | é‡æ–°åˆ†ç±»ç°æœ‰æ•°æ® |
| GET | `/api/marketplace/stats/summary` | è·å–ç»Ÿè®¡ä¿¡æ¯ |

#### ç­›é€‰æ”¯æŒ

```typescript
router.get('/', async (req: Request, res: Response) => {
  const {
    page = '1',
    limit = '12',
    vehicle_type, // å…³é”®ï¼šæ”¯æŒvehicle_typeç­›é€‰
    brand,
    minPrice,
    maxPrice,
    city,
    sort = 'year_desc', // é»˜è®¤æŒ‰å¹´ä»½æœ€æ–°æ’åº
  } = req.query;
  
  const where: any = { status: 'active' };
  
  // æŒ‰vehicle_typeç­›é€‰
  if (vehicle_type) {
    where.vehicle_type = vehicle_type; // moto-gas, moto-electricç­‰
  }
  
  if (brand) where.brand = brand;
  if (minPrice || maxPrice) where.price = { /* ä»·æ ¼èŒƒå›´ */ };
  
  // æ’åº - é»˜è®¤æŒ‰å¹´ä»½æœ€æ–°æ’åºï¼Œå¹´ä»½ä¸ºç©ºæ—¶æŒ‰å‘å¸ƒæ—¶é—´æ’åº
  let order: any[] = [
    ['year', 'DESC NULLS LAST'], // å¹´ä»½æœ€æ–°ï¼Œç©ºå€¼æ’åœ¨æœ€å
    ['published_at', 'DESC']      // å‘å¸ƒæ—¶é—´æœ€æ–°
  ];
  if (sort === 'price_asc') order = [['price', 'ASC']];
  if (sort === 'price_desc') order = [['price', 'DESC']];
  if (sort === 'popular') order = [['view_count', 'DESC']];
  if (sort === 'year_desc') order = [['year', 'DESC NULLS LAST'], ['published_at', 'DESC']]; // å¹´ä»½æœ€æ–°
  if (sort === 'year_asc') order = [['year', 'ASC NULLS LAST'], ['published_at', 'DESC']]; // å¹´ä»½æœ€æ—§
  if (sort === 'latest') order = [['published_at', 'DESC']]; // æœ€æ–°å‘å¸ƒ
  
  const { rows, count } = await MarketplaceVehicle.findAndCountAll({
    where,
    order,
    limit: parseInt(limit),
    offset: (parseInt(page) - 1) * parseInt(limit),
  });
  
  res.json({
    success: true,
    data: rows,
    pagination: { /* ... */ },
  });
});
```

---

## å‰ç«¯å®ç°

### ç›®å½•ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ marketplace/
â”‚   â”‚       â”œâ”€â”€ index.astro              # åˆ—è¡¨é¡µ(é™æ€é¢„æ¸²æŸ“)
â”‚   â”‚       â””â”€â”€ [id].astro               # è¯¦æƒ…é¡µ(SSR)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ MarketplaceList.tsx          # åˆ—è¡¨ç»„ä»¶ (æ”¯æŒ4ç§ç±»å‹ç­›é€‰)
â”‚   â”‚   â””â”€â”€ MarketplaceList.css          # ç»„ä»¶æ ·å¼ (æ¯›ç»ç’ƒæ•ˆæœ)
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ marketplaceApi.ts            # APIè°ƒç”¨å°è£…
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ global.css                   # å…¨å±€æ ·å¼ç³»ç»Ÿ
â””â”€â”€ astro.config.mjs                     # Astroé…ç½®
```

### åˆ—è¡¨é¡µ: marketplace/index.astro

#### ç‰¹ç‚¹
- **é™æ€é¢„æ¸²æŸ“**: æ„å»ºæ—¶ç”ŸæˆHTML
- **å®¢æˆ·ç«¯äº¤äº’**: Reactç»„ä»¶å¤„ç†ç­›é€‰å’Œåˆ†é¡µ
- **SEOå‹å¥½**: å®Œæ•´çš„HTMLç»“æ„
- **ç°ä»£åŒ–UI**: HeroåŒºåŸŸ + ç­›é€‰æ ‡ç­¾

#### ä»£ç ç»“æ„

```astro
---
export const prerender = true; // é¢„æ¸²æŸ“ä¸ºé™æ€é¡µé¢

import BaseLayout from '../../layouts/BaseLayout.astro';
import MarketplaceList from '../../components/MarketplaceList';
---

<BaseLayout 
  title="Mua BÃ¡n Xe MÃ¡y CÅ© - Vietnam Moto & Auto"
  description="TÃ¬m kiáº¿m vÃ  mua bÃ¡n xe mÃ¡y cÅ© giÃ¡ tá»‘t táº¡i Viá»‡t Nam."
>
  <!-- Hero Section -->
  <section class="marketplace-hero">
    <div class="container-fluid">
      <div class="hero-content">
        <h1 class="hero-title">ğŸï¸ Chá»£ Xe CÅ©</h1>
        <p class="hero-description">
          TÃ¬m kiáº¿m xe cÅ© cháº¥t lÆ°á»£ng vá»›i giÃ¡ tá»‘t nháº¥t. 
          Dá»¯ liá»‡u Ä‘Æ°á»£c cáº­p nháº­t tá»± Ä‘á»™ng tá»« Chá»£ Tá»‘t.
        </p>
      </div>
    </div>
  </section>

  <!-- Marketplace List with Tabs -->
  <section style="padding: 0 0 var(--spacing-4xl) 0;">
    <div class="container-fluid">
      <MarketplaceList client:load />
    </div>
  </section>
</BaseLayout>

<style>
  .marketplace-hero {
    padding: var(--spacing-3xl) 0 var(--spacing-2xl) 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-bottom: 1px solid var(--glass-border);
  }
  
  .hero-title {
    font-size: 3rem;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  /* ... æ›´å¤šæ ·å¼ */
</style>
```

### åˆ—è¡¨ç»„ä»¶: MarketplaceList.tsx

#### æ ¸å¿ƒåŠŸèƒ½
- **å››ç§ç±»å‹ç­›é€‰æ ‡ç­¾**: ç‡ƒæ²¹æ‘©æ‰˜è½¦ã€ç”µåŠ¨æ‘©æ‰˜è½¦ã€ç‡ƒæ²¹æ±½è½¦ã€ç”µåŠ¨æ±½è½¦
- **åŠ¨æ€æ•°æ®åŠ è½½**: æ ¹æ®é€‰ä¸­çš„æ ‡ç­¾åŠ¨æ€è·å–æ•°æ®
- **åˆ†é¡µæ”¯æŒ**: ç¿»é¡µåŠŸèƒ½
- **å“åº”å¼å¸ƒå±€**: è‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸

#### å…³é”®ä»£ç 

```typescript
import { useState, useEffect } from 'react';
import { getMarketplaceList, formatPrice } from '../services/marketplaceApi';
import './MarketplaceList.css'; // å¯¼å…¥æ ·å¼

type VehicleType = 'moto-gas' | 'moto-electric' | 'car-gas' | 'car-electric';

export default function MarketplaceList() {
  const [vehicles, setVehicles] = useState<MarketplaceVehicle[]>([]);
  const [loading, setLoading] = useState(true);
  const [page, setPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [activeTab, setActiveTab] = useState<VehicleType>('moto-gas');

  useEffect(() => {
    fetchVehicles();
  }, [page, activeTab]);

  const fetchVehicles = async () => {
    setLoading(true);
    const response = await getMarketplaceList({ 
      page, 
      limit: 12,
      vehicle_type: activeTab  // å…³é”®ï¼šæŒ‰ç±»å‹ç­›é€‰
    });
    setVehicles(response.data);
    setTotalPages(response.pagination.totalPages);
    setLoading(false);
  };

  const handleTabChange = (tab: VehicleType) => {
    setActiveTab(tab);
    setPage(1); // åˆ‡æ¢æ ‡ç­¾æ—¶é‡ç½®é¡µç 
  };

  return (
    <div className="marketplace-container">
      {/* å››ä¸ªç­›é€‰æ ‡ç­¾ */}
      <div className="vehicle-tabs">
        <button
          className={`tab-button ${activeTab === 'moto-gas' ? 'active' : ''}`}
          onClick={() => handleTabChange('moto-gas')}
        >
          ğŸï¸ Xe mÃ¡y xÄƒng
        </button>
        <button
          className={`tab-button ${activeTab === 'moto-electric' ? 'active' : ''}`}
          onClick={() => handleTabChange('moto-electric')}
        >
          âš¡ Xe mÃ¡y Ä‘iá»‡n
        </button>
        <button
          className={`tab-button ${activeTab === 'car-gas' ? 'active' : ''}`}
          onClick={() => handleTabChange('car-gas')}
        >
          ğŸš— Ã” tÃ´ xÄƒng
        </button>
        <button
          className={`tab-button ${activeTab === 'car-electric' ? 'active' : ''}`}
          onClick={() => handleTabChange('car-electric')}
        >
          ğŸ”‹ Ã” tÃ´ Ä‘iá»‡n
        </button>
      </div>

      {/* è½¦è¾†åˆ—è¡¨ */}
      <div className="marketplace-grid">
        {vehicles.map((vehicle) => (
          <a 
            key={vehicle.id} 
            href={`/marketplace/${vehicle.id}`}
            className="marketplace-card"
          >
            <div className="card-image-wrapper">
              <img src={vehicle.image_url} alt={vehicle.title} />
              {vehicle.condition_text && (
                <span className="condition-badge">
                  {vehicle.condition_text}
                </span>
              )}
            </div>
            
            <div className="card-content">
              <h3 className="card-title">{vehicle.title}</h3>
              <div className="card-price">{formatPrice(vehicle.price)}</div>
              <div className="card-location">
                ğŸ“ {vehicle.district}, {vehicle.city}
              </div>
              {/* ... æ›´å¤šä¿¡æ¯ */}
            </div>
          </a>
        ))}
      </div>

      {/* åˆ†é¡µ */}
      <div className="pagination">
        <button onClick={() => setPage(p => Math.max(1, p - 1))}>
          â† Trang trÆ°á»›c
        </button>
        <span>Trang {page} / {totalPages}</span>
        <button onClick={() => setPage(p => Math.min(totalPages, p + 1))}>
          Trang sau â†’
        </button>
      </div>
    </div>
  );
}
```

### ç»„ä»¶æ ·å¼: MarketplaceList.css

#### è®¾è®¡ç‰¹è‰²
- **æ¯›ç»ç’ƒæ•ˆæœ**: backdrop-filter + åŠé€æ˜èƒŒæ™¯
- **æ¸å˜é«˜äº®**: ç´«è“æ¸å˜ä½œä¸ºä¸»é¢˜è‰²
- **ç«‹ä½“æ‚¬æµ®**: 3Då˜æ¢å’Œé˜´å½±
- **å“åº”å¼å¸ƒå±€**: æ¡Œé¢4åˆ—ã€å¹³æ¿2åˆ—ã€æ‰‹æœº1åˆ—

#### æ ¸å¿ƒæ ·å¼

```css
/* ç­›é€‰æ ‡ç­¾ - æ¯›ç»ç’ƒæ•ˆæœ */
.vehicle-tabs {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-3xl);
}

.tab-button {
  position: relative;
  padding: var(--spacing-xl) var(--spacing-lg);
  background: var(--glass-bg);                    /* åŠé€æ˜èƒŒæ™¯ */
  border: 2px solid var(--glass-border);
  border-radius: var(--radius-xl);
  color: var(--text-primary);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(10px);                    /* æ¯›ç»ç’ƒæ¨¡ç³Š */
  overflow: hidden;
}

/* æ¸å˜å åŠ å±‚ */
.tab-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
  opacity: 0;
  transition: opacity 0.4s ease;
}

.tab-button:hover::before {
  opacity: 1;
}

/* æ‚¬æµ®æ•ˆæœ */
.tab-button:hover {
  border-color: rgba(102, 126, 234, 0.5);
  transform: translateY(-4px);                    /* ä¸Šæµ® */
  box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
}

/* æ¿€æ´»çŠ¶æ€ - ç´«è“æ¸å˜ */
.tab-button.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: transparent;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(102, 126, 234, 0.5);
}

/* å“åº”å¼å¸ƒå±€ */
@media (max-width: 968px) {
  .vehicle-tabs {
    grid-template-columns: repeat(2, 1fr);        /* å¹³æ¿ï¼š2åˆ— */
  }
}

@media (max-width: 480px) {
  .vehicle-tabs {
    grid-template-columns: 1fr;                   /* æ‰‹æœºï¼š1åˆ— */
  }
}
```

### APIæœåŠ¡: marketplaceApi.ts

#### å°è£…çš„APIå‡½æ•°

**âš ï¸ ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆåŸŸå+SSLï¼‰**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆåŸŸå+SSLç¯å¢ƒï¼‰
const API_BASE_URL = '/api';

// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç HTTPåœ°å€
// const API_BASE_URL = 'http://47.237.79.9:4001/api';
// const API_BASE_URL = import.meta.env.PUBLIC_API_URL || 'http://...';

/**
 * è·å–äºŒæ‰‹è½¦è¾†åˆ—è¡¨
 * @param params.vehicle_type - è½¦è¾†ç±»å‹ç­›é€‰
 */
export async function getMarketplaceList(params: {
  page?: number;
  limit?: number;
  vehicle_type?: string; // moto-gas | moto-electric | car-gas | car-electric
  brand?: string;
  minPrice?: number;
  maxPrice?: number;
  city?: string;
} = {}): Promise<MarketplaceListResponse> {
  // API_BASE_URL = '/api' - ç›¸å¯¹è·¯å¾„ï¼Œè‡ªåŠ¨é€šè¿‡Nginxä»£ç†ä¸ºHTTPS
  const response = await axios.get(`${API_BASE_URL}/marketplace`, { params });
  return response.data;
}

/**
 * æ ¼å¼åŒ–ä»·æ ¼ï¼ˆè¶Šå—ç›¾ï¼‰
 */
export function formatPrice(price: number): string {
  return new Intl.NumberFormat('vi-VN', {
    style: 'currency',
    currency: 'VND',
    maximumFractionDigits: 0,
  }).format(price);
}

/**
 * æ ¼å¼åŒ–é‡Œç¨‹æ•°
 */
export function formatMileage(mileage?: number): string {
  if (!mileage) return 'ChÆ°a rÃµ';
  if (mileage < 1000) return `${mileage} km`;
  return `${(mileage / 1000).toFixed(1)} nghÃ¬n km`;
}

/**
 * æ ¼å¼åŒ–æ—¶é—´
 */
export function formatDate(dateString: string): string {
  const date = new Date(dateString);
  const now = new Date();
  const diff = now.getTime() - date.getTime();
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  
  if (days === 0) return 'HÃ´m nay';
  if (days === 1) return 'HÃ´m qua';
  if (days < 7) return `${days} ngÃ y trÆ°á»›c`;
  
  return date.toLocaleDateString('vi-VN');
}
```

---

## éƒ¨ç½²é…ç½®

### SystemdæœåŠ¡é…ç½®

#### åç«¯æœåŠ¡: vietnam-moto-backend.service

```ini
[Unit]
Description=Vietnam Moto Auto Backend Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/var/www/vietnam-moto-auto/backend
Environment=NODE_ENV=production
Environment=PORT=4001
ExecStart=/usr/bin/node dist/index.js
Restart=always
RestartSec=10
StandardOutput=append:/var/www/vietnam-moto-auto/backend/logs/backend.log
StandardError=append:/var/www/vietnam-moto-auto/backend/logs/backend-error.log

[Install]
WantedBy=multi-user.target
```

#### å‰ç«¯æœåŠ¡: vietnam-moto-frontend.service

```ini
[Unit]
Description=Vietnam Moto Auto Frontend Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/var/www/vietnam-moto-auto/frontend
Environment=NODE_ENV=production
Environment=PORT=4321
Environment=HOST=0.0.0.0
ExecStart=/usr/bin/node dist/server/entry.mjs
Restart=always
RestartSec=10
StandardOutput=append:/var/www/vietnam-moto-auto/frontend/logs/frontend.log
StandardError=append:/var/www/vietnam-moto-auto/frontend/logs/frontend-error.log

[Install]
WantedBy=multi-user.target
```

### Nginxé…ç½®

**âš ï¸ ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆåŸŸå+SSLï¼‰**ï¼š

```nginx
# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name vietmoto.top;
    return 301 https://$server_name$request_uri;
}

# HTTPSä¸»é…ç½®
server {
    listen 443 ssl http2;
    server_name vietmoto.top;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/vietmoto.top/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/vietmoto.top/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    
    # å®‰å…¨å¤´
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_types text/plain text/css application/json application/javascript text/xml;
    
    # Astro SSR å‰ç«¯ï¼ˆä¸»è¦å…¥å£ï¼‰
    location / {
        proxy_pass http://127.0.0.1:4321;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # API ä»£ç†åˆ°åç«¯ï¼ˆå…³é”®é…ç½®ï¼‰
    location /api/ {
        proxy_pass http://127.0.0.1:4001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 300s;
    }
}
```

**é…ç½®è¯´æ˜**ï¼š
1. **SSLè¯ä¹¦**ï¼šä½¿ç”¨Let's Encryptè‡ªåŠ¨ç»­æœŸ
2. **HTTPSå¼ºåˆ¶**ï¼šHTTPè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
3. **å‰ç«¯SSR**ï¼šæ‰€æœ‰è¯·æ±‚å…ˆç”±Astro SSRå¤„ç†
4. **APIä»£ç†**ï¼š`/api/` è¯·æ±‚ä»£ç†åˆ°åç«¯4001ç«¯å£
5. **å®‰å…¨å¤´**ï¼šHSTSã€X-Frame-Optionsç­‰
6. **æ€§èƒ½ä¼˜åŒ–**ï¼šGzipå‹ç¼©ã€HTTP/2

**è¯·æ±‚æµç¨‹**ï¼š
```
ç”¨æˆ·æµè§ˆå™¨ (HTTPS)
  â†“
https://vietmoto.top/api/marketplace
  â†“
Nginx (443ç«¯å£ï¼ŒSSLåŠ å¯†)
  â†“
proxy_pass (å†…ç½‘è½¬å‘)
  â†“
http://127.0.0.1:4001/api/marketplace (åç«¯HTTPï¼Œå†…ç½‘)
  â†“
SQLiteæ•°æ®åº“ (æœ¬åœ°æ–‡ä»¶)
```

### å¿«é€Ÿéƒ¨ç½²è„šæœ¬

#### quick-deploy.sh

```bash
#!/bin/bash

# å‰ç«¯éƒ¨ç½²
if [ "$1" = "frontend" ]; then
    cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend
    npm run build
    cp -r dist /var/www/vietnam-moto-auto/frontend/
    systemctl restart vietnam-moto-frontend
    echo "âœ… å‰ç«¯éƒ¨ç½²å®Œæˆ"
fi

# åç«¯éƒ¨ç½²
if [ "$1" = "backend" ]; then
    cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backend
    npm run build
    cp -r dist /var/www/vietnam-moto-auto/backend/
    systemctl restart vietnam-moto-backend
    echo "âœ… åç«¯éƒ¨ç½²å®Œæˆ"
fi
```

---

## APIæ¥å£æ–‡æ¡£

### 1. è·å–è½¦è¾†åˆ—è¡¨ï¼ˆæ”¯æŒç±»å‹ç­›é€‰ï¼‰

**è¯·æ±‚**

**å¼€å‘ç¯å¢ƒ**ï¼š
```bash
curl http://localhost:4001/api/marketplace?vehicle_type=moto-gas&page=1&limit=12
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰**ï¼š
```bash
# é€šè¿‡åŸŸåè®¿é—®ï¼ˆæ¨èï¼‰
curl https://vietmoto.top/api/marketplace?vehicle_type=moto-gas&page=1&limit=12

# å‰ç«¯è°ƒç”¨ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
GET /api/marketplace?vehicle_type=moto-gas&page=1&limit=12
```

**å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|------|------|--------|
| vehicle_type | string | å¦ | è½¦è¾†ç±»å‹ç­›é€‰ | moto-gas, moto-electric, car-gas, car-electric |
| page | number | å¦ | é¡µç  | 1 |
| limit | number | å¦ | æ¯é¡µæ•°é‡ | 12 |
| brand | string | å¦ | å“ç‰Œç­›é€‰ | Honda |
| minPrice | number | å¦ | æœ€ä½ä»·æ ¼ | 10000000 |
| maxPrice | number | å¦ | æœ€é«˜ä»·æ ¼ | 50000000 |
| city | string | å¦ | åŸå¸‚ç­›é€‰ | HÃ  Ná»™i |
| sort | string | å¦ | æ’åºæ–¹å¼ | year_desc, year_asc, price_asc, price_desc, popular, latest |

**å“åº”**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "external_id": "171265324",
      "type": "motorcycle",
      "vehicle_type": "moto-gas",
      "brand": "Yamaha",
      "year": 2013,
      "price": 25900000,
      "title": "Yamaha Exciter 135cc",
      "mileage": 2000,
      "condition_text": "ÄÃ£ sá»­ dá»¥ng",
      "image_url": "https://cdn.chotot.com/...",
      "city": "ÄÃ  Náºµng",
      "district": "Quáº­n Thanh KhÃª",
      "seller_name": "Nguyá»…n VÄƒn A",
      "seller_rating": 4.5,
      "published_at": "2025-10-13T10:00:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 12,
    "total": 50,
    "totalPages": 5
  }
}
```

### 2. è·å–è½¦è¾†è¯¦æƒ…

**è¯·æ±‚**

**ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰**ï¼š
```bash
# é€šè¿‡åŸŸåè®¿é—®
curl https://vietmoto.top/api/marketplace/123

# å‰ç«¯è°ƒç”¨ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
GET /api/marketplace/123
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "vehicle_type": "moto-gas",
    "title": "Yamaha Exciter 135cc",
    "price": 25900000,
    "description": "Xe Ä‘áº¹p, mÃ¡y zin...",
    "images": ["url1", "url2", "url3"],
    "external_url": "https://xe.chotot.com/171265324",
    "seller_phone": "0901234567",
    "view_count": 15
  }
}
```

### 3. æ‰‹åŠ¨åŒæ­¥æ•°æ®ï¼ˆå…¨é‡ï¼‰

**è¯·æ±‚**

**ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰**ï¼š
```bash
# é€šè¿‡åŸŸåè®¿é—®
curl -X POST https://vietmoto.top/api/marketplace/sync

# å†…ç½‘ç›´æ¥è®¿é—®ï¼ˆæœåŠ¡å™¨æœ¬åœ°ï¼‰
curl -X POST http://localhost:4001/api/marketplace/sync
```

**å“åº”**
```json
{
  "success": true,
  "message": "Data sync completed",
  "data": {
    "moto-gas": { "fetched": 50, "saved": 48 },
    "moto-electric": { "fetched": 50, "saved": 50 },
    "car-gas": { "fetched": 50, "saved": 45 },
    "car-electric": { "fetched": 50, "saved": 50 }
  }
}
```

### 4. é‡æ–°åˆ†ç±»ç°æœ‰æ•°æ®

**è¯·æ±‚**

**ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰**ï¼š
```bash
# é€šè¿‡åŸŸåè®¿é—®
curl -X POST https://vietmoto.top/api/marketplace/reclassify

# å†…ç½‘ç›´æ¥è®¿é—®
curl -X POST http://localhost:4001/api/marketplace/reclassify
```

**åŠŸèƒ½**
- å¯¹ç°æœ‰æ•°æ®è¿›è¡Œæ™ºèƒ½é‡æ–°åˆ†ç±»
- ä»æ ‡é¢˜ä¸­æå–å¹´ä»½ä¿¡æ¯
- åŸºäºå…³é”®è¯åˆ¤æ–­ç‡ƒæ²¹/ç”µåŠ¨ç±»å‹

**å“åº”**
```json
{
  "success": true,
  "message": "Data reclassification completed",
  "data": {
    "processed": 200,
    "updated": 136
  }
}
```

### 5. è·å–ç»Ÿè®¡ä¿¡æ¯

**è¯·æ±‚**

**ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰**ï¼š
```bash
# é€šè¿‡åŸŸåè®¿é—®
curl https://vietmoto.top/api/marketplace/stats/summary

# å‰ç«¯è°ƒç”¨ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
GET /api/marketplace/stats/summary
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "total": 193,
    "brands": 15,
    "cities": 20,
    "avgPrice": 35000000,
    "minPrice": 5000000,
    "maxPrice": 150000000
  }
}
```

---

## æ•°æ®åŒæ­¥æœºåˆ¶

### è‡ªåŠ¨åŒæ­¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®šæ—¶ä»»åŠ¡è§¦å‘                               â”‚
â”‚                  (æ¯å¤©å‡Œæ™¨2ç‚¹)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MarketplaceScheduler.runSync()                  â”‚
â”‚              - æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡Œ                               â”‚
â”‚              - è®¾ç½®è¿è¡Œæ ‡å¿—                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ChoTotService.fetchAndSaveAll(50)                  â”‚
â”‚           å¾ªç¯å¤„ç†4ç§ç±»å‹:                                    â”‚
â”‚           1. moto-gas    (ç‡ƒæ²¹æ‘©æ‰˜è½¦)                        â”‚
â”‚           2. moto-electric (ç”µåŠ¨æ‘©æ‰˜è½¦)                      â”‚
â”‚           3. car-gas     (ç‡ƒæ²¹æ±½è½¦)                          â”‚
â”‚           4. car-electric (ç”µåŠ¨æ±½è½¦)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ¯ç§ç±»å‹æ‰§è¡Œ:                                        â”‚
â”‚          ChoTotService.fetchVehicles(type, 50)               â”‚
â”‚          - è¯·æ±‚APIè·å–150æ¡æ•°æ®                               â”‚
â”‚          - è¿‡æ»¤æœ€è¿‘3å‘¨çš„æ•°æ®                                  â”‚
â”‚          - è¿”å›å‰50æ¡                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ChoTotService.saveToDatabase(ads, type)             â”‚
â”‚          - éå†æ¯æ¡æ•°æ®                                       â”‚
â”‚          - è½¬æ¢æ•°æ®æ ¼å¼ (åŒ…å«vehicle_type)                    â”‚
â”‚          - upsertåˆ°æ•°æ®åº“                                     â”‚
â”‚          - å»¶è¿Ÿ500msé¿å…è¿‡å¿«                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åŒæ­¥å®Œæˆ                                    â”‚
â”‚                   - è®°å½•æ—¥å¿—                                  â”‚
â”‚                   - è¾“å‡ºç»Ÿè®¡ä¿¡æ¯                              â”‚
â”‚                   - æ¸…é™¤è¿è¡Œæ ‡å¿—                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒæ­¥ç­–ç•¥

#### å®šæ—¶ä»»åŠ¡
- **é¢‘ç‡**: æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
- **æ•°é‡**: æ¯ç§ç±»å‹50æ¡ï¼Œæ€»è®¡200æ¡
- **Cronè¡¨è¾¾å¼**: `0 2 * * *`

#### æ•°æ®åˆ†å¸ƒ
| è½¦è¾†ç±»å‹ | æ¯æ¬¡åŒæ­¥æ•°é‡ | Chá»£ Tá»‘tåˆ†ç±»ID |
|---------|-------------|--------------|
| moto-gas (ç‡ƒæ²¹æ‘©æ‰˜è½¦) | 50 | 2020 |
| moto-electric (ç”µåŠ¨æ‘©æ‰˜è½¦) | 50 | 2020 |
| car-gas (ç‡ƒæ²¹æ±½è½¦) | 50 | 2010 |
| car-electric (ç”µåŠ¨æ±½è½¦) | 50 | 2010 |
| **æ€»è®¡** | **200** | - |

### æ‰‹åŠ¨åŒæ­¥

#### æ–¹æ³•1: APIè°ƒç”¨
```bash
curl -X POST http://localhost:4001/api/marketplace/sync
```

#### æ–¹æ³•2: å‘½ä»¤è¡Œè„šæœ¬
```bash
cd /var/www/vietnam-moto-auto/backend
node -e "
const ChoTotService = require('./dist/services/ChoTotService').default;
(async () => {
  const results = await ChoTotService.fetchAndSaveAll(50);
  console.log('åŒæ­¥å®Œæˆ:', results);
})();
"
```

### æ•°æ®æ¸…ç†ç­–ç•¥

#### æ¸…ç†æ—§æ•°æ®ï¼ˆè¶…è¿‡3å‘¨ï¼‰
```sql
DELETE FROM marketplace_vehicles 
WHERE published_at < datetime('now', '-21 days');
```

#### æ¸…ç†æ— æ•ˆæ•°æ®
```sql
DELETE FROM marketplace_vehicles 
WHERE status = 'inactive';
```

---

## æ³¨æ„äº‹é¡¹

### 1. ç”µè¯ä¿¡æ¯é™åˆ¶

**é—®é¢˜**: Chá»£ Tá»‘tçš„å…¬å¼€APIä¸æä¾›å–å®¶ç”µè¯ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**:
- æä¾›"è”ç³»å–å®¶"æŒ‰é’®
- è·³è½¬åˆ°Chá»£ Tá»‘tåŸå§‹é¡µé¢
- ç”¨æˆ·åœ¨åŸå¹³å°æŸ¥çœ‹ç”µè¯å¹¶è”ç³»

**å®ç°**:
```astro
<div class="contact-seller-section">
  <a href={vehicle.external_url} target="_blank" class="btn-contact-seller">
    ğŸ“ LiÃªn há»‡ ngÆ°á»i bÃ¡n
  </a>
  <p>Nháº¥n Ä‘á»ƒ xem sá»‘ Ä‘iá»‡n thoáº¡i vÃ  liÃªn há»‡ trá»±c tiáº¿p</p>
</div>
```

### 2. vehicle_type å­—æ®µçš„é‡è¦æ€§

**ä½œç”¨**: 
- åŒºåˆ†4ç§è½¦è¾†ç±»å‹çš„æ ¸å¿ƒå­—æ®µ
- å‰ç«¯ç­›é€‰æ ‡ç­¾çš„æ•°æ®æº
- æ”¯æŒç²¾å‡†çš„æ•°æ®å±•ç¤º

**å¿…é¡»æ­£ç¡®è®¾ç½®**:
```typescript
const vehicleType = 'moto-gas'; // æˆ– moto-electric, car-gas, car-electric
await MarketplaceVehicle.upsert({
  vehicle_type: vehicleType, // å¿…é¡»è®¾ç½®
  // ...
});
```

### 3. å‰ç«¯APIè°ƒç”¨é…ç½®

**é—®é¢˜**: Mixed Contenté”™è¯¯ï¼ˆåŸŸå+SSLç¯å¢ƒï¼‰

**é”™è¯¯ä¿¡æ¯**:
```
Mixed Content: The page at 'https://vietmoto.top/marketplace' was loaded over HTTPS, 
but requested an insecure XMLHttpRequest endpoint 'http://47.237.79.9:4001/api/marketplace'
```

**åŸå› **: 
- å‰ç«¯ç¡¬ç¼–ç äº†HTTPåœ°å€
- ä½¿ç”¨äº†`.env.production`é…ç½®HTTP APIåœ°å€

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// âŒ é”™è¯¯å†™æ³•
const API_BASE_URL = 'http://47.237.79.9:4001/api';
const API_BASE_URL = import.meta.env.PUBLIC_API_URL || 'http://...';

// âœ… æ­£ç¡®å†™æ³•ï¼ˆåŸŸå+SSLç¯å¢ƒï¼‰
const API_BASE_URL = '/api';  // ç›¸å¯¹è·¯å¾„ï¼Œè‡ªåŠ¨é€šè¿‡Nginxä»£ç†
```

**é‡è¦æé†’**:
- ğŸš« åˆ é™¤æ‰€æœ‰ `.env.production` æ–‡ä»¶
- âœ… ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`
- âœ… Nginxè‡ªåŠ¨ä»£ç†åˆ°åç«¯HTTP
- âœ… æµè§ˆå™¨çœ‹åˆ°çš„éƒ½æ˜¯HTTPS

### 4. CSSæ–‡ä»¶å¯¼å…¥

**é—®é¢˜**: ç»„ä»¶æ ·å¼ä¸ç”Ÿæ•ˆ

**åŸå› **: å¿˜è®°å¯¼å…¥CSSæ–‡ä»¶

**è§£å†³**:
```typescript
// MarketplaceList.tsx
import './MarketplaceList.css'; // å¿…é¡»å¯¼å…¥ï¼
```

### 5. æœåŠ¡å™¨ä»£ç†é—®é¢˜

**é—®é¢˜**: æœåŠ¡å™¨é…ç½®äº†HTTPä»£ç†ï¼Œå¯¼è‡´APIè¯·æ±‚å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
connect ECONNREFUSED 127.0.0.1:7890
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…é™¤ä»£ç†ç¯å¢ƒå˜é‡
env -u http_proxy -u https_proxy node dist/index.js

# æˆ–åœ¨systemdæœåŠ¡ä¸­é…ç½®
Environment="NO_PROXY=*"
```

### 6. æ•°æ®æ—¶æ•ˆæ€§

**ç­–ç•¥**: åªä¿ç•™æœ€è¿‘3å‘¨çš„æ•°æ®

**åŸå› **:
- äºŒæ‰‹äº¤æ˜“ä¿¡æ¯æ—¶æ•ˆæ€§å¼º
- é¿å…å±•ç¤ºå·²å”®å‡ºçš„è½¦è¾†
- å‡å°‘æ•°æ®åº“å­˜å‚¨å‹åŠ›

### 7. å“åº”å¼è®¾è®¡

**ç­›é€‰æ ‡ç­¾å¸ƒå±€**:
- æ¡Œé¢ (>968px): 4åˆ—
- å¹³æ¿ (480-968px): 2åˆ—
- æ‰‹æœº (<480px): 1åˆ—

**å®ç°**:
```css
.vehicle-tabs {
  grid-template-columns: repeat(4, 1fr); /* é»˜è®¤4åˆ— */
}

@media (max-width: 968px) {
  .vehicle-tabs {
    grid-template-columns: repeat(2, 1fr); /* å¹³æ¿2åˆ— */
  }
}

@media (max-width: 480px) {
  .vehicle-tabs {
    grid-template-columns: 1fr; /* æ‰‹æœº1åˆ— */
  }
}
```

### 8. æ¯›ç»ç’ƒæ•ˆæœå…¼å®¹æ€§

**backdrop-filter æ”¯æŒ**:
- ç°ä»£æµè§ˆå™¨: âœ… å®Œå…¨æ”¯æŒ
- Safari: âœ… éœ€è¦ -webkit- å‰ç¼€
- è€æ—§æµè§ˆå™¨: âš ï¸ é™çº§ä¸ºçº¯è‰²èƒŒæ™¯

**å®ç°**:
```css
.tab-button {
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px); /* Safari */
}
```

### 9. æ€§èƒ½ä¼˜åŒ–

**å›¾ç‰‡æ‡’åŠ è½½**:
```tsx
<img 
  src={vehicle.image_url} 
  alt={vehicle.title}
  loading="lazy" // æ‡’åŠ è½½
/>
```

**åˆ†é¡µåŠ è½½**:
- æ¯é¡µ12æ¡æ•°æ®
- é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®
- æå‡é¦–å±åŠ è½½é€Ÿåº¦

### 10. SEOä¼˜åŒ–

**åˆ—è¡¨é¡µé¢„æ¸²æŸ“**:
```astro
---
export const prerender = true; // é™æ€é¢„æ¸²æŸ“
---
```

**è¯¦æƒ…é¡µSSR**:
```astro
---
export const prerender = false; // æœåŠ¡ç«¯æ¸²æŸ“
const vehicle = await fetchVehicleData(id);
---
<title>{vehicle.title} - Vietnam Moto & Auto</title>
```

### 11. æ•°æ®åº“ç»´æŠ¤

**å®šæœŸç»´æŠ¤ä»»åŠ¡**:
```bash
# 1. æ¸…ç†æ—§æ•°æ®
sqlite3 vietnam_moto_auto.sqlite "
DELETE FROM marketplace_vehicles 
WHERE published_at < datetime('now', '-21 days');
"

# 2. ä¼˜åŒ–æ•°æ®åº“
sqlite3 vietnam_moto_auto.sqlite "VACUUM;"

# 3. åˆ†ææŸ¥è¯¢æ€§èƒ½
sqlite3 vietnam_moto_auto.sqlite "ANALYZE;"
```

---

## æ€»ç»“

### å·²å®ç°åŠŸèƒ½

#### æ•°æ®é‡‡é›†ä¸ç®¡ç†
- âœ… è‡ªåŠ¨æŠ“å–Chá»£ Tá»‘täºŒæ‰‹è½¦è¾†æ•°æ®
- âœ… æ”¯æŒ4ç§è½¦è¾†ç±»å‹çš„ç‹¬ç«‹æŠ“å–
- âœ… **æ™ºèƒ½åˆ†ç±»ç³»ç»Ÿ**ï¼šåŸºäºå…³é”®è¯è‡ªåŠ¨è¯†åˆ«ç‡ƒæ²¹/ç”µåŠ¨è½¦è¾†
- âœ… **å¹´ä»½æå–åŠŸèƒ½**ï¼šä»æ ‡é¢˜ä¸­æ™ºèƒ½æå–è½¦è¾†å¹´ä»½
- âœ… åªä¿ç•™æœ€è¿‘3å‘¨çš„æ–°é²œæ•°æ®
- âœ… æ¯æ—¥è‡ªåŠ¨åŒæ­¥æ•°æ®ï¼ˆæ¯ç§ç±»å‹50æ¡ï¼‰
- âœ… æ‰‹åŠ¨åŒæ­¥API
- âœ… **æ•°æ®é‡æ–°åˆ†ç±»API**ï¼šæ”¯æŒå¯¹ç°æœ‰æ•°æ®è¿›è¡Œæ™ºèƒ½é‡æ–°åˆ†ç±»

#### å‰ç«¯å±•ç¤º
- âœ… è½¦è¾†åˆ—è¡¨å±•ç¤ºå’Œåˆ†é¡µï¼ˆæ¯é¡µ12æ¡ï¼‰
- âœ… **å››ç§ç±»å‹ç­›é€‰æ ‡ç­¾**ï¼ˆç‡ƒæ²¹æ‘©æ‰˜è½¦ã€ç”µåŠ¨æ‘©æ‰˜è½¦ã€ç‡ƒæ²¹æ±½è½¦ã€ç”µåŠ¨æ±½è½¦ï¼‰
- âœ… **ç°ä»£åŒ–æ¯›ç»ç’ƒUIè®¾è®¡**
- âœ… **æŒ‰å¹´ä»½æ’åº**ï¼šæ”¯æŒæœ€æ–°/æœ€æ—§å¹´ä»½æ’åº
- âœ… è½¦è¾†è¯¦æƒ…é¡µï¼ˆSSRæ¸²æŸ“ï¼‰
- âœ… è”ç³»å–å®¶åŠŸèƒ½ï¼ˆè·³è½¬åŸå¹³å°ï¼‰
- âœ… å“åº”å¼å¸ƒå±€ï¼ˆæ¡Œé¢/å¹³æ¿/æ‰‹æœºï¼‰

#### APIæ¥å£
- âœ… è·å–è½¦è¾†åˆ—è¡¨ï¼ˆæ”¯æŒvehicle_typeç­›é€‰å’Œå¹´ä»½æ’åºï¼‰
- âœ… è·å–è½¦è¾†è¯¦æƒ…
- âœ… æ‰‹åŠ¨åŒæ­¥æ•°æ®
- âœ… **æ•°æ®é‡æ–°åˆ†ç±»API**
- âœ… ç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢

### æŠ€æœ¯ç‰¹ç‚¹

#### å‰ç«¯æŠ€æœ¯
- **Astroæ··åˆæ¸²æŸ“**: åˆ—è¡¨é¡µé™æ€ï¼Œè¯¦æƒ…é¡µåŠ¨æ€
- **Reactç»„ä»¶**: äº¤äº’å¼ç­›é€‰å’Œåˆ†é¡µ
- **Cursoré£æ ¼è®¾è®¡**: æ¯›ç»ç’ƒã€æ¸å˜ã€ç«‹ä½“æ„Ÿ
- **å“åº”å¼å¸ƒå±€**: è‡ªé€‚åº”å„ç§å±å¹•å°ºå¯¸
- **æ€§èƒ½ä¼˜åŒ–**: æ‡’åŠ è½½ã€åˆ†é¡µåŠ è½½

#### åç«¯æŠ€æœ¯
- **å¤šç±»å‹æ”¯æŒ**: 4ç§è½¦è¾†ç±»å‹ç‹¬ç«‹ç®¡ç†
- **æ™ºèƒ½åˆ†ç±»**: åŸºäºå…³é”®è¯è‡ªåŠ¨è¯†åˆ«ç‡ƒæ²¹/ç”µåŠ¨è½¦è¾†
- **å¹´ä»½æå–**: ä»æ ‡é¢˜ä¸­æ™ºèƒ½æå–è½¦è¾†å¹´ä»½ä¿¡æ¯
- **æ•°æ®æ—¶æ•ˆ**: 3å‘¨å†…æ•°æ®ï¼Œç¡®ä¿æ–°é²œåº¦
- **æ™ºèƒ½å»é‡**: upsertæœºåˆ¶é¿å…é‡å¤
- **å®šæ—¶åŒæ­¥**: æ¯æ—¥è‡ªåŠ¨æ›´æ–°
- **æ•°æ®é‡æ–°åˆ†ç±»**: æ”¯æŒå¯¹ç°æœ‰æ•°æ®è¿›è¡Œæ™ºèƒ½é‡æ–°åˆ†ç±»
- **APIä¼˜åŒ–**: åˆç†çš„æŸ¥è¯¢å’Œç´¢å¼•ï¼Œæ”¯æŒå¹´ä»½æ’åº

### æ•°æ®ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ”¯æŒè½¦è¾†ç±»å‹ | 4ç§ |
| æ¯ç§ç±»å‹æ•°æ®é‡ | 50æ¡ |
| æ€»æ•°æ®é‡ | ~200æ¡ |
| æ•°æ®æ›´æ–°é¢‘ç‡ | æ¯å¤©ä¸€æ¬¡ |
| æ•°æ®æ—¶æ•ˆæ€§ | æœ€è¿‘3å‘¨ |
| æ¯é¡µå±•ç¤ºæ•°é‡ | 12æ¡ |

### æœªæ¥ä¼˜åŒ–æ–¹å‘

#### åŠŸèƒ½æ‰©å±•
- [ ] é«˜çº§æœç´¢å’Œç­›é€‰ï¼ˆä»·æ ¼åŒºé—´ã€å¹´ä»½ã€å“ç‰Œï¼‰
- [ ] æ”¶è—å’Œå¯¹æ¯”åŠŸèƒ½
- [ ] ä»·æ ¼è¶‹åŠ¿åˆ†æå›¾è¡¨
- [ ] ç”¨æˆ·è¯„è®ºå’Œç‚¹è¯„ç³»ç»Ÿ
- [ ] æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿ

#### æ•°æ®æºæ‰©å±•
- [ ] é›†æˆæ›´å¤šäºŒæ‰‹äº¤æ˜“å¹³å°
- [ ] æ”¯æŒæ›´å¤šè½¦è¾†å“ç‰Œ
- [ ] æ·»åŠ æ–°è½¦ä»·æ ¼å¯¹æ¯”

#### UI/UXä¼˜åŒ–
- [ ] æ·»åŠ ç­›é€‰å™¨åŠ¨ç”»æ•ˆæœ
- [ ] ä¼˜åŒ–åŠ è½½çŠ¶æ€å±•ç¤º
- [ ] æ·»åŠ æ•°æ®å¯è§†åŒ–å›¾è¡¨
- [ ] æ”¯æŒæ·±è‰²æ¨¡å¼åˆ‡æ¢

#### æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°æœåŠ¡ç«¯ç¼“å­˜
- [ ] æ·»åŠ CDNæ”¯æŒ
- [ ] ä¼˜åŒ–å›¾ç‰‡åŠ è½½ç­–ç•¥
- [ ] å®ç°è™šæ‹Ÿæ»šåŠ¨

---

## æ›´æ–°æ—¥å¿—

### v1.2 (2025-10-14)
**ç”Ÿäº§ç¯å¢ƒï¼šåŸŸå+SSLéƒ¨ç½²æ›´æ–°**
- âœ… æ›´æ–°Nginxé…ç½®ï¼šå®Œæ•´çš„HTTPS + SSLé…ç½®ç¤ºä¾‹
- âœ… æ›´æ–°APIè°ƒç”¨è§„èŒƒï¼šå¼ºè°ƒä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`
- âœ… æ·»åŠ Mixed Contenté”™è¯¯è§£å†³æ–¹æ¡ˆ
- âœ… æ›´æ–°APIæ¥å£æ–‡æ¡£ï¼šæ‰€æœ‰ç¤ºä¾‹ä½¿ç”¨HTTPSåŸŸå
- âœ… æ·»åŠ å‰ç«¯APIè°ƒç”¨æœ€ä½³å®è·µ
- âœ… æ›´æ–°æ³¨æ„äº‹é¡¹ï¼šæ–°å¢å‰ç«¯APIè°ƒç”¨é…ç½®è¯´æ˜
- âœ… å¼ºè°ƒä¸è¦ä½¿ç”¨ `.env.production` é…ç½®APIåœ°å€
- âœ… æ·»åŠ å®Œæ•´çš„è¯·æ±‚æµç¨‹å›¾ï¼ˆHTTPSç¯å¢ƒï¼‰

### v1.1 (2025-10-13)
- âœ… **æ™ºèƒ½åˆ†ç±»ç³»ç»Ÿ**ï¼šåŸºäºå…³é”®è¯è‡ªåŠ¨è¯†åˆ«ç‡ƒæ²¹/ç”µåŠ¨è½¦è¾†
- âœ… **å¹´ä»½æå–åŠŸèƒ½**ï¼šä»æ ‡é¢˜ä¸­æ™ºèƒ½æå–è½¦è¾†å¹´ä»½ä¿¡æ¯
- âœ… **æŒ‰å¹´ä»½æ’åº**ï¼šæ”¯æŒæœ€æ–°/æœ€æ—§å¹´ä»½æ’åº
- âœ… **æ•°æ®é‡æ–°åˆ†ç±»API**ï¼šæ”¯æŒå¯¹ç°æœ‰æ•°æ®è¿›è¡Œæ™ºèƒ½é‡æ–°åˆ†ç±»
- âœ… ä¿®å¤æ±½è½¦æ•°æ®å¹´ä»½æ’åºé—®é¢˜
- âœ… ä¼˜åŒ–æ’åºé€»è¾‘ï¼Œå¹´ä»½ä¸ºç©ºæ—¶æŒ‰å‘å¸ƒæ—¶é—´æ’åº

### v1.0 (2025-10-13)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®ç°4ç§è½¦è¾†ç±»å‹ç­›é€‰
- âœ… ç°ä»£åŒ–æ¯›ç»ç’ƒUIè®¾è®¡
- âœ… å®Œæ•´çš„æ•°æ®åŒæ­¥æœºåˆ¶
- âœ… å“åº”å¼å¸ƒå±€æ”¯æŒ

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.2ï¼ˆç”Ÿäº§ç¯å¢ƒ - åŸŸå+SSLï¼‰  
**æœ€åæ›´æ–°**: 2025-10-14  
**ç»´æŠ¤è€…**: Vietnam Moto & Auto å¼€å‘å›¢é˜Ÿ  
**ç”Ÿäº§ç¯å¢ƒ**: https://vietmoto.top/marketplace

