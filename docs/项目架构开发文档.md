# 越南摩托汽车资讯网站 - 项目架构开发文档

## 📋 项目概述

### 项目名称
越南摩托汽车资讯网站 (Vietnam Moto & Auto News Portal)

### 项目简介
一个现代化的越南摩托车和汽车资讯门户网站，提供新闻、车型介绍、问答社区和二手交易等功能。采用高性能的Astro前端框架，配合现代化的UI设计，为用户提供流畅的浏览体验。

### 当前项目状态 ✅
- **开发阶段**: 核心功能已完成，生产环境运行中
- **数据库**: SQLite 3.x，已初始化并导入数据
- **前端**: Astro 5.x + React 19 + TailwindCSS 4.x，21个静态页面已构建
- **后端**: Express 5.x + TypeScript 5.x + Sequelize，API服务运行中
- **部署**: 使用 Systemd 服务管理，已部署到生产环境
- **访问地址**: http://47.237.79.9:4321 (前端), http://47.237.79.9:4001 (后端)

### 项目目标
- 提供专业的摩托车和汽车资讯内容
- 建立活跃的车友问答社区
- 打造便捷的二手车交易平台
- 提供优质的用户体验和现代化的界面设计

### 目标用户
- 越南摩托车和汽车爱好者
- 准备购车的潜在客户
- 二手车交易用户
- 汽车行业从业者

---

## 🏗️ 技术架构

### 整体架构（生产环境）
```
┌─────────────────────────────────────────────────────────┐
│                  用户浏览器（Client）                     │
└─────────────────┬───────────────────────────────────────┘
                  │ HTTP/HTTPS
                  ↓
┌─────────────────────────────────────────────────────────┐
│              Nginx 反向代理（端口 80）                    │
│         (静态文件服务 + API代理 + 负载均衡)               │
└───────────┬─────────────────────────────┬───────────────┘
            │                             │
    ┌───────▼─────────┐         ┌────────▼────────┐
    │  前端静态文件    │         │   后端API服务   │
    │  Astro SSG      │         │   Express.js    │
    │  端口: 4321     │         │   端口: 4001    │
    │  (Systemd)      │         │   (Systemd)     │
    └─────────────────┘         └────────┬────────┘
                                         │
                                ┌────────▼────────┐
                                │  SQLite 数据库  │
                                │  (本地文件)     │
                                └─────────────────┘
                                         │
                                ┌────────▼────────┐
                                │  Redis 缓存     │
                                │  (可选)         │
                                └─────────────────┘
```

**部署特点**：
- ✅ Systemd 服务管理（开机自启）
- ✅ Nginx 反向代理和静态文件服务
- ✅ SQLite 单文件数据库（无需额外数据库服务）
- ✅ 独立端口部署（4321 + 4001）
- ✅ 与其他服务和平共存

### 技术栈

#### 前端技术栈
- **框架**: Astro 5.14.4 - 高性能静态站点生成器（SSG）
- **UI框架**: React 19.2.0 - 用于交互式组件
- **样式**: TailwindCSS 4.1.14 - 实用优先的CSS框架
- **UI设计**: Cursor主题风格 + Glassmorphism毛玻璃效果
- **图标**: Lucide React 0.545.0
- **动画**: Framer Motion 12.23.24
- **状态管理**: Zustand 5.0.8
- **HTTP客户端**: Axios 1.12.2
- **表单处理**: React Hook Form 7.65.0 + Zod 3.25.76
- **类型安全**: TypeScript 5.x
- **SEO**: Astro内置SEO优化（Open Graph、Twitter Card）

#### 后端技术栈
- **运行时**: Node.js 20+
- **框架**: Express.js 5.1.0
- **语言**: TypeScript 5.9.3
- **ORM**: Sequelize 6.37.7（SQLite适配器）
- **认证**: JWT (jsonwebtoken 9.0.2)
- **安全**: Helmet 8.1.0（HTTP安全头）
- **CORS**: cors 2.8.5
- **速率限制**: express-rate-limit 8.1.0
- **压缩**: compression 1.8.1
- **日志**: Morgan 1.10.1
- **文件上传**: Multer 2.0.2
- **密码加密**: bcryptjs 3.0.2
- **验证**: express-validator 7.2.1
- **Redis**: ioredis 5.8.1（可选）

#### 数据库
- **主数据库**: SQLite 3.x (sqlite3 5.1.7)
  - **开发环境**: `/root/越南摩托汽车网站/backend/database/vietnam_moto_auto.sqlite`
  - **生产环境**: `/var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite`
  - **优势**: 轻量级、零配置、无需额外服务、易于备份
  - **特性**: 外键约束、事务处理、FTS5全文搜索、TEXT字段（支持任意长度）
  - **表数量**: 10个核心表
  - **数据**: 包含31辆摩托车真实数据（9个品牌）
  - **重要**: 所有表使用INTEGER自增主键（不是UUID）
- **缓存**: Redis 7.x（可选，用于会话和API缓存）
- **搜索引擎**: SQLite FTS5 虚拟表（高性能全文搜索）

#### DevOps & 工具
- **服务管理**: Systemd（vietnam-moto-backend.service）
- **反向代理**: Nginx（静态文件服务 + API代理）
- **进程管理**: Systemd（替代PM2，更稳定）
- **版本控制**: Git
- **包管理**: npm
- **代码规范**: ESLint + Prettier
- **类型检查**: TypeScript 5.x
- **测试框架**: Vitest + Testing Library
- **部署脚本**: 自动化Shell脚本（deploy.sh）
- **备份脚本**: SQLite备份脚本（backup-database.sh）

---

## 📁 项目结构

```
越南摩托汽车网站/
├── frontend/                      # 前端项目
│   ├── public/                    # 静态资源
│   │   ├── images/               # 图片资源
│   │   ├── icons/                # 图标资源
│   │   └── fonts/                # 字体文件
│   ├── src/
│   │   ├── assets/               # 源码资源
│   │   ├── components/           # 组件库
│   │   │   ├── common/          # 通用组件
│   │   │   │   ├── Header.astro
│   │   │   │   ├── Footer.astro
│   │   │   │   ├── Navigation.astro
│   │   │   │   ├── SearchBar.tsx
│   │   │   │   └── Card.astro
│   │   │   ├── glass/           # 毛玻璃组件
│   │   │   │   ├── GlassCard.tsx
│   │   │   │   ├── GlassButton.tsx
│   │   │   │   └── GlassModal.tsx
│   │   │   ├── news/            # 新闻模块组件
│   │   │   ├── vehicles/        # 车型模块组件
│   │   │   ├── qa/              # 问答模块组件
│   │   │   └── marketplace/     # 二手交易组件
│   │   ├── layouts/             # 页面布局
│   │   │   ├── BaseLayout.astro
│   │   │   ├── ArticleLayout.astro
│   │   │   └── DashboardLayout.astro
│   │   ├── pages/               # 路由页面
│   │   │   ├── index.astro      # 首页
│   │   │   ├── news/            # 新闻板块
│   │   │   │   ├── index.astro
│   │   │   │   └── [slug].astro
│   │   │   ├── motorcycles/     # 摩托车型
│   │   │   │   ├── index.astro
│   │   │   │   └── [id].astro
│   │   │   ├── cars/            # 汽车车型
│   │   │   │   ├── index.astro
│   │   │   │   └── [id].astro
│   │   │   ├── qa/              # 问答板块
│   │   │   │   ├── motorcycles.astro
│   │   │   │   └── cars.astro
│   │   │   └── marketplace/     # 二手交易
│   │   │       ├── index.astro
│   │   │       └── [id].astro
│   │   ├── styles/              # 样式文件
│   │   │   ├── global.css
│   │   │   ├── theme.css        # Cursor主题
│   │   │   └── glass.css        # 毛玻璃效果
│   │   ├── utils/               # 工具函数
│   │   ├── services/            # API服务
│   │   ├── stores/              # 状态管理
│   │   ├── types/               # TypeScript类型
│   │   └── config/              # 配置文件
│   ├── astro.config.mjs         # Astro配置
│   ├── tailwind.config.mjs      # Tailwind配置
│   ├── tsconfig.json            # TypeScript配置
│   └── package.json
│
├── backend/                       # 后端项目
│   ├── src/
│   │   ├── config/               # 配置文件
│   │   │   ├── database.js      # 数据库配置
│   │   │   ├── redis.js         # Redis配置
│   │   │   └── app.js           # 应用配置
│   │   ├── models/               # 数据模型
│   │   │   ├── User.js
│   │   │   ├── News.js
│   │   │   ├── Motorcycle.js
│   │   │   ├── Car.js
│   │   │   ├── Question.js
│   │   │   ├── Answer.js
│   │   │   └── Listing.js       # 二手交易
│   │   ├── controllers/          # 控制器
│   │   │   ├── newsController.js
│   │   │   ├── vehicleController.js
│   │   │   ├── qaController.js
│   │   │   └── marketplaceController.js
│   │   ├── routes/               # 路由
│   │   │   ├── news.js
│   │   │   ├── vehicles.js
│   │   │   ├── qa.js
│   │   │   └── marketplace.js
│   │   ├── middleware/           # 中间件
│   │   │   ├── auth.js
│   │   │   ├── validation.js
│   │   │   ├── errorHandler.js
│   │   │   └── rateLimiter.js
│   │   ├── services/             # 业务逻辑服务
│   │   ├── utils/                # 工具函数
│   │   ├── validators/           # 数据验证
│   │   └── app.js                # 应用入口
│   ├── uploads/                  # 上传文件目录
│   ├── logs/                     # 日志目录
│   ├── tests/                    # 测试文件
│   ├── .env.example              # 环境变量示例
│   ├── package.json
│   └── ecosystem.config.js       # PM2配置
│
├── database/                      # 数据库相关
│   ├── migrations/               # 数据迁移
│   ├── seeds/                    # 数据种子
│   ├── schemas/                  # 数据库结构设计
│   │   ├── schema.sql           # 完整SQL结构
│   │   └── erd.md               # 实体关系图
│   └── backup/                   # 数据库备份
│
├── docs/                          # 项目文档（完整）
│   ├── README.md                  # 项目总览
│   ├── 项目架构开发文档.md        # 本文档
│   ├── 数据库设计文档.md           # SQLite数据库设计
│   ├── 前端页面设计开发文档.md     # 前端UI和组件
│   ├── 后端服务开发文档.md         # 后端服务架构
│   ├── API路由开发文档.md          # 完整API接口文档
│   ├── 爬虫系统设计开发文档.md     # 数据采集爬虫
│   └── 生产环境部署文档.md         # 部署和运维
│
├── nginx/                         # Nginx配置
│   └── vietnam-moto-auto.conf    # Nginx站点配置
│
├── systemd/                       # Systemd服务配置
│   └── vietnam-moto-backend.service
│
├── deploy.sh                      # 生产环境部署脚本
├── backup-database.sh             # SQLite数据库备份脚本
├── astro.config.mjs              # Astro配置（支持公网访问）
├── .gitignore
└── vietnam_moto_auto.sqlite      # 开发环境数据库
```

---

## 🎨 UI设计规范

### Cursor主题风格

#### 主色调
```css
/* 基于Cursor的深色主题 */
--primary: #2563eb;           /* 主蓝色 */
--primary-light: #3b82f6;     /* 浅蓝 */
--primary-dark: #1e40af;      /* 深蓝 */

--secondary: #8b5cf6;         /* 紫色 */
--accent: #06b6d4;            /* 青色 */

--background: #0f0f0f;        /* 深色背景 */
--surface: #1a1a1a;           /* 表面色 */
--surface-light: #2a2a2a;     /* 浅表面色 */

--text-primary: #ffffff;      /* 主文字 */
--text-secondary: #a0a0a0;    /* 次要文字 */
--text-muted: #6b6b6b;        /* 弱化文字 */

--border: rgba(255, 255, 255, 0.1);
--hover: rgba(255, 255, 255, 0.05);
```

#### 毛玻璃效果 (Glassmorphism)
```css
.glass-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

.glass-button {
  background: rgba(37, 99, 235, 0.15);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(37, 99, 235, 0.3);
  transition: all 0.3s ease;
}

.glass-button:hover {
  background: rgba(37, 99, 235, 0.25);
  border-color: rgba(37, 99, 235, 0.5);
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
}
```

#### 立体感设计
- 使用多层阴影创建深度
- 悬停时添加轻微的3D变换
- 利用渐变和光影效果
- 卡片和按钮的微动画

#### 现代化特性
- 流畅的过渡动画 (300-400ms)
- 微交互反馈
- 响应式设计 (移动优先)
- 骨架屏加载
- 图片懒加载
- 平滑滚动

### 组件设计原则
1. **一致性**: 所有组件遵循统一的设计语言
2. **可访问性**: 符合WCAG 2.1 AA标准
3. **性能优先**: 优化加载速度和交互响应
4. **响应式**: 适配各种屏幕尺寸
5. **模块化**: 组件可复用和组合

---

## 📱 功能板块详细设计

### 1. 首页 (Homepage)

#### 功能特性
- Hero区域: 精选头条新闻轮播
- 热门新闻: 最新资讯卡片网格
- 热门车型: 摩托车和汽车推荐
- 热门问答: 社区活跃话题
- 精选二手: 推荐二手车辆
- 统计数据: 动态展示网站数据

#### 组件结构
```
HomePage
├── HeroSection (轮播)
├── TrendingNews (新闻网格)
├── FeaturedVehicles (车型展示)
│   ├── MotorcycleSlider
│   └── CarSlider
├── PopularQA (问答列表)
├── FeaturedListings (二手精选)
└── StatsSection (统计数据)
```

#### 数据来源
- 新闻数据: `/api/news?featured=true&limit=10`
- 车型数据: `/api/vehicles?featured=true`
- 问答数据: `/api/qa?popular=true&limit=5`
- 二手数据: `/api/marketplace?featured=true&limit=6`

---

### 2. 新闻板块 (News)

#### 功能特性
- 新闻列表: 分页浏览所有新闻
- 分类筛选: 摩托车新闻 / 汽车新闻 / 行业动态
- 搜索功能: 关键词搜索
- 新闻详情: 富文本内容展示
- 相关推荐: 相似新闻推荐
- 评论系统: 用户评论和互动
- 社交分享: 分享到社交媒体

#### 页面结构
```
News Section
├── NewsListPage
│   ├── FilterBar (筛选栏)
│   ├── SearchBar (搜索框)
│   ├── NewsGrid (新闻网格)
│   └── Pagination (分页)
└── NewsDetailPage
    ├── ArticleHeader (标题、作者、日期)
    ├── ArticleContent (内容)
    ├── RelatedNews (相关新闻)
    ├── CommentSection (评论区)
    └── ShareButtons (分享按钮)
```

#### 数据结构
```typescript
interface News {
  id: number;                    // 自增ID
  title: string;
  slug: string;
  content: string;
  summary?: string;              // 摘要
  excerpt?: string;              // 简短摘要
  featured_image?: string;       // 特色图片（不是coverImage）
  category?: string;
  author_name?: string;          // 作者名称（不是author对象）
  status: string;                // draft/published/archived
  is_featured: boolean;          // 是否精选（不是featured）
  view_count: number;            // 浏览次数（不是views）
  published_at?: Date;
  created_at: Date;
  updated_at: Date;
}
```

---

### 3. 摩托车型介绍 (Motorcycles)

#### 功能特性
- 车型列表: 按品牌、类型、价格筛选
- 详细参数: 引擎、性能、尺寸等
- 图片画廊: 多角度车型图片
- 视频展示: 试驾视频
- 价格信息: 官方售价和经销商报价
- 用户评价: 车主评分和评论
- 对比功能: 多款车型对比

#### 筛选维度
- **品牌**: Honda, Yamaha, Suzuki, Kawasaki等
- **类型**: 踏板车、跨骑、街车、运动、越野等
- **排量**: <125cc, 125-250cc, 250-500cc, >500cc
- **价格区间**: 自定义价格范围
- **年份**: 2020-2025

#### 数据结构
```typescript
interface Motorcycle {
  id: number;                    // 自增ID
  brand: string;
  model: string;
  year: number;
  category: string;              // 类型分类（不是type）
  price_vnd: number;             // 价格（不是price对象）
  
  // 发动机系统
  engine_cc?: number;            // 排量
  engine_type?: string;
  power_hp?: number;             // 功率
  torque_nm?: number;            // 扭矩
  
  // 传动系统
  transmission?: string;
  fuel_type?: string;
  
  // 尺寸重量
  weight_kg?: number;
  seat_height_mm?: number;
  wheelbase_mm?: number;
  ground_clearance_mm?: number;
  fuel_capacity_l?: number;
  
  // 配置
  abs: boolean;                  // ABS系统
  smart_key: boolean;            // 智能钥匙
  features?: string;
  
  // 其他
  image_url?: string;
  rating?: number;
  view_count: number;            // 浏览次数（不是views）
  status: string;
  created_at: Date;
  updated_at: Date;
}
```

---

### 4. 汽车车型介绍 (Cars)

#### 功能特性
- 车型列表: 按品牌、类型、价格筛选
- 详细配置: 动力、配置、安全等
- 360°看车: 全景展示
- 试驾视频: 专业评测
- 配置对比: 不同配置对比
- 经销商信息: 附近经销商位置
- 预约试驾: 在线预约功能

#### 筛选维度
- **品牌**: Toyota, Honda, Ford, VinFast等
- **类型**: 轿车、SUV、MPV、皮卡、电动车
- **价格区间**: 自定义范围
- **座位数**: 2-7座
- **燃油类型**: 汽油、柴油、混动、纯电
- **年份**: 2020-2025

#### 数据结构
```typescript
interface Car {
  id: number;                    // 自增ID
  brand: string;
  model: string;
  year: number;
  type: string;                  // sedan/suv/mpv等
  
  // 发动机
  engine_type?: string;
  displacement?: number;
  power?: string;
  fuel_type: string;             // gasoline/diesel/hybrid/electric
  
  // 传动与底盘
  transmission?: string;
  drive_type?: string;           // fwd/rwd/awd
  
  // 其他
  seats?: number;
  price_min?: number;
  price_max?: number;
  features?: string;             // JSON格式
  safety_features?: string;      // JSON格式
  image_url?: string;
  rating?: number;
  view_count: number;            // 浏览次数（不是views）
  status: string;
  created_at: Date;
  updated_at: Date;
}
```

---

### 5. 摩托问答 (Motorcycle Q&A)

#### 功能特性
- 提问发布: 用户发起问题
- 回答功能: 其他用户回答
- 投票系统: 点赞/点踩
- 最佳答案: 提问者采纳
- 分类标签: 按话题分类
- 搜索功能: 查找相关问题
- 用户声望: 积分和等级系统
- 通知系统: 回答提醒

#### 问题分类
- 购车咨询
- 维修保养
- 改装升级
- 骑行技巧
- 法律法规
- 保险理赔

#### 数据结构
```typescript
interface Question {
  id: number;                    // 自增ID
  title: string;
  content: string;
  category: string;
  tags?: string;                 // JSON格式
  author_id: string;             // 用户ID
  created_at: Date;
  view_count: number;            // 浏览次数（不是views）
  votes_count: number;
  answers_count: number;
  has_accepted_answer: boolean;
  status: string;
}

interface Answer {
  id: number;                    // 自增ID
  question_id: number;
  content: string;
  author_id: string;             // 用户ID
  created_at: Date;
  votes_count: number;
  is_accepted: boolean;
}
```

---

### 6. 汽车问答 (Car Q&A)

功能设计与摩托问答类似，但针对汽车相关话题。

#### 问题分类
- 选车建议
- 维修保养
- 改装美容
- 驾驶技巧
- 保险年检
- 二手车交易

---

### 7. 二手交易 (Marketplace)

#### 功能特性
- 发布出售: 用户发布车辆信息
- 搜索筛选: 多维度筛选
- 详情展示: 车况、价格、联系方式
- 图片上传: 多图展示
- 在线聊天: 买卖双方沟通
- 收藏功能: 收藏感兴趣的车辆
- 举报机制: 虚假信息举报
- 成交记录: 交易历史

#### 筛选条件
- 车辆类型: 摩托车/汽车
- 品牌型号
- 价格区间
- 使用年限
- 行驶里程
- 所在地区
- 车辆状况

#### 数据结构
```typescript
interface Listing {
  id: number;                    // 自增ID
  type: 'motorcycle' | 'car';
  brand: string;
  model: string;
  year: number;
  price: number;
  mileage?: number;
  condition_rating?: number;
  description?: string;
  images?: string;               // JSON格式
  city?: string;
  district?: string;
  seller_id: string;             // 卖家ID
  contact_name?: string;
  contact_phone: string;
  status: 'active' | 'sold' | 'removed';
  created_at: Date;
  view_count: number;            // 浏览次数（不是views）
  favorites_count: number;
}
```

---

## 🗄️ 数据库设计

### 核心数据表

#### 1. users (用户表)
```sql
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  username TEXT UNIQUE NOT NULL,
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  full_name TEXT,
  avatar TEXT,
  phone TEXT,
  bio TEXT,
  reputation_points INTEGER DEFAULT 0,
  verified INTEGER DEFAULT 0,
  role TEXT DEFAULT 'user' CHECK (role IN ('user', 'moderator', 'admin')),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_login DATETIME,
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'suspended', 'deleted'))
);

-- 索引
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_role ON users(role);
```

#### 2. news (新闻表)
```sql
CREATE TABLE news (
  id INTEGER PRIMARY KEY AUTOINCREMENT,            -- 自增ID
  title TEXT NOT NULL,                             -- 标题
  slug TEXT UNIQUE NOT NULL,                       -- URL标识
  content TEXT NOT NULL,                           -- 内容
  summary TEXT,                                    -- 摘要
  excerpt TEXT,                                    -- 简短摘要
  featured_image TEXT,                             -- 特色图片
  category TEXT,                                   -- 分类
  author_name TEXT,                                -- 作者名称
  status TEXT DEFAULT 'published',                 -- 状态
  is_featured BOOLEAN DEFAULT 0,                   -- 是否精选
  view_count INTEGER DEFAULT 0,                    -- 浏览次数
  published_at DATETIME,                           -- 发布时间
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_news_slug ON news(slug);
CREATE INDEX idx_news_category ON news(category);
CREATE INDEX idx_news_status ON news(status);
CREATE INDEX idx_news_is_featured ON news(is_featured);

-- 全文搜索（FTS5）
CREATE VIRTUAL TABLE news_fts USING fts5(title, content, content='news', content_rowid='rowid');
```

**注意**：使用SQLite语法，字段名与生产环境完全一致。

#### 3. motorcycles (摩托车型表)
```sql
CREATE TABLE motorcycles (
  id INTEGER PRIMARY KEY AUTOINCREMENT,         -- 自增ID
  brand TEXT NOT NULL,                          -- 品牌
  model TEXT NOT NULL,                          -- 型号
  year INTEGER NOT NULL,                        -- 年份
  category TEXT NOT NULL,                       -- 类型分类
  price_vnd REAL NOT NULL,                      -- 价格（越南盾）
  
  -- 发动机系统（共15个字段）
  engine_cc INTEGER,                            -- 排量
  engine_type TEXT,
  power_hp REAL,
  power_rpm INTEGER,
  torque_nm REAL,
  torque_rpm INTEGER,
  compression_ratio TEXT,
  bore_stroke TEXT,
  valve_system TEXT,
  
  -- 传动系统（共6个字段）
  transmission TEXT,
  clutch_type TEXT,
  fuel_type TEXT,
  fuel_supply TEXT,
  starter TEXT,
  ignition TEXT,
  
  -- 电动车参数（共3个字段）
  battery_kwh REAL,
  range_km INTEGER,
  charge_time_h REAL,
  
  -- 底盘系统（共7个字段）
  frame_type TEXT,
  front_suspension TEXT,
  rear_suspension TEXT,
  front_brake TEXT,
  rear_brake TEXT,
  front_tire TEXT,
  rear_tire TEXT,
  
  -- 尺寸重量（共6个字段）
  dimensions_mm TEXT,
  wheelbase_mm INTEGER,
  ground_clearance_mm INTEGER,
  seat_height_mm INTEGER,
  weight_kg INTEGER,
  fuel_capacity_l REAL,
  
  -- 配置信息（共5个字段）
  abs BOOLEAN NOT NULL DEFAULT 0,               -- ABS系统
  smart_key BOOLEAN NOT NULL DEFAULT 0,         -- 智能钥匙
  display_type TEXT,
  lighting TEXT,
  features TEXT,
  
  -- 其他信息（共11个字段）
  description TEXT,
  warranty TEXT,
  fuel_consumption TEXT,
  colors TEXT,
  image_url TEXT,
  rating REAL,
  view_count INTEGER NOT NULL DEFAULT 0,        -- 浏览次数
  status TEXT NOT NULL DEFAULT 'active',
  created_at DATETIME NOT NULL,
  updated_at DATETIME NOT NULL
);

-- 索引
CREATE INDEX idx_motorcycles_brand ON motorcycles(brand);
CREATE INDEX idx_motorcycles_category ON motorcycles(category);
CREATE INDEX idx_motorcycles_year ON motorcycles(year);
CREATE INDEX idx_motorcycles_price ON motorcycles(price_vnd);
CREATE INDEX idx_motorcycles_status ON motorcycles(status);
```

**注意**：共52个字段，使用SQLite语法，与生产环境完全一致。

#### 4. cars (汽车表)
```sql
CREATE TABLE cars (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  brand TEXT NOT NULL,
  model TEXT NOT NULL,
  year INTEGER NOT NULL,
  type TEXT NOT NULL,                           -- sedan/suv/mpv/pickup/ev
  engine_type TEXT,
  displacement INTEGER,
  power TEXT,
  fuel_type TEXT NOT NULL,                      -- gasoline/diesel/hybrid/electric
  transmission TEXT,
  seats INTEGER,
  drive_type TEXT,                              -- fwd/rwd/awd
  price_min REAL,
  price_max REAL,
  features TEXT,                                -- JSON格式
  safety_features TEXT,                         -- JSON格式
  specifications TEXT,                          -- JSON格式
  rating REAL DEFAULT 0,
  view_count INTEGER DEFAULT 0,                 -- 浏览次数
  status TEXT DEFAULT 'active',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_cars_brand ON cars(brand);
CREATE INDEX idx_cars_type ON cars(type);
CREATE INDEX idx_cars_year ON cars(year);
CREATE INDEX idx_cars_fuel_type ON cars(fuel_type);
CREATE INDEX idx_cars_price ON cars(price_min, price_max);
```

#### 5. questions (问题表)
```sql
CREATE TABLE questions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  category TEXT NOT NULL,                       -- motorcycle/car
  subcategory TEXT,
  author_id TEXT NOT NULL,
  view_count INTEGER DEFAULT 0,                 -- 浏览次数
  votes_count INTEGER DEFAULT 0,
  answers_count INTEGER DEFAULT 0,
  has_accepted_answer BOOLEAN DEFAULT 0,
  status TEXT DEFAULT 'open',                   -- open/closed/deleted
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (author_id) REFERENCES users(id)
);

-- 索引
CREATE INDEX idx_questions_category ON questions(category);
CREATE INDEX idx_questions_author ON questions(author_id);
CREATE INDEX idx_questions_status ON questions(status);

-- 全文搜索
CREATE VIRTUAL TABLE questions_fts USING fts5(title, content, content='questions', content_rowid='rowid');
```

#### 6. answers (答案表)
```sql
CREATE TABLE answers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  question_id INTEGER NOT NULL,
  content TEXT NOT NULL,
  author_id TEXT NOT NULL,
  votes_count INTEGER DEFAULT 0,
  is_accepted BOOLEAN DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (question_id) REFERENCES questions(id) ON DELETE CASCADE,
  FOREIGN KEY (author_id) REFERENCES users(id)
);

-- 索引
CREATE INDEX idx_answers_question ON answers(question_id);
CREATE INDEX idx_answers_author ON answers(author_id);
CREATE INDEX idx_answers_is_accepted ON answers(is_accepted);
```

#### 7. marketplace_vehicles (二手交易表)
```sql
CREATE TABLE marketplace_vehicles (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  type TEXT NOT NULL,                           -- motorcycle/car
  brand TEXT NOT NULL,
  model TEXT NOT NULL,
  year INTEGER NOT NULL,
  price REAL NOT NULL,
  mileage INTEGER,
  condition_rating INTEGER,
  description TEXT,
  color TEXT,
  license_plate TEXT,
  city TEXT,
  district TEXT,
  address TEXT,
  seller_id TEXT NOT NULL,
  contact_name TEXT,
  contact_phone TEXT NOT NULL,
  contact_email TEXT,
  view_count INTEGER DEFAULT 0,                 -- 浏览次数
  favorites_count INTEGER DEFAULT 0,
  status TEXT DEFAULT 'active',                 -- active/sold/removed/expired
  featured BOOLEAN DEFAULT 0,
  verified BOOLEAN DEFAULT 0,
  expires_at DATETIME,
  sold_at DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (seller_id) REFERENCES users(id)
);

-- 索引
CREATE INDEX idx_marketplace_type ON marketplace_vehicles(type);
CREATE INDEX idx_marketplace_brand ON marketplace_vehicles(brand);
CREATE INDEX idx_marketplace_price ON marketplace_vehicles(price);
CREATE INDEX idx_marketplace_city ON marketplace_vehicles(city);
CREATE INDEX idx_marketplace_status ON marketplace_vehicles(status);
CREATE INDEX idx_marketplace_seller ON marketplace_vehicles(seller_id);
```

#### 8. images (图片表)
```sql
CREATE TABLE images (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  entity_type TEXT NOT NULL,                    -- news/motorcycle/car/listing/user
  entity_id INTEGER NOT NULL,
  url TEXT NOT NULL,
  thumbnail_url TEXT,
  alt_text TEXT,
  display_order INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_images_entity ON images(entity_type, entity_id);
```

**注意**：此表为扩展表，当前生产环境可能未使用。

#### 9. comments (评论表)
```sql
CREATE TABLE comments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  entity_type TEXT NOT NULL,                    -- news/question/answer/marketplace
  entity_id INTEGER NOT NULL,
  content TEXT NOT NULL,
  author_id TEXT NOT NULL,
  parent_id INTEGER,
  likes_count INTEGER DEFAULT 0,
  status TEXT DEFAULT 'active',                 -- active/hidden/deleted
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (author_id) REFERENCES users(id),
  FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE
);

-- 索引
CREATE INDEX idx_comments_entity ON comments(entity_type, entity_id);
CREATE INDEX idx_comments_author ON comments(author_id);
CREATE INDEX idx_comments_parent ON comments(parent_id);
```

#### 10. tags (标签表)
```sql
CREATE TABLE tags (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT UNIQUE NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  usage_count INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_tags_name ON tags(name);
CREATE INDEX idx_tags_slug ON tags(slug);
```

---

## 🔌 API设计

### RESTful API 端点

#### 新闻相关
```
GET    /api/news              # 获取新闻列表
GET    /api/news/:id          # 获取新闻详情
POST   /api/news              # 创建新闻 (管理员)
PUT    /api/news/:id          # 更新新闻 (管理员)
DELETE /api/news/:id          # 删除新闻 (管理员)
POST   /api/news/:id/like     # 点赞新闻
GET    /api/news/:id/related  # 获取相关新闻
```

#### 车型相关
```
GET    /api/motorcycles       # 获取摩托车列表
GET    /api/motorcycles/:id   # 获取摩托车详情
GET    /api/cars              # 获取汽车列表
GET    /api/cars/:id          # 获取汽车详情
POST   /api/vehicles/compare  # 车型对比
GET    /api/vehicles/brands   # 获取品牌列表
```

#### 问答相关
```
GET    /api/questions         # 获取问题列表
GET    /api/questions/:id     # 获取问题详情
POST   /api/questions         # 发布问题
PUT    /api/questions/:id     # 更新问题
DELETE /api/questions/:id     # 删除问题
POST   /api/questions/:id/vote # 投票
GET    /api/questions/:id/answers # 获取答案列表
POST   /api/questions/:id/answers # 发布答案
POST   /api/answers/:id/accept    # 采纳答案
POST   /api/answers/:id/vote      # 答案投票
```

#### 二手交易相关
```
GET    /api/listings          # 获取交易列表
GET    /api/listings/:id      # 获取交易详情
POST   /api/listings          # 发布交易
PUT    /api/listings/:id      # 更新交易
DELETE /api/listings/:id      # 删除交易
POST   /api/listings/:id/favorite # 收藏
GET    /api/listings/my       # 我的发布
```

#### 用户相关
```
POST   /api/auth/register     # 用户注册
POST   /api/auth/login        # 用户登录
POST   /api/auth/logout       # 用户登出
GET    /api/users/me          # 获取当前用户信息
PUT    /api/users/me          # 更新用户信息
GET    /api/users/:id         # 获取用户信息
POST   /api/users/avatar      # 上传头像
```

#### 搜索相关
```
GET    /api/search            # 全局搜索
GET    /api/search/news       # 搜索新闻
GET    /api/search/vehicles   # 搜索车型
GET    /api/search/questions  # 搜索问题
GET    /api/search/listings   # 搜索二手
```

---

## 🚀 部署方案（生产环境）

### 服务器环境
- **操作系统**: Alibaba Cloud Linux (内核 5.10.134)
- **Node.js**: 20.x
- **SQLite**: 3.x（系统自带）
- **Redis**: 7.x（可选）
- **Nginx**: 最新稳定版
- **服务管理**: Systemd

---

### Systemd 服务架构

#### 后端服务配置
**文件**: `/etc/systemd/system/vietnam-moto-backend.service`

```ini
[Unit]
Description=Vietnam Moto Auto Backend Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/var/www/vietnam-moto-auto/backend
Environment=NODE_ENV=production
EnvironmentFile=/var/www/vietnam-moto-auto/backend/.env.production
ExecStart=/usr/bin/node dist/index.js
Restart=always
RestartSec=10
StandardOutput=append:/var/www/vietnam-moto-auto/backend/logs/backend.log
StandardError=append:/var/www/vietnam-moto-auto/backend/logs/backend-error.log

[Install]
WantedBy=multi-user.target
```

**服务管理命令**：
```bash
# 启动服务
sudo systemctl start vietnam-moto-backend

# 停止服务
sudo systemctl stop vietnam-moto-backend

# 重启服务
sudo systemctl restart vietnam-moto-backend

# 查看状态
sudo systemctl status vietnam-moto-backend

# 查看日志
sudo journalctl -u vietnam-moto-backend -f

# 开机自启
sudo systemctl enable vietnam-moto-backend
```

---

### Nginx 反向代理配置

**文件**: `/etc/nginx/conf.d/vietnam-moto-auto.conf`

```nginx
# 后端上游
upstream vietnam_backend {
    server 127.0.0.1:4001;
    keepalive 64;
}

server {
    listen 80;
    server_name _;
    
    # 安全头
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    
    # 前端静态文件
    location / {
        root /var/www/vietnam-moto-auto/frontend/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
        
        # 静态资源缓存
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
        
        # HTML不缓存
        location ~* \.html$ {
            expires -1;
            add_header Cache-Control "no-cache, no-store, must-revalidate";
        }
    }
    
    # API代理
    location /api/ {
        proxy_pass http://vietnam_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
    
    # 健康检查
    location /health {
        proxy_pass http://vietnam_backend/health;
        access_log off;
    }
    
    # 上传文件访问
    location /uploads/ {
        alias /var/www/vietnam-moto-auto/backend/uploads/;
        expires 1y;
        add_header Cache-Control "public";
    }
    
    # Gzip压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript application/json application/javascript;
}
```

---

### 一键部署脚本

**文件**: `deploy.sh`

```bash
#!/bin/bash
# 越南摩托汽车网站 - 生产环境一键部署脚本

set -e

SOURCE_DIR="/root/越南摩托汽车网站"
TARGET_DIR="/var/www/vietnam-moto-auto"
BACKUP_DIR="/backup"

echo "🚀 开始部署越南摩托汽车网站到生产环境..."

# 1. 备份当前版本
if [ -d "$TARGET_DIR" ]; then
    echo "📦 备份当前版本..."
    tar -czf "$BACKUP_DIR/backup-$(date +%Y%m%d_%H%M%S).tar.gz" -C "$TARGET_DIR" .
fi

# 2. 复制项目文件
echo "📥 复制项目文件..."
rsync -av --exclude='node_modules' --exclude='dist' "$SOURCE_DIR/" "$TARGET_DIR/"

# 3. 安装后端依赖并编译
echo "📦 安装后端依赖..."
cd "$TARGET_DIR/backend"
npm install --omit=dev
npm run build

# 4. 安装前端依赖并构建
echo "🔨 构建前端..."
cd "$TARGET_DIR/frontend"
npm install
npm run build

# 5. 配置Systemd和Nginx
echo "⚙️ 配置服务..."
# ... 自动配置服务和Nginx

# 6. 重启服务
echo "🔄 重启服务..."
sudo systemctl restart vietnam-moto-backend
sudo systemctl reload nginx

# 7. 健康检查
echo "🏥 健康检查..."
curl -f http://localhost:4001/health

echo "✅ 部署完成！"
```

**使用方法**：
```bash
cd /root/越南摩托汽车网站
sudo ./deploy.sh
```

---

## 📊 性能优化策略

### 前端优化
1. **静态资源优化**
   - 图片懒加载和WebP格式
   - CSS和JS代码压缩和分割
   - 使用CDN加速静态资源
   - 字体子集化

2. **页面加载优化**
   - SSR/SSG混合渲染
   - 关键CSS内联
   - 预加载关键资源
   - 延迟加载非关键脚本

3. **缓存策略**
   - 浏览器缓存
   - Service Worker缓存
   - API响应缓存

### 后端优化
1. **数据库优化**
   - 索引优化
   - 查询优化
   - 连接池配置
   - 读写分离

2. **缓存策略**
   - Redis缓存热点数据
   - API响应缓存
   - 会话缓存

3. **并发处理**
   - PM2集群模式
   - 负载均衡
   - 请求队列

---

## 🔒 安全策略

### 认证与授权
- JWT Token认证
- 刷新Token机制
- 角色权限控制(RBAC)
- API访问频率限制

### 数据安全
- 密码加密存储(bcrypt)
- SQL注入防护
- XSS防护
- CSRF防护
- 文件上传验证
- 敏感数据加密

### 网络安全
- HTTPS/SSL证书
- HTTP安全头设置
- CORS跨域配置
- 防火墙规则
- DDoS防护

---

## 📈 监控与日志

### 应用监控
- 服务器资源监控
- 应用性能监控(APM)
- 错误追踪
- 用户行为分析

### 日志管理
- 应用日志(Winston)
- 访问日志(Nginx)
- 错误日志
- 审计日志
- 日志分析和归档

---

## 🧪 测试策略

### 前端测试
- 单元测试(Vitest)
- 组件测试(Testing Library)
- E2E测试(Playwright)
- 视觉回归测试

### 后端测试
- 单元测试(Jest)
- 集成测试
- API测试(Supertest)
- 性能测试

---

## 📝 开发流程

### Git工作流
```
main (生产环境)
  ↑
develop (开发环境)
  ↑
feature/xxx (功能分支)
```

### 代码规范
- ESLint规则
- Prettier格式化
- Husky Git Hooks
- Conventional Commits

### CI/CD流程
1. 代码提交
2. 自动化测试
3. 代码审查
4. 构建部署
5. 监控告警

---

## 📅 开发历程

### 第一阶段: 基础设施 ✅ 已完成
- [x] 项目初始化和架构设计
- [x] 数据库设计（从MySQL迁移到SQLite）
- [x] 前端框架搭建（Astro + React + TailwindCSS）
- [x] 后端API架构（Express + TypeScript + Sequelize）
- [x] 部署环境配置（Systemd + Nginx）

### 第二阶段: 核心功能 ✅ 已完成
- [x] 新闻模块开发（9个API端点，完整功能）
- [x] 摩托车展示模块（8个API端点，含爬虫数据）
- [x] 问答系统（基础框架，待完善）
- [x] 二手交易平台（基础框架，待完善）
- [x] 搜索功能（FTS5全文搜索）
- [x] 用户中心（基础框架，待完善）

### 第三阶段: 页面开发 ✅ 已完成
- [x] 首页（Hero + 新闻 + 车型展示）
- [x] 新闻模块（列表 + 3个详情页）
- [x] 摩托车模块（列表 + 3个详情页）
- [x] 汽车模块（列表 + 3个详情页）
- [x] 问答模块（列表 + 3个详情页）
- [x] 二手交易模块（列表 + 3个详情页）
- [x] 共21个静态页面完成

### 第四阶段: 数据采集 ✅ 已完成
- [x] Python爬虫系统（9个品牌，22款摩托车）
- [x] 数据导入脚本（TypeScript）
- [x] n8n Webhook集成
- [x] 自动化数据更新流程

### 第五阶段: 部署上线 ✅ 已完成
- [x] 生产环境部署（Systemd服务管理）
- [x] 数据库初始化和数据导入
- [x] Nginx反向代理配置
- [x] 监控和日志配置
- [x] 正式发布（http://47.237.79.9:4321）

### 第六阶段: 文档建设 ✅ 已完成
- [x] 项目总览文档（README.md）
- [x] 项目架构文档（本文档）
- [x] 数据库设计文档（980行）
- [x] 前端开发文档（1,246行）
- [x] 后端开发文档（1,522行）
- [x] API路由文档（1,553行）
- [x] 爬虫系统文档（1,840行）
- [x] 部署运维文档（406行）

### 下一阶段: 功能完善 🚧 进行中
- [ ] 完善汽车模块API
- [ ] 完善问答功能（投票、采纳）
- [ ] 完善二手交易功能
- [ ] 用户认证系统
- [ ] 评论系统
- [ ] 收藏和点赞功能
- [ ] 实时通知系统

---

## 📚 完整技术文档体系

### 8大核心文档（共9,421行）

| 文档 | 行数 | 大小 | 说明 |
|------|------|------|------|
| [README.md](./README.md) | 610行 | 12K | 项目总览和快速开始 |
| [项目架构开发文档.md](./项目架构开发文档.md) | 1,264行 | 34K | 完整技术架构（本文档） |
| [数据库设计文档.md](./数据库设计文档.md) | 980行 | 35K | SQLite数据库设计 |
| [前端页面设计开发文档.md](./前端页面设计开发文档.md) | 1,246行 | 24K | 前端UI和组件开发 |
| [后端服务开发文档.md](./后端服务开发文档.md) | 1,522行 | 32K | 后端服务架构 |
| [API路由开发文档.md](./API路由开发文档.md) | 1,553行 | 30K | 完整API接口文档 |
| [爬虫系统设计开发文档.md](./爬虫系统设计开发文档.md) | 1,840行 | 47K | 数据采集爬虫 |
| [生产环境部署文档.md](./生产环境部署文档.md) | 406行 | 8.7K | 部署和运维管理 |

**文档体系特点**：
- ✅ 覆盖从架构到部署的完整开发周期
- ✅ 包含大量实战代码示例
- ✅ 详细的API接口说明
- ✅ 完整的数据库设计
- ✅ 前后端开发指南
- ✅ 数据采集爬虫系统
- ✅ 一键部署和运维

---

## 👥 团队协作

### 角色分工
- **前端开发**: Astro + React开发
- **后端开发**: Node.js API开发
- **UI设计**: 界面和交互设计
- **运维**: 服务器和部署管理
- **测试**: 质量保证

### 沟通渠道
- 项目管理: GitHub Projects
- 代码仓库: GitHub
- 文档协作: Markdown
- 即时通讯: 团队协作工具

---

## 📞 联系信息

**项目负责人**: [待填写]  
**技术支持**: [待填写]  
**项目仓库**: [待填写]

---

## 🌐 访问信息

### 生产环境
- **前端网站**: http://47.237.79.9:4321
- **后端API**: http://47.237.79.9:4001/api
- **健康检查**: http://47.237.79.9:4001/health
- **Nginx代理**: http://47.237.79.9 (端口80，可选)

### 开发环境
- **前端**: http://localhost:4321
- **后端**: http://localhost:4001
- **数据库**: `./backend/database/vietnam_moto_auto.sqlite`

---

## 📊 项目成果

### 已完成功能
- ✅ **21个静态页面**（首页 + 各模块列表/详情）
- ✅ **19个API端点**（新闻9个 + 摩托车8个 + 健康检查2个）
- ✅ **10个数据表**（用户、新闻、车型、问答、二手交易等）
- ✅ **22款摩托车数据**（9个品牌真实数据）
- ✅ **完整UI系统**（Cursor主题 + 毛玻璃效果）
- ✅ **爬虫系统**（Python数据采集 + TypeScript导入）
- ✅ **部署方案**（Systemd + Nginx，开机自启）
- ✅ **8大技术文档**（9,421行完整文档）

### 技术亮点
- 🎨 **现代化UI**：Cursor主题 + Glassmorphism设计
- ⚡ **高性能**：Astro SSG + SQLite + FTS5全文搜索
- 🔒 **安全可靠**：JWT认证 + Helmet + CORS + 速率限制
- 🚀 **易于部署**：一键部署脚本 + Systemd管理
- 📚 **文档完善**：近万行技术文档覆盖所有环节

---

**文档版本**: v2.0.0（已更新为生产环境实际架构）  
**创建日期**: 2025年10月11日  
**最后更新**: 2025年10月12日  
**维护人员**: 开发团队  
**项目状态**: ✅ 生产环境运行中

