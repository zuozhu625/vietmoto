# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜è¶Šå—æ‘©æ‰˜æ±½è½¦èµ„è®¯ç½‘ç«™çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æµç¨‹ã€éƒ¨ç½²è„šæœ¬ä½¿ç”¨æ–¹æ³•å’Œå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
sudo bash ./deploy.sh
```

**ç‰¹ç‚¹ï¼š**
- âœ… å…¨è‡ªåŠ¨éƒ¨ç½²æµç¨‹ï¼ˆ12ä¸ªæ­¥éª¤ï¼‰
- âœ… ä¸‰é‡æ•°æ®åº“ä¿æŠ¤æœºåˆ¶
- âœ… è‡ªåŠ¨å›æ»šåŠŸèƒ½
- âœ… å®Œæ•´çš„éªŒè¯æ£€æŸ¥
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

---

## ğŸ“¦ éƒ¨ç½²è„šæœ¬åˆ—è¡¨

æœ¬é¡¹ç›®æä¾›äº†å¤šä¸ªéƒ¨ç½²è„šæœ¬ï¼Œé€‚ç”¨äºä¸åŒçš„éƒ¨ç½²åœºæ™¯ã€‚

### 1. **pre-deploy-check.sh** - éƒ¨ç½²å‰æ£€æŸ¥ â­ æ¨èå…ˆè¿è¡Œ

**è·¯å¾„**ï¼š`/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/pre-deploy-check.sh`

**ç”¨é€”**ï¼šåœ¨å®é™…éƒ¨ç½²å‰æ£€æŸ¥æ‰€æœ‰ä¾èµ–å’Œé…ç½®

**æ£€æŸ¥é¡¹ç›®**ï¼š
- âœ… ç³»ç»Ÿå‘½ä»¤ï¼ˆnode, npm, sqlite3, nginxç­‰ï¼‰
- âœ… Node.js ç‰ˆæœ¬ï¼ˆ>= 18ï¼‰
- âœ… é¡¹ç›®ç›®å½•ç»“æ„
- âœ… é…ç½®æ–‡ä»¶å®Œæ•´æ€§
- âœ… å¼€å‘ç¯å¢ƒæ•°æ®åº“ï¼ˆè¡¨ç»“æ„ã€æ•°æ®é‡ï¼‰
- âœ… ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ï¼ˆå¦‚å­˜åœ¨ï¼‰
- âœ… æ•°æ®åº“åŒæ­¥è„šæœ¬
- âœ… ç£ç›˜ç©ºé—´

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
./pre-deploy-check.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å¼€å§‹éƒ¨ç½²
  - æ‘©æ‰˜è½¦: 126 æ¡
  - æ±½è½¦: 124 æ¡
  - äºŒæ‰‹äº¤æ˜“: 0 æ¡
  - é—®ç­”: 11 æ¡
```

---

### 2. **quick-deploy.sh** - å¿«é€Ÿéƒ¨ç½² âš¡ æ¨èæ—¥å¸¸ä½¿ç”¨

**è·¯å¾„**ï¼š`/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/quick-deploy.sh`

**ç”¨é€”**ï¼šå¿«é€Ÿéƒ¨ç½²å•ä¸ªæ¨¡å—ï¼Œä¸è¿›è¡Œå®Œæ•´å¤‡ä»½

**ç‰¹ç‚¹**ï¼š
- âš¡ åªç¼–è¯‘å’Œéƒ¨ç½²æŒ‡å®šæ¨¡å—
- ğŸ’¾ ä¸åˆ›å»ºå®Œæ•´å¤‡ä»½ï¼ˆé€Ÿåº¦å¿«ï¼‰
- ğŸ¯ é€‚åˆæ—¥å¸¸å°æ”¹åŠ¨
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# åªéƒ¨ç½²å‰ç«¯ï¼ˆçº¦20ç§’ï¼‰
sudo ./quick-deploy.sh frontend

# åªéƒ¨ç½²åç«¯ï¼ˆçº¦15ç§’ï¼‰
sudo ./quick-deploy.sh backend
```

**æµç¨‹ï¼ˆå‰ç«¯ï¼‰**ï¼š
1. æ„å»ºå‰ç«¯ï¼ˆnpm run buildï¼‰
2. å¤åˆ¶æ–‡ä»¶åˆ°ç”Ÿäº§ç¯å¢ƒ
3. é‡å¯å‰ç«¯æœåŠ¡
4. å¥åº·æ£€æŸ¥

**æµç¨‹ï¼ˆåç«¯ï¼‰**ï¼š
1. ç¼–è¯‘ TypeScriptï¼ˆnpm run buildï¼‰
2. å¤åˆ¶æ–‡ä»¶åˆ°ç”Ÿäº§ç¯å¢ƒ
3. å®‰è£…ç”Ÿäº§ä¾èµ–
4. é‡å¯åç«¯æœåŠ¡
5. å¥åº·æ£€æŸ¥

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… å·²ä¿®å¤ Astro hybrid æ¨¡å¼æ„å»ºæ£€æŸ¥
- âœ… æ”¯æŒ dist/client å’Œ dist/server ç»“æ„
- âœ… è‡ªåŠ¨ç¦ç”¨ä»£ç†è¿›è¡Œå¥åº·æ£€æŸ¥

---

### 3. **deploy.sh** - å®Œæ•´éƒ¨ç½² ğŸ¯ å¤§ç‰ˆæœ¬æ›´æ–°

**è·¯å¾„**ï¼š`/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/deploy.sh`

**ç”¨é€”**ï¼šç”Ÿäº§ç¯å¢ƒå®Œæ•´éƒ¨ç½²è„šæœ¬ï¼ˆv3.1.0ï¼‰

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… **ä¸‰é‡æ•°æ®åº“ä¿æŠ¤**
  - ä¸´æ—¶å¤‡ä»½ï¼ˆç”¨äºç«‹å³æ¢å¤ï¼‰
  - æ°¸ä¹…å¤‡ä»½ï¼ˆgzipå‹ç¼©å½’æ¡£åˆ° `/backup/database/`ï¼‰
  - å®Œæ•´å›æ»šå¤‡ä»½ï¼ˆæ•´ä¸ªé¡¹ç›®å¿«ç…§ï¼‰
  
- âœ… **è‡ªåŠ¨å›æ»šæœºåˆ¶**
  - ä»»ä½•æ­¥éª¤å¤±è´¥è‡ªåŠ¨å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
  - ä½¿ç”¨ `trap` æ•è·æ‰€æœ‰é”™è¯¯
  - ä¿æŠ¤ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§

- âœ… **å®Œæ•´çš„éªŒè¯æ£€æŸ¥**
  - éƒ¨ç½²å‰ï¼šæƒé™ã€ç¯å¢ƒã€æ•°æ®åº“å®Œæ•´æ€§
  - éƒ¨ç½²ä¸­ï¼šç¼–è¯‘ç»“æœã€æ„å»ºäº§ç‰©
  - éƒ¨ç½²åï¼šæœåŠ¡å¥åº·æ£€æŸ¥ã€APIæµ‹è¯•

- âœ… **æ•°æ®åº“è¡¨ç»“æ„è‡ªåŠ¨åŒæ­¥** (v3.1.0 æ–°å¢)
  - è‡ªåŠ¨è¿è¡Œ sync-dev-to-prod.sql
  - éªŒè¯ marketplace_vehicles å’Œ reviews è¡¨
  - ç¡®ä¿å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸€è‡´

- âœ… **ä¸ä¾èµ–å¤–éƒ¨å·¥å…·**
  - ä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„ `tar` å‘½ä»¤
  - æ— éœ€å®‰è£… `rsync`

**éƒ¨ç½²æµç¨‹ï¼ˆ12ä¸ªæ­¥éª¤ï¼‰ï¼š**
```
æ­¥éª¤ 1/12: æƒé™æ£€æŸ¥
æ­¥éª¤ 2/12: ç¯å¢ƒæ£€æŸ¥ï¼ˆtar, node, npm, sqlite3, nginx, systemctlï¼‰
æ­¥éª¤ 3/12: æ•°æ®åº“å®‰å…¨å¤‡ä»½ï¼ˆå«å®Œæ•´æ€§æ£€æŸ¥ï¼‰
æ­¥éª¤ 4/12: å®Œæ•´å¤‡ä»½å½“å‰ç‰ˆæœ¬ï¼ˆç”¨äºå›æ»šï¼‰
æ­¥éª¤ 5/12: å‡†å¤‡ç›®æ ‡ç›®å½•
æ­¥éª¤ 6/12: å¤åˆ¶é¡¹ç›®æ–‡ä»¶ï¼ˆtaræ’é™¤æ•°æ®åº“ï¼‰
æ­¥éª¤ 7/12: æ¢å¤æ•°æ®åº“å¹¶åŒæ­¥è¡¨ç»“æ„ â­ v3.1.0 å¢å¼º
æ­¥éª¤ 8/12: å®‰è£…åç«¯ä¾èµ–
æ­¥éª¤ 9/12: ç¼–è¯‘ TypeScript
æ­¥éª¤ 10/12: æ„å»ºå‰ç«¯ï¼ˆAstro Hybridæ¨¡å¼ï¼‰â­ v3.1.0 ä¿®å¤
æ­¥éª¤ 11/12: é…ç½®ç”Ÿäº§ç¯å¢ƒ
æ­¥éª¤ 12/12: å¯åŠ¨æœåŠ¡
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# å®Œæ•´éƒ¨ç½²ï¼ˆæ¨èï¼‰
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
sudo bash ./deploy.sh

# æˆ–æŒ‡å®šæ¨¡å¼
sudo ./deploy.sh all        # å®Œæ•´éƒ¨ç½²ï¼ˆé»˜è®¤ï¼‰
sudo ./deploy.sh frontend   # åªéƒ¨ç½²å‰ç«¯ï¼ˆä½†ä¼šå¤‡ä»½ï¼‰
sudo ./deploy.sh backend    # åªéƒ¨ç½²åç«¯ï¼ˆä½†ä¼šå¤‡ä»½ï¼‰
sudo ./deploy.sh config     # åªæ›´æ–°é…ç½®
```

**é‡è¦æ›´æ–°ï¼ˆv3.1.0ï¼‰**ï¼š
- âœ… ä¿®å¤å‰ç«¯æ„å»ºæ£€æŸ¥ï¼ˆæ”¯æŒ Astro Hybrid æ¨¡å¼ï¼‰
- âœ… æ–°å¢æ•°æ®åº“è¡¨ç»“æ„è‡ªåŠ¨åŒæ­¥
- âœ… è‡ªåŠ¨éªŒè¯å…³é”®è¡¨ï¼ˆmarketplace_vehiclesã€reviewsï¼‰
- âœ… ä¿®æ­£å¼€å‘ç¯å¢ƒæ•°æ®åº“è·¯å¾„
- âœ… å®Œå–„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶

**éƒ¨ç½²è¾“å‡º**ï¼š
- å½©è‰²æ—¥å¿—è¾“å‡ºï¼ˆè“è‰²=ä¿¡æ¯ï¼Œç»¿è‰²=æˆåŠŸï¼Œé»„è‰²=è­¦å‘Šï¼Œçº¢è‰²=é”™è¯¯ï¼‰
- å®æ—¶è¿›åº¦åé¦ˆ
- æ¯ä¸ªæ­¥éª¤çš„è¯¦ç»†çŠ¶æ€

**éƒ¨ç½²å®Œæˆå**ï¼š
- æ˜¾ç¤ºè®¿é—®åœ°å€
- åˆ—å‡ºå¸¸ç”¨ç®¡ç†å‘½ä»¤
- æä¾›é‡è¦æ–‡ä»¶è·¯å¾„
- æ˜¾ç¤ºå›æ»šå¤‡ä»½ä½ç½®

---

### ğŸ“Š éƒ¨ç½²æµç¨‹å¯¹æ¯”

| ç‰¹æ€§ | pre-deploy-check | quick-deploy | deploy |
|------|-----------------|--------------|--------|
| **æ£€æŸ¥ä¾èµ–** | âœ… | âŒ | âœ… |
| **æ•°æ®åº“å¤‡ä»½** | âŒ | âŒ | âœ… |
| **è¡¨ç»“æ„åŒæ­¥** | âŒ | âŒ | âœ… |
| **å®Œæ•´å¤‡ä»½** | âŒ | âŒ | âœ… |
| **å¤±è´¥å›æ»š** | âŒ | âŒ | âœ… |
| **å¥åº·æ£€æŸ¥** | âŒ | âœ… | âœ… |
| **æ‰§è¡Œé€Ÿåº¦** | å¿«ï¼ˆå‡ ç§’ï¼‰ | å¿«ï¼ˆ15-20ç§’ï¼‰ | æ…¢ï¼ˆ2-3åˆ†é’Ÿï¼‰ |
| **é€‚ç”¨åœºæ™¯** | éƒ¨ç½²å‰æ£€æŸ¥ | æ—¥å¸¸å°æ›´æ–° | å¤§ç‰ˆæœ¬æ›´æ–° |

### ğŸ¯ ä½¿ç”¨å»ºè®®

**é¦–æ¬¡éƒ¨ç½²ï¼š**
```bash
# 1. å…ˆæ£€æŸ¥ç¯å¢ƒ
./pre-deploy-check.sh

# 2. å®Œæ•´éƒ¨ç½²
sudo ./deploy.sh
```

**æ—¥å¸¸å¼€å‘ï¼š**
```bash
# 1. æ£€æŸ¥ç¯å¢ƒï¼ˆå¯é€‰ï¼‰
./pre-deploy-check.sh

# 2. å¿«é€Ÿéƒ¨ç½²
sudo ./quick-deploy.sh frontend  # åªéƒ¨ç½²å‰ç«¯
sudo ./quick-deploy.sh backend   # æˆ–åªéƒ¨ç½²åç«¯
```

**å¤§ç‰ˆæœ¬æ›´æ–°ï¼š**
```bash
# 1. å¿…é¡»å…ˆæ£€æŸ¥
./pre-deploy-check.sh

# 2. å®Œæ•´éƒ¨ç½²ï¼ˆå¸¦å¤‡ä»½å’Œå›æ»šï¼‰
sudo ./deploy.sh
```

### ğŸ”§ å·²ä¿®å¤çš„å…³é”®é—®é¢˜ (v3.1.0)

#### é—®é¢˜ 1: å‰ç«¯æ„å»ºæ£€æŸ¥å¤±è´¥
**åŸå› **ï¼šAstro hybrid æ¨¡å¼ç”Ÿæˆ `dist/client` å’Œ `dist/server`ï¼Œè€Œä¸æ˜¯ `dist/index.html`

**ä¿®å¤**ï¼š
```bash
# ä¿®å¤å‰
if [ ! -f "dist/index.html" ]; then
    log_error "æ„å»ºå¤±è´¥"
fi

# ä¿®å¤å
if [ ! -d "dist/client" ] && [ ! -d "dist/server" ] && [ ! -f "dist/index.html" ]; then
    log_error "æ„å»ºå¤±è´¥"
fi
```

**å½±å“è„šæœ¬**ï¼š`quick-deploy.sh`ã€`deploy.sh`

#### é—®é¢˜ 2: æ•°æ®åº“è¡¨ç»“æ„ä¸åŒæ­¥
**åŸå› **ï¼šæ–°å¢çš„ `marketplace_vehicles` å’Œ `reviews` è¡¨åœ¨éƒ¨ç½²æ—¶æœªè‡ªåŠ¨åˆ›å»º

**ä¿®å¤**ï¼šåœ¨ `deploy.sh` çš„æ­¥éª¤ 7 ä¸­æ–°å¢è¡¨ç»“æ„åŒæ­¥
```bash
# åŒæ­¥æ•°æ®åº“è¡¨ç»“æ„
if [ -f "$SOURCE_DIR/backend/database/sync-dev-to-prod.sql" ]; then
    sqlite3 "$TARGET_DIR/$DB_FILE" < "$SOURCE_DIR/backend/database/sync-dev-to-prod.sql"
    log_success "æ•°æ®åº“è¡¨ç»“æ„å·²åŒæ­¥"
fi

# éªŒè¯å…³é”®è¡¨
if echo "$TABLES" | grep -q "marketplace_vehicles"; then
    log_success "âœ… marketplace_vehicles è¡¨å­˜åœ¨"
else
    log_warning "âš ï¸  marketplace_vehicles è¡¨ä¸å­˜åœ¨"
fi
```

#### é—®é¢˜ 3: å¼€å‘ç¯å¢ƒæ•°æ®åº“è·¯å¾„é”™è¯¯
**åŸå› **ï¼šè·¯å¾„ç¡¬ç¼–ç ä¸º `backend/vietnam_moto_auto.sqlite`ï¼Œå®é™…ä¸º `backend/database/vietnam_moto_auto.sqlite`

**ä¿®å¤**ï¼š
```bash
# ä¿®å¤å‰
SOURCE_DIR/backend/vietnam_moto_auto.sqlite

# ä¿®å¤å
SOURCE_DIR/backend/database/vietnam_moto_auto.sqlite
```

---

### 4. **backup-database.sh** ï¼ˆæ•°æ®åº“å¤‡ä»½ï¼‰

**è·¯å¾„**ï¼š`/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backup-database.sh`

**ç”¨é€”**ï¼šSQLite æ•°æ®åº“å¤‡ä»½è„šæœ¬

**ç‰¹ç‚¹**ï¼š
- âœ… è‡ªåŠ¨å¤‡ä»½ SQLite æ•°æ®åº“
- âœ… è‡ªåŠ¨å‹ç¼©å¤‡ä»½æ–‡ä»¶ï¼ˆgzipï¼‰
- âœ… è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™30å¤©ï¼‰
- âœ… éªŒè¯å¤‡ä»½å®Œæ•´æ€§
- âœ… æ˜¾ç¤ºå¤‡ä»½ç»Ÿè®¡ä¿¡æ¯

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
./backup-database.sh
```

**å¤‡ä»½ä½ç½®**ï¼š
```
/backup/database/vietnam_moto_auto_YYYYMMDD_HHMMSS.sqlite.gz
```

**æ¢å¤å‘½ä»¤**ï¼š
```bash
# 1. åœæ­¢åç«¯æœåŠ¡
sudo systemctl stop vietnam-moto-backend

# 2. è§£å‹å¹¶æ¢å¤æ•°æ®åº“
gunzip -c /backup/database/vietnam_moto_auto_20251012_020000.sqlite.gz > \
  /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite

# 3. å¯åŠ¨åç«¯æœåŠ¡
sudo systemctl start vietnam-moto-backend
```

**å®šæ—¶å¤‡ä»½è®¾ç½®**ï¼š
```bash
# ç¼–è¾‘ crontab
sudo crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨å¤‡ä»½ï¼‰
0 2 * * * /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backup-database.sh >> /var/log/db-backup.log 2>&1
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯æ ˆ

**å‰ç«¯ï¼š**
- Astro 4.x - é™æ€ç«™ç‚¹ç”Ÿæˆå™¨
- React 18 - UIç»„ä»¶åº“
- TailwindCSS - CSSæ¡†æ¶
- TypeScript - ç±»å‹å®‰å…¨

**åç«¯ï¼š**
- Node.js 20+ - è¿è¡Œç¯å¢ƒ
- Express.js 5.x - Webæ¡†æ¶
- SQLite 3.x - è½»é‡çº§æ•°æ®åº“
- Sequelize - ORMå·¥å…·
- TypeScript - ç±»å‹å®‰å…¨

**éƒ¨ç½²ï¼š**
- Systemd - æœåŠ¡ç®¡ç†
- Nginx - åå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡

---

## ğŸŒ ç«¯å£å’Œè®¿é—®é…ç½®

### ç«¯å£åˆ†é…

| æœåŠ¡ | ç«¯å£ | ç”¨é€” | è®¿é—®æ–¹å¼ |
|------|------|------|----------|
| **Astro å‰ç«¯** | **4321** | **å‰ç«¯é¢„è§ˆæœåŠ¡** | **å¤–éƒ¨ï¼ˆç”Ÿäº§ç¯å¢ƒä¸»è¦å…¥å£ï¼‰** |
| Node.js åç«¯ | 4001 | APIæœåŠ¡ | å†…éƒ¨ + å¤–éƒ¨ |
| Nginx | 80 | é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆå¤‡ç”¨ï¼‰ | å¤–éƒ¨ |

### è®¿é—®åœ°å€

**âš ï¸ é‡è¦è¯´æ˜ï¼š4321 æ˜¯ç”Ÿäº§ç¯å¢ƒç«¯å£ï¼**

**å‰ç«¯é¡µé¢ï¼ˆæ¨èï¼‰ï¼š**
```
ä¸»è¦åœ°å€: http://47.237.79.9:4321/  ï¼ˆAstro Preview - ç”Ÿäº§ç¯å¢ƒï¼‰
å¤‡ç”¨åœ°å€: http://47.237.79.9/       ï¼ˆNginxé™æ€æ–‡ä»¶ï¼‰
```

**åç«¯APIï¼š**
```
ç›´æ¥è®¿é—®: http://47.237.79.9:4001/api/vehicles/motorcycles
å¥åº·æ£€æŸ¥: http://47.237.79.9:4001/health
```

### ç«¯å£è¯´æ˜

- **4321ç«¯å£**ï¼š**ç”Ÿäº§ç¯å¢ƒçš„å‰ç«¯æœåŠ¡ç«¯å£**
  - è¿è¡Œ `npm run preview` å¯åŠ¨Astroé¢„è§ˆæœåŠ¡
  - é€šè¿‡ systemd æœåŠ¡ `vietnam-moto-frontend` ç®¡ç†
  - ç›‘å¬ `0.0.0.0:4321`ï¼ˆå…è®¸å¤–éƒ¨è®¿é—®ï¼‰
  
- **4001ç«¯å£**ï¼šåç«¯APIæœåŠ¡ç«¯å£
  - Express.js åº”ç”¨
  - é€šè¿‡ systemd æœåŠ¡ `vietnam-moto-backend` ç®¡ç†
  
- **80ç«¯å£**ï¼šNginxå¤‡ç”¨è®¿é—®ï¼ˆé™æ€æ–‡ä»¶ï¼‰
  - æœåŠ¡å™¨ä¸Šæœ‰å¤šä¸ªç½‘ç«™å…±å­˜
  - éœ€è¦é€šè¿‡ `server_name` åŒºåˆ†ä¸åŒç½‘ç«™

---

## ğŸ“ é‡è¦æ–‡ä»¶å’Œç›®å½•

### é¡¹ç›®ç›®å½•ç»“æ„

```
æºç ç›®å½•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/
â”œâ”€â”€ backend/              # åç«¯æºç 
â”‚   â”œâ”€â”€ src/             # TypeScriptæºç 
â”‚   â”œâ”€â”€ database/        # æ•°æ®åº“æ–‡ä»¶
â”‚   â””â”€â”€ dist/            # ç¼–è¯‘åçš„JSæ–‡ä»¶
â”œâ”€â”€ frontend/            # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ src/             # Astro/Reactæºç 
â”‚   â””â”€â”€ dist/            # æ„å»ºåçš„é™æ€æ–‡ä»¶
â”œâ”€â”€ docs/                # å¼€å‘æ–‡æ¡£
â”œâ”€â”€ deploy.sh            # éƒ¨ç½²è„šæœ¬ v2.0
â””â”€â”€ backup-database.sh   # æ•°æ®åº“å¤‡ä»½è„šæœ¬

ç”Ÿäº§ç›®å½•
/var/www/vietnam-moto-auto/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ dist/            # åç«¯è¿è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ database/        # ç”Ÿäº§æ•°æ®åº“
â”‚   â”œâ”€â”€ logs/            # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ uploads/         # ä¸Šä¼ æ–‡ä»¶
â”‚   â””â”€â”€ .env.production  # ç”Ÿäº§ç¯å¢ƒå˜é‡
â””â”€â”€ frontend/
    â””â”€â”€ dist/            # å‰ç«¯é™æ€æ–‡ä»¶

å¤‡ä»½ç›®å½•
/backup/
â”œâ”€â”€ database/            # æ•°æ®åº“å¤‡ä»½ï¼ˆæ°¸ä¹…ï¼‰
â””â”€â”€ deployment_YYYYMMDD_HHMMSS/  # å›æ»šå¤‡ä»½ï¼ˆä¸´æ—¶ï¼‰
```

### é…ç½®æ–‡ä»¶ä½ç½®

**å‰ç«¯é…ç½®ï¼ˆâš ï¸ é‡è¦ï¼‰ï¼š**
```
# Astroé…ç½®ï¼ˆæºæ–‡ä»¶ - éƒ¨ç½²è„šæœ¬ä¼šä»è¿™é‡Œå¤åˆ¶ï¼‰
/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/astro.config.mjs

# ç¯å¢ƒå˜é‡ï¼ˆæºæ–‡ä»¶ - éƒ¨ç½²è„šæœ¬ä¼šä»è¿™é‡Œå¤åˆ¶ï¼‰
/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/.env.production

# ç”Ÿäº§ç¯å¢ƒé…ç½®
/var/www/vietnam-moto-auto/frontend/astro.config.mjs
/var/www/vietnam-moto-auto/frontend/.env.production
```

**å…³é”®é…ç½®å†…å®¹ï¼š**

`astro.config.mjs` å¿…é¡»åŒ…å«ï¼š
```javascript
export default defineConfig({
  output: 'static',
  integrations: [react()],
  server: {
    host: '0.0.0.0',  // âš ï¸ å¿…é¡»æ˜¯0.0.0.0ï¼Œå…è®¸å¤–éƒ¨è®¿é—®ï¼
    port: 4321
  },
  vite: {
    plugins: [tailwindcss()]
  }
});
```

`.env.production` å†…å®¹ï¼š
```
PUBLIC_API_URL=http://47.237.79.9:4001
```

**åç«¯ç¯å¢ƒå˜é‡ï¼š**
```
/var/www/vietnam-moto-auto/backend/.env.production
```

**Systemd æœåŠ¡ï¼š**
```
/etc/systemd/system/vietnam-moto-frontend.service  (å‰ç«¯æœåŠ¡ - 4321ç«¯å£)
/etc/systemd/system/vietnam-moto-backend.service   (åç«¯æœåŠ¡ - 4001ç«¯å£)
```

**Nginx é…ç½®ï¼š**
```
# æºæ–‡ä»¶ï¼ˆâš ï¸ é‡è¦ï¼éƒ¨ç½²è„šæœ¬ä¼šä»è¿™é‡Œå¤åˆ¶ï¼‰
/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/nginx/vietnam-moto-auto.conf

# ç”Ÿäº§ç¯å¢ƒé…ç½®
/etc/nginx/conf.d/vietnam-moto-auto.conf
```

**Nginxé…ç½®å…³é”®ç‚¹ï¼š**
```nginx
server {
    listen 80;
    server_name 47.237.79.9 localhost;  # âš ï¸ å¿…é¡»æŒ‡å®šIPï¼Œä¸èƒ½ç”¨ _ ï¼
    # ...
}
```

**æ•°æ®åº“æ–‡ä»¶ï¼š**
```
å¼€å‘: /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backend/database/vietnam_moto_auto.sqlite
ç”Ÿäº§: /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite
```

---

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

### Systemd æœåŠ¡ç®¡ç†

**âš ï¸ æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒæœ‰ä¸¤ä¸ªæœåŠ¡éœ€è¦ç®¡ç†ï¼**
- `vietnam-moto-frontend` - å‰ç«¯æœåŠ¡ï¼ˆ4321ç«¯å£ï¼‰
- `vietnam-moto-backend` - åç«¯æœåŠ¡ï¼ˆ4001ç«¯å£ï¼‰

#### å‰ç«¯æœåŠ¡ç®¡ç†

**æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š**
```bash
sudo systemctl status vietnam-moto-frontend
```

**é‡å¯æœåŠ¡ï¼š**
```bash
sudo systemctl restart vietnam-moto-frontend
```

**æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š**
```bash
sudo journalctl -u vietnam-moto-frontend -f
```

**å¯ç”¨å¼€æœºè‡ªå¯ï¼š**
```bash
sudo systemctl enable vietnam-moto-frontend
```

#### åç«¯æœåŠ¡ç®¡ç†

**æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š**
```bash
sudo systemctl status vietnam-moto-backend
```

**é‡å¯æœåŠ¡ï¼š**
```bash
sudo systemctl restart vietnam-moto-backend
```

**åœæ­¢æœåŠ¡ï¼š**
```bash
sudo systemctl stop vietnam-moto-backend
```

**å¯åŠ¨æœåŠ¡ï¼š**
```bash
sudo systemctl start vietnam-moto-backend
```

**æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š**
```bash
sudo journalctl -u vietnam-moto-backend -f
```

**æŸ¥çœ‹æœ€è¿‘æ—¥å¿—ï¼š**
```bash
sudo journalctl -u vietnam-moto-backend -n 50
```

**å¯ç”¨å¼€æœºè‡ªå¯ï¼š**
```bash
sudo systemctl enable vietnam-moto-backend
```

#### åŒæ—¶ç®¡ç†ä¸¤ä¸ªæœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
sudo systemctl restart vietnam-moto-frontend vietnam-moto-backend

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
systemctl is-active vietnam-moto-frontend vietnam-moto-backend nginx
```

### Nginx ç®¡ç†

**æµ‹è¯•é…ç½®ï¼š**
```bash
sudo nginx -t
```

**é‡æ–°åŠ è½½é…ç½®ï¼ˆæ— ç¼åˆ‡æ¢ï¼Œä¸åœæœºï¼‰ï¼š**
```bash
sudo systemctl reload nginx
```

**é‡å¯ Nginxï¼š**
```bash
sudo systemctl restart nginx
```

**æŸ¥çœ‹çŠ¶æ€ï¼š**
```bash
sudo systemctl status nginx
```

**æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼š**
```bash
tail -f /var/log/nginx/vietnam-moto-auto.access.log
```

**æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š**
```bash
tail -f /var/log/nginx/vietnam-moto-auto.error.log
```

---

## ğŸ”„ æ›´æ–°å’Œéƒ¨ç½²æµç¨‹

### å¿«é€Ÿæ›´æ–°ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- ä»£ç ä¿®æ”¹åé‡æ–°éƒ¨ç½²
- ä¾èµ–åŒ…æ›´æ–°
- é…ç½®æ–‡ä»¶ä¿®æ”¹

**æ­¥éª¤ï¼š**
```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
sudo bash ./deploy.sh
```

**è„šæœ¬è‡ªåŠ¨å®Œæˆï¼š**
1. âœ… å¤‡ä»½å½“å‰ç‰ˆæœ¬å’Œæ•°æ®åº“
2. âœ… å¤åˆ¶æ–°ä»£ç ï¼ˆæ’é™¤æ•°æ®åº“ï¼‰
3. âœ… å®‰è£…ä¾èµ–
4. âœ… ç¼–è¯‘å’Œæ„å»º
5. âœ… é…ç½®ç¯å¢ƒ
6. âœ… é‡å¯æœåŠ¡
7. âœ… å¥åº·æ£€æŸ¥

### ä»…æ›´æ–°å‰ç«¯

```bash
cd /var/www/vietnam-moto-auto/frontend
npm run build
sudo systemctl reload nginx
```

### ä»…æ›´æ–°åç«¯

```bash
cd /var/www/vietnam-moto-auto/backend
npm run build
sudo systemctl restart vietnam-moto-backend
```

### å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬

**å¦‚æœéƒ¨ç½²å¤±è´¥ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å›æ»šã€‚æ‰‹åŠ¨å›æ»šï¼š**

```bash
# 1. æ‰¾åˆ°æœ€è¿‘çš„å›æ»šå¤‡ä»½
ls -lt /backup/ | grep deployment

# 2. åœæ­¢æœåŠ¡
sudo systemctl stop vietnam-moto-backend

# 3. æ¢å¤å¤‡ä»½
sudo rm -rf /var/www/vietnam-moto-auto
sudo mv /backup/deployment_20251012_020142 /var/www/vietnam-moto-auto

# 4. é‡å¯æœåŠ¡
sudo systemctl start vietnam-moto-backend
sudo systemctl reload nginx
```

---

## ğŸ“Š æ•°æ®åº“ç®¡ç†

### æ•°æ®åº“é…ç½®

**ç±»å‹**ï¼šSQLite 3.x

**ä½ç½®**ï¼š
```
å¼€å‘: /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backend/database/vietnam_moto_auto.sqlite
ç”Ÿäº§: /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite
```

**ç‰¹æ€§**ï¼š
- WALæ¨¡å¼ï¼ˆWrite-Ahead Loggingï¼‰
- å¤–é”®çº¦æŸå¯ç”¨
- FTS5å…¨æ–‡æœç´¢
- JSONå­—æ®µæ”¯æŒ

### æ•°æ®åº“å¤‡ä»½

**æ‰‹åŠ¨å¤‡ä»½ï¼š**
```bash
./backup-database.sh
```

**è‡ªåŠ¨å¤‡ä»½ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰ï¼š**
```bash
sudo crontab -e
# æ·»åŠ ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backup-database.sh >> /var/log/db-backup.log 2>&1
```

**æŸ¥çœ‹å¤‡ä»½ï¼š**
```bash
ls -lh /backup/database/
```

### æ•°æ®åº“æ¢å¤

```bash
# åœæ­¢æœåŠ¡
sudo systemctl stop vietnam-moto-backend

# æ¢å¤æ•°æ®åº“
gunzip -c /backup/database/vietnam_moto_auto_YYYYMMDD_HHMMSS.sqlite.gz > \
  /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite

# è®¾ç½®æƒé™
chmod 666 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite

# å¯åŠ¨æœåŠ¡
sudo systemctl start vietnam-moto-backend
```

---

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### åº”ç”¨æ—¥å¿—

**åç«¯æ—¥å¿—ï¼š**
```bash
# æ ‡å‡†è¾“å‡ºæ—¥å¿—
tail -f /var/www/vietnam-moto-auto/backend/logs/backend.log

# é”™è¯¯æ—¥å¿—
tail -f /var/www/vietnam-moto-auto/backend/logs/backend-error.log

# Systemdæ—¥å¿—
sudo journalctl -u vietnam-moto-backend -f
```

**Nginxæ—¥å¿—ï¼š**
```bash
# è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/vietnam-moto-auto.access.log

# é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/vietnam-moto-auto.error.log
```

### å¥åº·æ£€æŸ¥

**åç«¯å¥åº·æ£€æŸ¥ï¼š**
```bash
curl http://localhost:4001/health
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "status": "OK",
  "timestamp": "2025-10-12T02:14:59.253Z",
  "uptime": 123.456,
  "environment": "production"
}
```

**å‰ç«¯å¥åº·æ£€æŸ¥ï¼š**
```bash
curl -I http://localhost:4321/
```

**é¢„æœŸå“åº”ï¼š**
```
HTTP/1.1 200 OK
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. éƒ¨ç½²å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**è„šæœ¬ä¼šè‡ªåŠ¨å›æ»šï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚**

**æŸ¥çœ‹å¤±è´¥åŸå› ï¼š**
```bash
# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
cat /var/log/vietnam-moto-deploy.log

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status vietnam-moto-frontend
sudo systemctl status vietnam-moto-backend

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u vietnam-moto-frontend -n 100
sudo journalctl -u vietnam-moto-backend -n 100
```

### 2. ç½‘ç«™æ— æ³•è®¿é—®ï¼ˆ4321ç«¯å£ï¼‰ï¼Ÿâš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜Aï¼š4321ç«¯å£æ‰“ä¸å¼€**

**åŸå› **ï¼šå‰ç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç›‘å¬é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥å‰ç«¯æœåŠ¡çŠ¶æ€
sudo systemctl status vietnam-moto-frontend

# 2. å¦‚æœæœåŠ¡æœªè¿è¡Œï¼Œå¯åŠ¨å®ƒ
sudo systemctl start vietnam-moto-frontend

# 3. æ£€æŸ¥ç«¯å£ç›‘å¬ï¼ˆå¿…é¡»æ˜¯0.0.0.0:4321ï¼Œä¸æ˜¯::1:4321ï¼‰
netstat -tlnp | grep 4321

# 4. å¦‚æœåªç›‘å¬æœ¬åœ°ï¼ˆ::1ï¼‰ï¼Œæ£€æŸ¥é…ç½®
cat /var/www/vietnam-moto-auto/frontend/astro.config.mjs

# 5. ç¡®ä¿é…ç½®åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
server: {
  host: '0.0.0.0',
  port: 4321
}

# 6. é‡å¯æœåŠ¡
sudo systemctl restart vietnam-moto-frontend
```

**é—®é¢˜Bï¼š80ç«¯å£è¢«å…¶ä»–ç½‘ç«™æ‹¦æˆª**

**åŸå› **ï¼šæœåŠ¡å™¨ä¸Šæœ‰å¤šä¸ªç½‘ç«™ï¼ŒNginxé…ç½®å†²çª

**ç—‡çŠ¶**ï¼šè®¿é—® http://47.237.79.9 è¢«é‡å®šå‘åˆ°å…¶ä»–ç½‘ç«™ï¼ˆå¦‚cryptopulse.workï¼‰

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥Nginxé…ç½®ä¸­çš„server_name
cat /etc/nginx/conf.d/vietnam-moto-auto.conf | grep server_name

# 2. å¿…é¡»æŒ‡å®šå…·ä½“IPæˆ–åŸŸåï¼Œä¸èƒ½ç”¨é€šé…ç¬¦ _
# æ­£ç¡®é…ç½®ï¼š
server_name 47.237.79.9 localhost;

# é”™è¯¯é…ç½®ï¼š
server_name _;  # è¿™ä¸ªä¼˜å…ˆçº§å¤ªä½ï¼Œä¼šè¢«å…¶ä»–é…ç½®è¦†ç›–

# 3. ä¿®æ”¹æºæ–‡ä»¶ï¼ˆé‡è¦ï¼ï¼‰
vi /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/nginx/vietnam-moto-auto.conf

# 4. åˆ é™¤å†²çªçš„é…ç½®æ–‡ä»¶
ls /etc/nginx/conf.d/*.conf  # æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–80ç«¯å£é…ç½®
sudo rm /etc/nginx/conf.d/cryptopulse-*.conf  # åˆ é™¤ä¸ç”¨çš„é…ç½®

# 5. é‡æ–°éƒ¨ç½²
sudo ./deploy.sh
```

### 3. ç½‘ç«™æ£€æŸ¥æ­¥éª¤

**å®Œæ•´æ£€æŸ¥æµç¨‹ï¼š**

```bash
# 1. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E "4321|4001|:80 "
# åº”è¯¥çœ‹åˆ°ï¼š
# 0.0.0.0:4321  (å‰ç«¯)
# :::4001       (åç«¯)
# 0.0.0.0:80    (Nginx)

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl is-active vietnam-moto-frontend vietnam-moto-backend nginx
# åº”è¯¥éƒ½æ˜¯ active

# 3. æµ‹è¯•æœ¬åœ°è®¿é—®
curl -I http://localhost:4321/
curl http://localhost:4001/health

# 4. æµ‹è¯•å¤–éƒ¨è®¿é—®
curl -I http://47.237.79.9:4321/
curl http://47.237.79.9:4001/health
```

### 4. å‰ç«¯ä¿®æ”¹ä¸ç”Ÿæ•ˆï¼Ÿ

**åŸå› ï¼š**æµè§ˆå™¨ç¼“å­˜æˆ–æ„å»ºç¼“å­˜

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ¸…é™¤æ„å»ºç¼“å­˜
cd /var/www/vietnam-moto-auto/frontend
rm -rf dist node_modules/.vite

# 2. é‡æ–°æ„å»º
npm run build

# 3. é‡å¯å‰ç«¯æœåŠ¡ï¼ˆé‡è¦ï¼ï¼‰
sudo systemctl restart vietnam-moto-frontend

# 4. å¦‚æœä½¿ç”¨Nginxè®¿é—®ï¼Œä¹Ÿé‡æ–°åŠ è½½Nginx
sudo systemctl reload nginx

# 5. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# Ctrl+Shift+R (Chrome/Firefox)
```

### 5. åç«¯ä¿®æ”¹ä¸ç”Ÿæ•ˆï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. é‡æ–°ç¼–è¯‘
cd /var/www/vietnam-moto-auto/backend
npm run build

# 2. æ£€æŸ¥ç¼–è¯‘ç»“æœ
ls -la dist/

# 3. é‡å¯æœåŠ¡
sudo systemctl restart vietnam-moto-backend

# 4. æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u vietnam-moto-backend -f
```

### 6. æ•°æ®åº“é”™è¯¯ï¼Ÿ

**å¸¸è§é”™è¯¯ï¼š**
- `SQLITE_ERROR: no such column`
- `SQLITE_BUSY: database is locked`

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -lh /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite

# 2. æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
sqlite3 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite \
  "PRAGMA integrity_check;"

# 3. å¦‚æœæŸåï¼Œæ¢å¤æœ€è¿‘å¤‡ä»½
gunzip -c /backup/database/vietnam_moto_auto_YYYYMMDD.sqlite.gz > \
  /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite

# 4. é‡å¯æœåŠ¡
sudo systemctl restart vietnam-moto-backend
```

### 7. APIè¿”å›500é”™è¯¯ï¼Ÿ

**æ£€æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æŸ¥çœ‹åç«¯é”™è¯¯æ—¥å¿—
tail -50 /var/www/vietnam-moto-auto/backend/logs/backend-error.log

# 2. æŸ¥çœ‹Systemdæ—¥å¿—
sudo journalctl -u vietnam-moto-backend -n 50

# 3. æµ‹è¯•æ•°æ®åº“è¿æ¥
sqlite3 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite \
  "SELECT COUNT(*) FROM motorcycles;"

# 4. æ£€æŸ¥ç¯å¢ƒå˜é‡
cat /var/www/vietnam-moto-auto/backend/.env.production
```

### 8. ç«¯å£å†²çªï¼Ÿ

**é—®é¢˜ï¼š**80ç«¯å£è¢«å…¶ä»–æœåŠ¡å ç”¨

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹å ç”¨80ç«¯å£
sudo lsof -i :80

# ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼ˆå·²ä½¿ç”¨4321å’Œ8088ï¼‰
sudo vi /etc/nginx/conf.d/vietnam-moto-auto.conf
# ä¿®æ”¹ listen 80; ä¸º listen 4321;

# é‡æ–°åŠ è½½Nginx
sudo nginx -t
sudo systemctl reload nginx
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### éƒ¨ç½²å‰

1. **å¤‡ä»½æ•°æ®åº“**
   ```bash
   ./backup-database.sh
   ```

2. **åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•**
   ```bash
   cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend
   npm run dev
   
   cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backend
   npm run dev
   ```

3. **ä»£ç æ£€æŸ¥**
   ```bash
   npm run lint
   npm run build  # ç¡®ä¿ç¼–è¯‘æˆåŠŸ
   ```

### éƒ¨ç½²ä¸­

1. **ä½¿ç”¨éƒ¨ç½²è„šæœ¬**
   ```bash
   sudo bash ./deploy.sh
   ```

2. **è§‚å¯Ÿæ—¥å¿—è¾“å‡º**
   - ç¡®è®¤æ¯ä¸ªæ­¥éª¤éƒ½æˆåŠŸ
   - æ³¨æ„è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯

3. **ä¸è¦æ‰‹åŠ¨ä¸­æ–­**
   - è„šæœ¬æœ‰è‡ªåŠ¨å›æ»šæœºåˆ¶
   - ä¸­æ–­å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´çŠ¶æ€

### éƒ¨ç½²å

1. **éªŒè¯éƒ¨ç½²ç»“æœ**
   ```bash
   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
   sudo systemctl status vietnam-moto-backend
   
   # æµ‹è¯•API
   curl http://localhost:4321/api/vehicles/motorcycles?limit=1
   
   # è®¿é—®ç½‘ç«™
   curl -I http://localhost:4321/
   ```

2. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   # æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯
   tail -50 /var/www/vietnam-moto-auto/backend/logs/backend-error.log
   ```

3. **æµè§ˆå™¨æµ‹è¯•**
   - æ‰“å¼€ç½‘ç«™é¦–é¡µ
   - æµ‹è¯•ä¸»è¦åŠŸèƒ½
   - æ£€æŸ¥æ•°æ®æ˜¾ç¤º

4. **æ¸…ç†ä¸´æ—¶æ–‡ä»¶**
   ```bash
   # ç¡®è®¤éƒ¨ç½²æˆåŠŸåï¼Œå¯åˆ é™¤å›æ»šå¤‡ä»½
   rm -rf /backup/deployment_YYYYMMDD_HHMMSS
   ```

### å®šæœŸç»´æŠ¤

1. **æ¯æ—¥è‡ªåŠ¨å¤‡ä»½**
   ```bash
   # è®¾ç½®cronä»»åŠ¡
   0 2 * * * /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backup-database.sh
   ```

2. **æ¯å‘¨æ£€æŸ¥æ—¥å¿—**
   ```bash
   # æŸ¥çœ‹é”™è¯¯æ—¥å¿—
   grep -i error /var/www/vietnam-moto-auto/backend/logs/backend-error.log
   ```

3. **æ¯æœˆæ¸…ç†æ—§å¤‡ä»½**
   ```bash
   # ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½ï¼Œåˆ é™¤æ›´æ—©çš„
   find /backup/database -name "*.sqlite.gz" -mtime +30 -delete
   ```

---

---

## ğŸ“‹ å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•

### âœ… éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

#### 1. è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·ï¼ˆæ¨èï¼‰

**ä½¿ç”¨deployment-health-check.shè¿›è¡Œå…¨é¢æ£€æŸ¥**ï¼š
```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
sudo ./scripts/deployment-health-check.sh
```

**æ£€æŸ¥ç»´åº¦ï¼ˆ8ä¸ªæ–¹é¢ï¼‰**ï¼š
- âœ… å‰ç«¯APIé…ç½®ï¼ˆç¯å¢ƒå˜é‡ã€ç¡¬ç¼–ç åœ°å€ã€ç›¸å¯¹è·¯å¾„ï¼‰
- âœ… åç«¯é…ç½®ï¼ˆè·¯ç”±æ³¨å†Œã€CORSè®¾ç½®ï¼‰
- âœ… Nginxé…ç½®ï¼ˆä»£ç†é…ç½®ã€server_nameï¼‰
- âœ… SystemdæœåŠ¡ï¼ˆå¯åŠ¨è·¯å¾„ã€ç¯å¢ƒå˜é‡ã€æƒé™ï¼‰
- âœ… è¿è¡Œæ—¶çŠ¶æ€ï¼ˆæœåŠ¡çŠ¶æ€ã€ç«¯å£ç›‘å¬ï¼‰
- âœ… APIè¿é€šæ€§ï¼ˆå¥åº·æ£€æŸ¥ã€Sitemap APIï¼‰
- âœ… æ•°æ®åº“çŠ¶æ€ï¼ˆæ–‡ä»¶å­˜åœ¨ã€æ•°æ®å®Œæ•´æ€§ï¼‰
- âœ… å…³é”®æ–‡ä»¶ï¼ˆsitemapæ–‡ä»¶ã€robots.txtï¼‰

#### 2. ä»£ç é…ç½®æ£€æŸ¥

**å‰ç«¯APIé…ç½®**ï¼š
- [ ] åˆ é™¤æ‰€æœ‰`.env.production`æ–‡ä»¶ï¼ˆåŸŸå+SSLæ¨¡å¼ï¼‰
  ```bash
  rm -f /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/.env*
  ```

- [ ] å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨ç›¸å¯¹è·¯å¾„`/api`
  - `src/services/marketplaceApi.ts` â†’ `const API_BASE_URL = '/api'`
  - `src/services/reviewsApi.ts` â†’ `const API_BASE_URL = '/api'`
  - `src/services/qaApi.ts` â†’ `const API_BASE_URL = '/api'`

- [ ] SSRé¡µé¢ä½¿ç”¨å®Œæ•´å†…ç½‘åœ°å€`http://localhost:4001/api`
  - `src/pages/cars/[slug].astro`
  - `src/pages/motorcycles/[id].astro`
  - `src/pages/marketplace/[id].astro`
  - æ‰€æœ‰`sitemap-*.xml.ts`æ–‡ä»¶

- [ ] æ— ç¡¬ç¼–ç HTTPåœ°å€ï¼ˆå®¢æˆ·ç«¯ä»£ç ï¼‰
  ```bash
  grep -r "http://localhost:4001\|http://47\.237\.79\.9" \
    /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/src/ | \
    grep -v "\.astro" | grep -v "sitemap"
  # åº”è¯¥æ— è¾“å‡º
  ```

**åç«¯é…ç½®æ£€æŸ¥**ï¼š
- [ ] Sitemapè·¯ç”±å·²å¯¼å…¥å’Œæ³¨å†Œ
  ```typescript
  // backend/src/index.ts
  import sitemapRoutes from './routes/sitemap';
  app.use('/api/sitemap', sitemapRoutes);
  ```

- [ ] CORSé…ç½®åŒ…å«æ‰€æœ‰å¿…è¦åŸŸå
  ```typescript
  const allowedOrigins = [
    'http://localhost:4321',
    'https://vietmoto.top',
    'http://127.0.0.1:4321'
  ];
  ```

#### 3. é…ç½®æ–‡ä»¶æ£€æŸ¥

**Nginxé…ç½®ï¼ˆvietmoto.confï¼‰**ï¼š
- [ ] APIä»£ç†é…ç½®æ­£ç¡®
  ```nginx
  location /api/ {
      proxy_pass http://127.0.0.1:4001;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
  }
  ```

- [ ] é™æ€èµ„æºé…ç½®æ­£ç¡®
  ```nginx
  location /_astro/ {
      alias /var/www/vietnam-moto-auto/frontend/dist/client/_astro/;
      expires 1y;
  }
  ```

- [ ] server_nameä½¿ç”¨å…·ä½“åŸŸå
  ```nginx
  server_name vietmoto.top www.vietmoto.top;  # âœ… æ­£ç¡®
  ```

**SystemdæœåŠ¡é…ç½®**ï¼š
- [ ] å‰ç«¯æœåŠ¡ä½¿ç”¨SSRæ¨¡å¼
  ```ini
  # /etc/systemd/system/vietnam-moto-frontend.service
  ExecStart=/usr/bin/node dist/server/entry.mjs  # âœ… SSRæ¨¡å¼
  WorkingDirectory=/var/www/vietnam-moto-auto/frontend
  ```

- [ ] åç«¯æœåŠ¡å¯åŠ¨è·¯å¾„æ­£ç¡®
  ```ini
  ExecStart=/usr/bin/node dist/index.js  # âœ… æ­£ç¡®
  Environment=DB_PATH=/var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite
  ReadWritePaths=/var/www/vietnam-moto-auto/backend/database
  ```

**Astroé…ç½®**ï¼š
- [ ] ä½¿ç”¨serveræ¨¡å¼ï¼ˆSSRï¼‰
  ```javascript
  // astro.config.mjs
  export default defineConfig({
    output: 'server',  // SSRæ¨¡å¼
    adapter: node({ mode: 'standalone' }),
    server: {
      host: '0.0.0.0',  // ç›‘å¬æ‰€æœ‰æ¥å£
      port: 4321
    },
  });
  ```

#### 4. æ•°æ®åº“æ£€æŸ¥

- [ ] å¼€å‘ç¯å¢ƒæ•°æ®åº“å­˜åœ¨ä¸”æœ‰æ•°æ®
  ```bash
  ls -lh /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/backend/database/vietnam_moto_auto.sqlite
  sqlite3 vietnam_moto_auto.sqlite "SELECT COUNT(*) FROM motorcycles;"
  ```

- [ ] å…³é”®è¡¨å­˜åœ¨
  ```bash
  sqlite3 vietnam_moto_auto.sqlite ".tables" | \
    grep -E "marketplace_vehicles|cars|motorcycles"
  ```

#### 5. CSSæ–‡ä»¶æ£€æŸ¥ï¼ˆé‡è¦ï¼ï¼‰

- [ ] æ£€æŸ¥CSSæ–‡ä»¶åå¤§å°å†™
  ```bash
  ls /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/dist/client/_astro/*.css
  # æ£€æŸ¥æ˜¯å¦æœ‰å¤§å°å†™æ··åˆçš„æ–‡ä»¶å
  ```

- [ ] ç¡®ä¿éƒ¨ç½²è„šæœ¬ä¼šåˆ›å»ºç¬¦å·é“¾æ¥
  ```bash
  grep "ç¬¦å·é“¾æ¥\|symbolic" deploy.sh quick-deploy.sh
  ```

### ğŸš€ éƒ¨ç½²æ‰§è¡Œ

#### æ¨èæµç¨‹
```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™

# 1. è¿è¡Œéƒ¨ç½²å‰æ£€æŸ¥ï¼ˆå¼ºçƒˆæ¨èï¼‰
sudo ./scripts/deployment-health-check.sh

# 2. å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡Œéƒ¨ç½²
sudo ./deploy.sh

# 3. éƒ¨ç½²åå†æ¬¡æ£€æŸ¥
sudo ./scripts/deployment-health-check.sh
```

#### å¿«é€Ÿéƒ¨ç½²ï¼ˆå°æ›´æ–°ï¼‰
```bash
# åªéƒ¨ç½²å‰ç«¯
sudo ./quick-deploy.sh frontend

# åªéƒ¨ç½²åç«¯
sudo ./quick-deploy.sh backend

# éªŒè¯
sudo ./scripts/deployment-health-check.sh
```

### âœ… éƒ¨ç½²åéªŒè¯æ¸…å•

#### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥

- [ ] æ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸
  ```bash
  systemctl is-active vietnam-moto-frontend vietnam-moto-backend nginx
  # åº”è¯¥éƒ½æ˜¾ç¤º: active
  ```

- [ ] æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
  ```bash
  sudo systemctl status vietnam-moto-frontend
  sudo systemctl status vietnam-moto-backend
  ```

#### 2. ç«¯å£ç›‘å¬æ£€æŸ¥

- [ ] æ£€æŸ¥æ‰€æœ‰ç«¯å£æ­£å¸¸ç›‘å¬
  ```bash
  netstat -tlnp | grep -E ":4001|:4321|:80|:443"
  # åº”è¯¥çœ‹åˆ°ï¼š
  # 0.0.0.0:4321  (å‰ç«¯SSR)
  # :::4001       (åç«¯API)
  # 0.0.0.0:80    (Nginx HTTP)
  # 0.0.0.0:443   (Nginx HTTPS)
  ```

#### 3. APIè¿é€šæ€§æµ‹è¯•

- [ ] åç«¯å¥åº·æ£€æŸ¥
  ```bash
  curl --noproxy '*' http://localhost:4001/health
  # åº”è¯¥è¿”å›: {"status":"OK",...}
  ```

- [ ] Sitemap APIæµ‹è¯•
  ```bash
  curl --noproxy '*' http://localhost:4001/api/sitemap/motorcycles | jq '.data | length'
  # åº”è¯¥è¿”å›æ•°å­—ï¼ˆå¦‚ 126ï¼‰
  ```

- [ ] é€šè¿‡åŸŸåæµ‹è¯•API
  ```bash
  curl https://vietmoto.top/api/health
  # åº”è¯¥è¿”å›: {"status":"OK",...}
  ```

#### 4. å‰ç«¯è®¿é—®æµ‹è¯•

- [ ] ä¸»é¡µå¯è®¿é—®
  ```bash
  curl -I https://vietmoto.top/
  # åº”è¯¥è¿”å›: HTTP/2 200
  ```

- [ ] CSSåŠ è½½æ­£å¸¸
  ```bash
  # ä½¿ç”¨æµè§ˆå™¨è®¿é—®
  # æŒ‰F12æŸ¥çœ‹Networkæ ‡ç­¾
  # ç¡®è®¤æ‰€æœ‰CSSæ–‡ä»¶éƒ½æ˜¯200çŠ¶æ€ï¼Œcontent-typeæ˜¯text/css
  ```

- [ ] è¯¦æƒ…é¡µSSRæ­£å¸¸
  ```bash
  curl https://vietmoto.top/motorcycles/1 | grep -o "<title>.*</title>"
  # åº”è¯¥åŒ…å«è½¦è¾†æ ‡é¢˜
  ```

#### 5. æ•°æ®åº“éªŒè¯

- [ ] ç”Ÿäº§æ•°æ®åº“å®Œæ•´æ€§
  ```bash
  sqlite3 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite \
    "PRAGMA integrity_check;"
  # åº”è¯¥è¿”å›: ok
  ```

- [ ] æ•°æ®é‡éªŒè¯
  ```bash
  sqlite3 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite "
  SELECT 
    (SELECT COUNT(*) FROM motorcycles WHERE status='active') as motos,
    (SELECT COUNT(*) FROM cars WHERE status='active') as cars;"
  # åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„æ•°æ®é‡
  ```

#### 6. SitemapéªŒè¯

- [ ] Sitemapç´¢å¼•å¯è®¿é—®
  ```bash
  curl https://vietmoto.top/sitemap-index.xml | grep -c "<sitemap>"
  # åº”è¯¥è¿”å›: 5
  ```

- [ ] å„å­sitemap URLæ•°é‡æ­£ç¡®
  ```bash
  for sitemap in static motorcycles cars reviews marketplace; do
    count=$(curl -s "https://vietmoto.top/sitemap-$sitemap.xml" | grep -c "<url>")
    echo "sitemap-$sitemap.xml: $count URLs"
  done
  ```

#### 7. æ—¥å¿—æ£€æŸ¥

- [ ] åç«¯æ— ä¸¥é‡é”™è¯¯
  ```bash
  sudo journalctl -u vietnam-moto-backend -n 50 --no-pager | grep -i "error"
  # ä¸åº”è¯¥æœ‰critical errors
  ```

- [ ] å‰ç«¯æ— æ„å»ºé”™è¯¯
  ```bash
  sudo journalctl -u vietnam-moto-frontend -n 50 --no-pager
  # ç¡®è®¤æœåŠ¡æ­£å¸¸è¿è¡Œ
  ```

- [ ] Nginxæ— ä»£ç†é”™è¯¯
  ```bash
  sudo tail -50 /var/log/nginx/vietmoto.error.log
  # ä¸åº”è¯¥æœ‰502/504é”™è¯¯
  ```

#### 8. CSSåŠ è½½ç›‘æ§

- [ ] è¿è¡ŒCSSåŠ è½½æ£€æŸ¥è„šæœ¬
  ```bash
  cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
  ./check-css-loading.sh
  ```

- [ ] æ£€æŸ¥æœ€è¿‘çš„CSS 404é”™è¯¯
  ```bash
  tail -100 /var/log/nginx/vietmoto.access.log | grep "\.css" | grep " 404 "
  # åº”è¯¥æ— è¾“å‡º
  ```

### ğŸ†˜ å¸¸è§é—®é¢˜å¿«é€Ÿä¿®å¤

#### é—®é¢˜1: å‰ç«¯æ— æ³•è·å–åç«¯æ•°æ®

**ç—‡çŠ¶**ï¼šé¡µé¢æ˜¾ç¤º"åŠ è½½ä¸­..."æˆ–"è·å–æ•°æ®å¤±è´¥"

**å¿«é€Ÿè¯Šæ–­**ï¼š
```bash
# 1. æµ‹è¯•åç«¯API
curl http://localhost:4001/health

# 2. æµ‹è¯•é€šè¿‡Nginxä»£ç†
curl https://vietmoto.top/api/health

# 3. æ£€æŸ¥å‰ç«¯ä»£ç APIè·¯å¾„
grep "API_BASE_URL\|API_URL" frontend/src/services/*.ts
```

**ä¿®å¤æ–¹æ³•**ï¼š
```bash
# ç¡®ä¿å‰ç«¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„
rm -f frontend/.env*
sudo ./deploy.sh
```

#### é—®é¢˜2: CSSæ ·å¼åŠ è½½å¤±è´¥ï¼ˆç™½é¡µï¼‰

**ç—‡çŠ¶**ï¼šç½‘ç«™æ‰“å¼€æ˜¯ç™½é¡µï¼Œæµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºCSS 404é”™è¯¯

**å¿«é€Ÿè¯Šæ–­**ï¼š
```bash
# æ£€æŸ¥CSSæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/www/vietnam-moto-auto/frontend/dist/client/_astro/*.css

# æ£€æŸ¥Nginxé”™è¯¯æ—¥å¿—
tail -50 /var/log/nginx/vietmoto.error.log | grep "\.css"
```

**ä¿®å¤æ–¹æ³•**ï¼š
```bash
# 1. åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆä¸´æ—¶ï¼‰
cd /var/www/vietnam-moto-auto/frontend/dist/client/_astro
for file in *.css; do
    lowercase=$(echo "$file" | tr '[:upper:]' '[:lower:]')
    if [ "$file" != "$lowercase" ]; then
        ln -sf "$file" "$lowercase"
    fi
done

# 2. é‡æ–°éƒ¨ç½²ï¼ˆæ°¸ä¹…è§£å†³ï¼‰
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
sudo ./deploy.sh
```

#### é—®é¢˜3: SSRè¯¦æƒ…é¡µæ˜¾ç¤º404æˆ–æ— æ•°æ®

**ç—‡çŠ¶**ï¼šåŠ¨æ€è·¯ç”±é¡µé¢æ— æ³•æ˜¾ç¤ºå†…å®¹

**å¿«é€Ÿè¯Šæ–­**ï¼š
```bash
# 1. æµ‹è¯•åç«¯API
curl http://localhost:4001/api/vehicles/cars/slug/toyota-vios-2024

# 2. æ£€æŸ¥SSRé¡µé¢ä»£ç 
grep "API_URL" frontend/src/pages/cars/[slug].astro
# åº”è¯¥æ˜¯: const API_URL = 'http://localhost:4001/api';
```

**ä¿®å¤æ–¹æ³•**ï¼š
ç¡®ä¿æ‰€æœ‰SSRé¡µé¢ä½¿ç”¨å®Œæ•´çš„å†…ç½‘URLï¼Œç„¶åé‡æ–°éƒ¨ç½²

#### é—®é¢˜4: Sitemapæ•°æ®ä¸å‡†ç¡®

**ç—‡çŠ¶**ï¼šGoogle Search Consoleæ˜¾ç¤ºURLæ•°é‡ä¸åŒ¹é…

**å¿«é€Ÿè¯Šæ–­**ï¼š
```bash
# 1. æµ‹è¯•ä¸“ç”¨sitemap API
curl http://localhost:4001/api/sitemap/motorcycles | jq '.data | length'

# 2. å¯¹æ¯”æ•°æ®åº“å®é™…æ•°é‡
sqlite3 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite \
  "SELECT COUNT(*) FROM motorcycles WHERE status='active';"
```

**ä¿®å¤æ–¹æ³•**ï¼š
ç¡®ä¿sitemapä½¿ç”¨ä¸“ç”¨APIï¼ˆ`/api/sitemap/*`ï¼‰ï¼Œè€Œä¸æ˜¯æ™®é€šAPI

#### é—®é¢˜5: æœåŠ¡å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼š`systemctl status` æ˜¾ç¤º failed

**å¿«é€Ÿè¯Šæ–­**ï¼š
```bash
# 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u vietnam-moto-backend -n 100 --no-pager

# 2. æ£€æŸ¥å¯åŠ¨è·¯å¾„
grep "ExecStart" /etc/systemd/system/vietnam-moto-backend.service
# åº”è¯¥æ˜¯: dist/index.js
```

**ä¿®å¤æ–¹æ³•**ï¼š
```bash
# 1. é‡æ–°ç¼–è¯‘
cd /var/www/vietnam-moto-auto/backend
npm run build

# 2. é‡å¯æœåŠ¡
sudo systemctl restart vietnam-moto-backend
```

### ğŸ› ï¸ è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·

#### deployment-health-check.sh

**åŠŸèƒ½**ï¼šå…¨é¢æ£€æŸ¥éƒ¨ç½²ç¯å¢ƒçš„8ä¸ªç»´åº¦

**ä½ç½®**ï¼š`scripts/deployment-health-check.sh`

**ä½¿ç”¨**ï¼š
```bash
sudo ./scripts/deployment-health-check.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
=== ç³»ç»Ÿå¥åº·æ£€æŸ¥æŠ¥å‘Š ===

âœ… å‰ç«¯APIé…ç½®: å…¨éƒ¨æ­£ç¡®
âœ… åç«¯é…ç½®: å…¨éƒ¨æ­£ç¡®  
âœ… Nginxé…ç½®: å…¨éƒ¨æ­£ç¡®
âœ… SystemdæœåŠ¡: å…¨éƒ¨æ­£ç¡®
âœ… è¿è¡Œæ—¶çŠ¶æ€: æ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸
âœ… APIè¿é€šæ€§: æ­£å¸¸
âœ… æ•°æ®åº“: å®Œæ•´ä¸”æœ‰æ•°æ®
âœ… å…³é”®æ–‡ä»¶: å…¨éƒ¨å­˜åœ¨

ğŸ“Š æ€»ç»“: 0ä¸ªä¸¥é‡é—®é¢˜ï¼Œ0ä¸ªè­¦å‘Š
```

#### check-css-loading.sh

**åŠŸèƒ½**ï¼šä¸“é—¨æ£€æŸ¥CSSæ–‡ä»¶åŠ è½½æƒ…å†µ

**ä½ç½®**ï¼š`check-css-loading.sh`

**ä½¿ç”¨**ï¼š
```bash
./check-css-loading.sh
```

**æ£€æŸ¥å†…å®¹**ï¼š
- Nginxæ—¥å¿—ä¸­çš„CSS 404é”™è¯¯
- ä¸»è¦CSSæ–‡ä»¶çš„å¯è®¿é—®æ€§
- ç¬¦å·é“¾æ¥çš„æ­£ç¡®æ€§

### ğŸ“Š éƒ¨ç½²æ£€æŸ¥å¿«é€ŸéªŒè¯è„šæœ¬

**ä¸€é”®éªŒè¯æ‰€æœ‰å…³é”®åŠŸèƒ½**ï¼š

```bash
#!/bin/bash
echo "=== å¿«é€ŸéªŒè¯è„šæœ¬ ==="

echo -e "\n1. æœåŠ¡çŠ¶æ€"
systemctl is-active vietnam-moto-frontend vietnam-moto-backend nginx

echo -e "\n2. ç«¯å£ç›‘å¬"
netstat -tlnp | grep -E ":4001|:4321|:443"

echo -e "\n3. APIæµ‹è¯•"
curl -s http://localhost:4001/health | jq '.status'
curl -s https://vietmoto.top/api/health | jq '.status'

echo -e "\n4. æ•°æ®åº“"
sqlite3 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite \
  "SELECT 'Motorcycles: ' || COUNT(*) FROM motorcycles WHERE status='active';"

echo -e "\n5. CSSæ–‡ä»¶"
ls -1 /var/www/vietnam-moto-auto/frontend/dist/client/_astro/*.css | wc -l

echo -e "\nâœ… å¿«é€ŸéªŒè¯å®Œæˆ"
```

ä¿å­˜ä¸º`å¿«é€ŸéªŒè¯.sh`å¹¶ä½¿ç”¨ï¼š
```bash
chmod +x å¿«é€ŸéªŒè¯.sh
./å¿«é€ŸéªŒè¯.sh
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - é¡¹ç›®æ€»è§ˆ
- [é¡¹ç›®æ¶æ„å¼€å‘æ–‡æ¡£.md](./é¡¹ç›®æ¶æ„å¼€å‘æ–‡æ¡£.md) - æ¶æ„è®¾è®¡
- [æ•°æ®åº“é…ç½®å¼€å‘æ–‡æ¡£.md](./æ•°æ®åº“é…ç½®å¼€å‘æ–‡æ¡£.md) - æ•°æ®åº“è®¾è®¡
- [APIè·¯ç”±å¼€å‘æ–‡æ¡£.md](./APIè·¯ç”±å¼€å‘æ–‡æ¡£.md) - APIæ–‡æ¡£
- [åç«¯æœåŠ¡å¼€å‘æ–‡æ¡£.md](./åç«¯æœåŠ¡å¼€å‘æ–‡æ¡£.md) - åç«¯å¼€å‘æŒ‡å—
- [SEOä¼˜åŒ–å®Œæ•´æŒ‡å—.md](./SEOä¼˜åŒ–å®Œæ•´æŒ‡å—.md) - SEOæœ€ä½³å®è·µ

---

## ğŸ”§ éƒ¨ç½²é—®é¢˜æ¡ˆä¾‹å’Œè§£å†³æ–¹æ¡ˆ

### æ¡ˆä¾‹1ï¼šå‰ç«¯æœåŠ¡æœªè‡ªåŠ¨å¯åŠ¨ï¼ˆ2025-10-12ï¼‰

**é—®é¢˜æè¿°ï¼š**
- ä½¿ç”¨ `deploy.sh` éƒ¨ç½²åï¼Œhttp://47.237.79.9:4321 æ— æ³•è®¿é—®
- åªæœ‰åç«¯æœåŠ¡åœ¨è¿è¡Œï¼Œå‰ç«¯æœåŠ¡æœªå¯åŠ¨

**æ ¹æœ¬åŸå› ï¼š**
- éƒ¨ç½²è„šæœ¬åªå¯åŠ¨äº† `vietnam-moto-backend` æœåŠ¡
- å¿˜è®°å¯åŠ¨ `vietnam-moto-frontend` æœåŠ¡

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ›´æ–° deploy.shï¼Œæ·»åŠ å‰ç«¯æœåŠ¡å¯åŠ¨
log_info "å¯åŠ¨å‰ç«¯æœåŠ¡ (4321)..."
systemctl start vietnam-moto-frontend
systemctl enable vietnam-moto-frontend

# 2. æ·»åŠ å‰ç«¯æœåŠ¡å¥åº·æ£€æŸ¥
if curl -f http://localhost:4321 > /dev/null 2>&1; then
    log_success "âœ… å‰ç«¯æœåŠ¡æ­£å¸¸ (ç«¯å£ 4321)"
else
    log_warning "âš ï¸ å‰ç«¯æœåŠ¡å¯èƒ½æœ‰é—®é¢˜"
fi
```

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/deploy.sh`
- è¡Œæ•°ï¼šç¬¬527-537è¡Œ

---

### æ¡ˆä¾‹2ï¼š4321ç«¯å£åªç›‘å¬æœ¬åœ°ï¼ˆ2025-10-12ï¼‰

**é—®é¢˜æè¿°ï¼š**
- å‰ç«¯æœåŠ¡å¯åŠ¨äº†ï¼Œä½†ä»å¤–éƒ¨æ— æ³•è®¿é—®
- `netstat` æ˜¾ç¤ºåªç›‘å¬ `::1:4321`ï¼ˆæœ¬åœ°ï¼‰ï¼Œä¸æ˜¯ `0.0.0.0:4321`ï¼ˆæ‰€æœ‰æ¥å£ï¼‰

**æ ¹æœ¬åŸå› ï¼š**
- `astro.config.mjs` ç¼ºå°‘ `server.host` é…ç½®
- Astroé»˜è®¤åªç›‘å¬localhost

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// ä¿®æ”¹ astro.config.mjs
export default defineConfig({
  output: 'static',
  integrations: [react()],
  server: {
    host: '0.0.0.0',  // æ·»åŠ è¿™ä¸ªé…ç½®ï¼
    port: 4321
  },
  vite: {
    plugins: [tailwindcss()]
  }
});
```

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/astro.config.mjs` ï¼ˆæºæ–‡ä»¶ï¼‰
- `/var/www/vietnam-moto-auto/frontend/astro.config.mjs` ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**éªŒè¯æ–¹æ³•ï¼š**
```bash
# é‡å¯æœåŠ¡åæ£€æŸ¥
netstat -tlnp | grep 4321
# åº”è¯¥çœ‹åˆ°ï¼š0.0.0.0:4321 æˆ– *:4321
```

---

### æ¡ˆä¾‹3ï¼šNginxé…ç½®è¢«å…¶ä»–ç½‘ç«™è¦†ç›–ï¼ˆ2025-10-12ï¼‰

**é—®é¢˜æè¿°ï¼š**
- è®¿é—® http://47.237.79.9 è¢«é‡å®šå‘åˆ° `https://cryptopulse.work`
- æ˜æ˜é…ç½®äº†vietnam-moto-autoï¼Œå´è®¿é—®ä¸åˆ°

**æ ¹æœ¬åŸå› ï¼š**
- æœåŠ¡å™¨ä¸Šæœ‰å¤šä¸ªç½‘ç«™å…±å­˜
- `cryptopulse.work` çš„é…ç½®ä½¿ç”¨äº†é€šé…ç¬¦ `server_name`
- vietnam-moto-auto ä½¿ç”¨ `server_name _`ï¼Œä¼˜å…ˆçº§å¤ªä½

**NginxåŒ¹é…ä¼˜å…ˆçº§ï¼š**
```
1. å®Œå…¨åŒ¹é…åŸŸåï¼ˆå¦‚ server_name example.comï¼‰
2. é€šé…ç¬¦åŸŸåï¼ˆå¦‚ server_name *.example.comï¼‰
3. æ­£åˆ™è¡¨è¾¾å¼åŸŸå
4. é»˜è®¤serverï¼ˆserver_name _ï¼‰â† ä¼˜å…ˆçº§æœ€ä½
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **åˆ é™¤ä¸ç”¨çš„é…ç½®æ–‡ä»¶ï¼š**
```bash
sudo rm /etc/nginx/conf.d/cryptopulse-*.conf
```

2. **ä¿®æ”¹vietnam-moto-autoé…ç½®ï¼š**
```nginx
# é”™è¯¯é…ç½®ï¼ˆä¼˜å…ˆçº§å¤ªä½ï¼‰
server {
    listen 80;
    server_name _;  # âŒ ä¸è¦ç”¨è¿™ä¸ª
}

# æ­£ç¡®é…ç½®
server {
    listen 80;
    server_name 47.237.79.9 localhost;  # âœ… æŒ‡å®šå…·ä½“IP
}
```

3. **âš ï¸ é‡è¦ï¼šä¿®æ”¹æºæ–‡ä»¶ï¼**
```bash
# å¿…é¡»ä¿®æ”¹æºæ–‡ä»¶ï¼Œå¦åˆ™ä¸‹æ¬¡éƒ¨ç½²ä¼šè¢«è¦†ç›–
vi /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/nginx/vietnam-moto-auto.conf
```

4. **é‡æ–°åŠ è½½Nginxï¼š**
```bash
sudo nginx -t
sudo systemctl reload nginx
```

**éªŒè¯æ–¹æ³•ï¼š**
```bash
# æµ‹è¯•è®¿é—®
curl -I http://47.237.79.9
# åº”è¯¥è¿”å› HTTP/1.1 200 OKï¼Œä¸æ˜¯301é‡å®šå‘
```

---

### æ¡ˆä¾‹4ï¼šå‰ç«¯APIè°ƒç”¨å¤±è´¥ï¼ˆ2025-10-12ï¼‰

**é—®é¢˜æè¿°ï¼š**
- å‰ç«¯é¡µé¢èƒ½æ‰“å¼€ï¼Œä½†æ•°æ®åŠ è½½å¤±è´¥
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºAPIè°ƒç”¨é”™è¯¯

**æ ¹æœ¬åŸå› ï¼š**
- ç¼ºå°‘ `.env.production` æ–‡ä»¶
- å‰ç«¯ä¸çŸ¥é“åç«¯APIåœ°å€

**è§£å†³æ–¹æ¡ˆï¼š**

1. **åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š**
```bash
# æºæ–‡ä»¶
echo "PUBLIC_API_URL=http://47.237.79.9:4001" > /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/.env.production

# ç”Ÿäº§ç¯å¢ƒ
echo "PUBLIC_API_URL=http://47.237.79.9:4001" > /var/www/vietnam-moto-auto/frontend/.env.production
```

2. **é‡æ–°æ„å»ºå‰ç«¯ï¼š**
```bash
cd /var/www/vietnam-moto-auto/frontend
npm run build
```

3. **é‡å¯å‰ç«¯æœåŠ¡ï¼š**
```bash
sudo systemctl restart vietnam-moto-frontend
```

**éªŒè¯æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶
cat /var/www/vietnam-moto-auto/frontend/.env.production

# æµ‹è¯•APIè°ƒç”¨
curl http://47.237.79.9:4001/api/vehicles/motorcycles?limit=1
```

---

### æ¡ˆä¾‹5ï¼šHTTPSæ··åˆå†…å®¹é”™è¯¯ï¼ˆ2025-10-14ï¼‰âš ï¸ åŸŸå+SSLéƒ¨ç½²å¿…çœ‹

**é—®é¢˜æè¿°ï¼š**
- é…ç½®åŸŸåå’ŒSSLè¯ä¹¦åï¼Œç½‘ç«™é€šè¿‡HTTPSè®¿é—®
- æµè§ˆå™¨æ§åˆ¶å°æŠ¥é”™ï¼š`Mixed Content: The page at 'https://vietmoto.top/marketplace' was loaded over HTTPS, but requested an insecure XMLHttpRequest endpoint 'http://47.237.79.9:4001/marketplace'`
- æ‰€æœ‰APIè°ƒç”¨è¢«æµè§ˆå™¨å®‰å…¨ç­–ç•¥é˜»æ­¢
- é¡µé¢æ˜¾ç¤º"Lá»—i: Network Error"

**æ ¹æœ¬åŸå› ï¼š**
1. **ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯**ï¼š`.env.production` æ–‡ä»¶è®¾ç½®äº† `PUBLIC_API_URL=http://47.237.79.9:4001`ï¼ˆHTTPåœ°å€ï¼‰
2. **ç¡¬ç¼–ç HTTPåœ°å€**ï¼šå¤šä¸ªå‰ç«¯æ–‡ä»¶ç›´æ¥ä½¿ç”¨äº† `http://localhost:4001` æˆ– `http://47.237.79.9:4001`
3. **æœªä½¿ç”¨Nginxä»£ç†**ï¼šå‰ç«¯ç›´æ¥è®¿é—®åç«¯HTTPåœ°å€ï¼Œè€Œä¸æ˜¯é€šè¿‡Nginxçš„HTTPSä»£ç†

**æµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼š**
- HTTPSé¡µé¢ä¸å…è®¸åŠ è½½HTTPèµ„æºï¼ˆMixed Contentï¼‰
- æ‰€æœ‰APIã€å›¾ç‰‡ã€è„šæœ¬éƒ½å¿…é¡»ä½¿ç”¨HTTPS
- è¿™æ˜¯æµè§ˆå™¨çš„å¼ºåˆ¶å®‰å…¨æœºåˆ¶ï¼Œæ— æ³•ç»•è¿‡

**å½±å“èŒƒå›´ï¼ˆ11ä¸ªæ–‡ä»¶éœ€è¦ä¿®å¤ï¼‰ï¼š**
```
frontend/src/services/marketplaceApi.ts
frontend/src/services/reviewsApi.ts
frontend/src/services/qaApi.ts
frontend/src/components/MarketplaceSection.tsx
frontend/src/config/api.ts
frontend/src/pages/sitemap.xml.ts
frontend/src/pages/marketplace/[id].astro
frontend/src/pages/cars/[slug].astro
frontend/src/pages/qa/[id].astro
frontend/src/pages/reviews/[slug].astro
frontend/.env.production (éœ€åˆ é™¤)
```

**è§£å†³æ–¹æ¡ˆï¼š**

**1. åˆ é™¤æ‰€æœ‰ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆâš ï¸ é‡è¦ï¼‰**
```bash
# æºç›®å½•
rm -f /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/.env.production
rm -f /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/.env*

# ç”Ÿäº§ç›®å½•ï¼ˆéƒ¨ç½²åï¼‰
rm -f /var/www/vietnam-moto-auto/frontend/.env.production
rm -f /var/www/vietnam-moto-auto/frontend/.env*
```

**åŸå› **ï¼šä½¿ç”¨åŸŸå+SSLæ—¶ï¼Œä¸åº”è¯¥é…ç½® `PUBLIC_API_URL`ï¼Œåº”è¯¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„é€šè¿‡Nginxä»£ç†ã€‚

**2. ä¿®å¤æ‰€æœ‰APIæœåŠ¡æ–‡ä»¶**

å°†æ‰€æœ‰ `API_BASE_URL` ä»ç¯å¢ƒå˜é‡æˆ–ç¡¬ç¼–ç æ”¹ä¸ºå›ºå®šçš„ç›¸å¯¹è·¯å¾„ï¼š

```typescript
// âŒ é”™è¯¯å†™æ³•
const API_BASE_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:4001/api';
const API_BASE_URL = typeof window !== 'undefined' ? '/api' : 'http://localhost:4001/api';
const API_URL = 'http://localhost:4001/api';

// âœ… æ­£ç¡®å†™æ³•ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
const API_BASE_URL = '/api';
```

**ä¿®å¤æ–‡ä»¶åˆ—è¡¨ï¼š**
- `src/services/marketplaceApi.ts`
- `src/services/reviewsApi.ts`
- `src/services/qaApi.ts`
- `src/config/api.ts`
- `src/pages/sitemap.xml.ts`

**3. ä¿®å¤Reactç»„ä»¶**

```typescript
// src/components/MarketplaceSection.tsx

// âŒ é”™è¯¯
const response = await fetch(
  `${import.meta.env.PUBLIC_API_URL}/api/marketplace?...`
);

// âœ… æ­£ç¡®
const response = await fetch(
  `/api/marketplace?...`
);
```

**4. ä¿®å¤Astroé¡µé¢**

```typescript
// âŒ é”™è¯¯
const response = await fetch(`http://localhost:4001/api/marketplace/${id}`);
const API_URL = 'http://localhost:4001/api';

// âœ… æ­£ç¡®
const response = await fetch(`/api/marketplace/${id}`);
const API_URL = '/api';
```

**5. ç¡®ä¿Nginxé…ç½®æ­£ç¡®**

```nginx
# /etc/nginx/conf.d/vietmoto.conf

server {
    listen 443 ssl http2;
    server_name vietmoto.top;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/vietmoto.top/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/vietmoto.top/privkey.pem;
    
    # APIä»£ç†ï¼ˆå…³é”®é…ç½®ï¼‰
    location /api/ {
        proxy_pass http://127.0.0.1:4001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**6. é‡æ–°æ„å»ºå’Œéƒ¨ç½²**

```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend
npm run build
rm -rf /var/www/vietnam-moto-auto/frontend/dist
cp -r dist /var/www/vietnam-moto-auto/frontend/
systemctl restart vietnam-moto-frontend
```

**APIè¯·æ±‚æµç¨‹å¯¹æ¯”ï¼š**

```
é”™è¯¯æµç¨‹ï¼ˆMixed Contentï¼‰ï¼š
æµè§ˆå™¨ (HTTPS) â†’ ç›´æ¥è¯·æ±‚ â†’ http://47.237.79.9:4001/api âŒ è¢«é˜»æ­¢

æ­£ç¡®æµç¨‹ï¼š
æµè§ˆå™¨ (HTTPS) â†’ https://vietmoto.top/api â†’ Nginx (443) 
  â†’ proxy_pass â†’ http://127.0.0.1:4001/api âœ… å®‰å…¨
```

**éªŒè¯æ–¹æ³•ï¼š**

```bash
# 1. æ£€æŸ¥æ˜¯å¦è¿˜æœ‰HTTPåœ°å€
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend
grep -r "localhost:4001\|47\.237\.79\.9" src/

# 2. æµ‹è¯•APIï¼ˆåº”è¯¥è¿”å›JSONæ•°æ®ï¼‰
curl https://vietmoto.top/api/marketplace?limit=1

# 3. æµè§ˆå™¨æ§åˆ¶å°ä¸åº”è¯¥æœ‰Mixed Contenté”™è¯¯
# æ‰“å¼€ https://vietmoto.top/marketplace
# æŒ‰F12æŸ¥çœ‹æ§åˆ¶å°ï¼Œä¸åº”è¯¥æœ‰çº¢è‰²é”™è¯¯
```

**é‡è¦æç¤ºï¼š**

1. **IPåœ°å€éƒ¨ç½² vs åŸŸå+SSLéƒ¨ç½²çš„åŒºåˆ«**ï¼š
   - IPåœ°å€ï¼ˆHTTPï¼‰ï¼šå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®åç«¯åœ°å€
   - åŸŸå+SSLï¼ˆHTTPSï¼‰ï¼šå¿…é¡»ä½¿ç”¨ç›¸å¯¹è·¯å¾„+Nginxä»£ç†
   
2. **ä¸è¦æ··ç”¨HTTPå’ŒHTTPS**ï¼š
   - æ•´ä¸ªç½‘ç«™è¦ä¹ˆå…¨HTTPï¼Œè¦ä¹ˆå…¨HTTPS
   - ä¸èƒ½åœ¨HTTPSé¡µé¢ä¸­è¯·æ±‚HTTPèµ„æº
   
3. **Nginxæ˜¯å¿…éœ€çš„**ï¼š
   - å‰ç«¯(HTTPS) â†” Nginx â†” åç«¯(HTTPå†…ç½‘)
   - æµè§ˆå™¨åªçœ‹åˆ°HTTPSï¼Œå†…éƒ¨é€šä¿¡å¯ä»¥æ˜¯HTTP

4. **ç¯å¢ƒå˜é‡çš„å‘**ï¼š
   - `.env.production` åœ¨æ„å»ºæ—¶ä¼šè¢«æ‰“åŒ…è¿›ä»£ç 
   - å³ä½¿åˆ é™¤æ–‡ä»¶ï¼Œå·²æ„å»ºçš„ä»£ç ä»åŒ…å«æ—§å€¼
   - ä¿®æ”¹åå¿…é¡»é‡æ–° `npm run build`

**é€‚ç”¨åœºæ™¯ï¼š**
- ä½¿ç”¨åŸŸåè®¿é—®ï¼ˆå¦‚ vietmoto.topï¼‰
- é…ç½®äº†SSLè¯ä¹¦ï¼ˆLet's Encryptç­‰ï¼‰
- éœ€è¦HTTPSåŠ å¯†ä¼ è¾“
- ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®

---

### æ¡ˆä¾‹6ï¼šSSRè¯¦æƒ…é¡µæ— æ³•æ˜¾ç¤ºå†…å®¹ï¼ˆ2025-10-14ï¼‰âš ï¸ SSRéƒ¨ç½²å¿…çœ‹

**é—®é¢˜æè¿°ï¼š**
- é…ç½®åŸŸåå’ŒSSLåï¼Œæ‰€æœ‰è¯¦æƒ…é¡µéƒ½æ— æ³•æ˜¾ç¤ºå†…å®¹
- æ±½è½¦è¯¦æƒ…é¡µï¼š404é”™è¯¯
- äºŒæ‰‹äº¤æ˜“è¯¦æƒ…é¡µï¼šæ˜¾ç¤º"âŒ è·å–æ•°æ®å¤±è´¥"
- æ‘©æ‰˜è½¦ã€é—®ç­”ã€æµ‹è¯„è¯¦æƒ…é¡µï¼šå…¨éƒ¨æŠ¥é”™æˆ–æ— å†…å®¹

**æ ¹æœ¬åŸå› ï¼š**
1. **SSRæ¸²æŸ“ç¯å¢ƒé—®é¢˜**ï¼šAstro SSRé¡µé¢åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œï¼Œæ— æ³•è§£æç›¸å¯¹è·¯å¾„ `/api`
2. **APIè°ƒç”¨è·¯å¾„é”™è¯¯**ï¼šæ‰€æœ‰è¯¦æƒ…é¡µä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`ï¼Œåœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶å¤±è´¥
3. **å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ··æ·†**ï¼šæ²¡æœ‰åŒºåˆ†æµè§ˆå™¨ç¯å¢ƒå’ŒNode.jsæœåŠ¡å™¨ç¯å¢ƒ

**æŠ€æœ¯åŸç†ï¼š**

```
æµè§ˆå™¨ç¯å¢ƒï¼ˆå®¢æˆ·ç«¯JavaScriptï¼‰ï¼š
- å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ /api
- é€šè¿‡Nginxä»£ç†åˆ°åç«¯
- URL: https://vietmoto.top/api â†’ http://127.0.0.1:4001

æœåŠ¡å™¨ç¯å¢ƒï¼ˆAstro SSRï¼‰ï¼š
- æ— æ³•ä½¿ç”¨ç›¸å¯¹è·¯å¾„ /api
- æ²¡æœ‰åŸŸåå’Œåè®®ä¸Šä¸‹æ–‡
- å¿…é¡»ä½¿ç”¨å®Œæ•´URL: http://localhost:4001/api
```

**å½±å“èŒƒå›´ï¼ˆ5ä¸ªè¯¦æƒ…é¡µæ–‡ä»¶ï¼‰ï¼š**
```
frontend/src/pages/cars/[slug].astro           - æ±½è½¦è¯¦æƒ…é¡µ
frontend/src/pages/motorcycles/[id].astro      - æ‘©æ‰˜è½¦è¯¦æƒ…é¡µ
frontend/src/pages/marketplace/[id].astro      - äºŒæ‰‹äº¤æ˜“è¯¦æƒ…é¡µ
frontend/src/pages/qa/[id].astro               - é—®ç­”è¯¦æƒ…é¡µ
frontend/src/pages/reviews/[slug].astro        - æµ‹è¯„è¯¦æƒ…é¡µ
```

**è§£å†³æ–¹æ¡ˆï¼š**

**1. ä¿®å¤æ‰€æœ‰SSRè¯¦æƒ…é¡µçš„APIè°ƒç”¨**

å°†æ‰€æœ‰è¯¦æƒ…é¡µçš„API URLä»ç›¸å¯¹è·¯å¾„æ”¹ä¸ºå®Œæ•´URLï¼š

```typescript
// âŒ é”™è¯¯å†™æ³•ï¼ˆSSRç¯å¢ƒä¸‹æ— æ³•å·¥ä½œï¼‰
const API_URL = '/api';
const response = await fetch(`/api/vehicles/cars/slug/${slug}`);

// âœ… æ­£ç¡®å†™æ³•ï¼ˆSSRç¯å¢ƒï¼‰
const API_URL = 'http://localhost:4001/api';
const response = await fetch(`${API_URL}/vehicles/cars/slug/${slug}`);
```

**2. ä¿®å¤çš„æ–‡ä»¶ç¤ºä¾‹**

```typescript
// frontend/src/pages/cars/[slug].astro
---
import BaseLayout from '../../layouts/BaseLayout.astro';

// ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä¸é¢„æ¸²æŸ“é™æ€é¡µé¢
export const prerender = false;

const { slug } = Astro.params;

// SSRæ¨¡å¼ä¸‹ä½¿ç”¨å®Œæ•´çš„å†…ç½‘åœ°å€
const API_URL = 'http://localhost:4001/api';

let car: any = null;
let error = false;

try {
  const response = await fetch(`${API_URL}/vehicles/cars/slug/${slug}`, {
    headers: {
      'Accept': 'application/json'
    }
  });
  
  if (!response.ok) {
    console.error(`API request failed: ${response.status}`);
    error = true;
  } else {
    const result = await response.json();
    if (result.success) {
      car = result.data;
    }
  }
} catch (err) {
  console.error('Failed to fetch car:', err);
  error = true;
}
---
```

**3. è®¾ç½®æ­£ç¡®çš„prerenderé€‰é¡¹**

æ‰€æœ‰åŠ¨æ€è¯¦æƒ…é¡µå¿…é¡»ç¦ç”¨é¢„æ¸²æŸ“ï¼š

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨SSRæ¨¡å¼
export const prerender = false;

// âŒ é”™è¯¯ï¼šä½¿ç”¨é™æ€é¢„æ¸²æŸ“
export const prerender = true;
// æˆ–ä½¿ç”¨ getStaticPathsï¼ˆä¸é€‚åˆåŠ¨æ€å†…å®¹ï¼‰
```

**4. å®¢æˆ·ç«¯JavaScriptç»§ç»­ä½¿ç”¨ç›¸å¯¹è·¯å¾„**

```typescript
// å®¢æˆ·ç«¯è„šæœ¬ï¼ˆ<script>æ ‡ç­¾ä¸­ï¼‰
const API_BASE_URL = '/api';  // âœ… æ­£ç¡®ï¼Œé€šè¿‡Nginxä»£ç†
fetch(`${API_BASE_URL}/reviews/slug/${slug}`)
  .then(res => res.json())
  .then(data => {
    // å¤„ç†æ•°æ®
  });
```

**APIè¯·æ±‚æµç¨‹å¯¹æ¯”ï¼š**

```
SSRæ¸²æŸ“æµç¨‹ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ï¼š
ç”¨æˆ·è®¿é—® â†’ Nginx (443) â†’ å‰ç«¯SSRæœåŠ¡å™¨ (4321)
                              â†“
          ç›´æ¥è¯·æ±‚ â†’ http://localhost:4001/api
                              â†“
                          åç«¯APIè¿”å›æ•°æ®
                              â†“
                          æ¸²æŸ“å®Œæ•´HTML
                              â†“
                      è¿”å›ç»™æµè§ˆå™¨

å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼ˆæµè§ˆå™¨ï¼‰ï¼š
ç”¨æˆ·æ“ä½œ â†’ æµè§ˆå™¨JavaScript â†’ /api/...
                              â†“
                      Nginxä»£ç† (443)
                              â†“
                  http://127.0.0.1:4001/api
                              â†“
                      åç«¯APIè¿”å›JSON
                              â†“
                    å‰ç«¯JavaScriptæ›´æ–°é¡µé¢
```

**éªŒè¯æ–¹æ³•ï¼š**

```bash
# 1. æµ‹è¯•SSRæ¸²æŸ“ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰
curl http://localhost:4321/cars/toyota-vios-2024
# åº”è¯¥è¿”å›å®Œæ•´çš„HTMLï¼ŒåŒ…å«è½¦è¾†æ•°æ®

# 2. æµ‹è¯•APIç›´æ¥è®¿é—®
curl http://localhost:4001/api/vehicles/cars/slug/toyota-vios-2024
# åº”è¯¥è¿”å›JSONæ•°æ®

# 3. æµ‹è¯•é€šè¿‡åŸŸåè®¿é—®
curl https://vietmoto.top/cars/toyota-vios-2024
# åº”è¯¥è¿”å›å®Œæ•´çš„HTMLé¡µé¢

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status vietnam-moto-frontend
systemctl status vietnam-moto-backend
```

**é‡è¦æç¤ºï¼š**

1. **åŒºåˆ†æ¸²æŸ“ç¯å¢ƒ**ï¼š
   - SSRï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ï¼šä½¿ç”¨ `http://localhost:4001/api`
   - CSRï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼šä½¿ç”¨ `/api`ï¼ˆé€šè¿‡Nginxä»£ç†ï¼‰

2. **prerenderè®¾ç½®**ï¼š
   - åŠ¨æ€è¯¦æƒ…é¡µï¼š`export const prerender = false`
   - é™æ€é¡µé¢ï¼š`export const prerender = true`

3. **å¼€å‘vsç”Ÿäº§**ï¼š
   - å¼€å‘ç¯å¢ƒï¼šå¯ä»¥ç›´æ¥è®¿é—® `localhost:4001`
   - ç”Ÿäº§ç¯å¢ƒï¼ˆSSRï¼‰ï¼šä»éœ€ä½¿ç”¨ `localhost:4001`ï¼ˆå†…ç½‘é€šä¿¡ï¼‰
   - ç”Ÿäº§ç¯å¢ƒï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼šä½¿ç”¨ `/api`ï¼ˆé€šè¿‡Nginxä»£ç†ï¼‰

4. **ä¸è¦æ··æ·†**ï¼š
   - SSRç¯å¢ƒå˜é‡ï¼ˆå¦‚`.env.production`ï¼‰å¯¹æœåŠ¡å™¨ç«¯fetchæ— æ•ˆ
   - å¿…é¡»ç¡¬ç¼–ç å®Œæ•´URLæˆ–ä½¿ç”¨ç¯å¢ƒåˆ¤æ–­

**é€‚ç”¨åœºæ™¯ï¼š**
- ä½¿ç”¨Astro SSRæ¨¡å¼ï¼ˆ`output: 'server'` æˆ– `output: 'hybrid'`ï¼‰
- åŠ¨æ€è·¯ç”±é¡µé¢ï¼ˆå¦‚ `[id].astro`ã€`[slug].astro`ï¼‰
- éœ€è¦æœåŠ¡å™¨ç«¯è·å–æ•°æ®çš„é¡µé¢
- åŸŸå+SSL+Nginxä»£ç†æ¶æ„

**ç›¸å…³æ–‡æ¡£ï¼š**
- Astro SSRæ–‡æ¡£ï¼šhttps://docs.astro.build/en/guides/server-side-rendering/
- APIè·¯ç”±å¼€å‘æ–‡æ¡£ï¼šç¬¬163-180è¡Œï¼ˆSSRç¯å¢ƒè¯´æ˜ï¼‰

---

### æ¡ˆä¾‹7ï¼šSitemapæ•°æ®ä¸å‡†ç¡®ï¼ˆ2025-10-14ï¼‰âš ï¸ SEOä¼˜åŒ–å¿…çœ‹

**é—®é¢˜æè¿°ï¼š**
- Google Search Consoleæ˜¾ç¤ºsitemapæœ‰1343ä¸ªURL
- ä½†Googleå®é™…åªç´¢å¼•äº†932ä¸ªURL
- ç”¨æˆ·åé¦ˆsitemapä¸­åŒ…å«äº†å¾ˆå¤šæ— æ•ˆé“¾æ¥
- æ£€æŸ¥å‘ç°marketplace sitemapè¿”å›äº†1000+æ¡æ•°æ®ï¼Œä½†æ•°æ®åº“å®é™…åªæœ‰20æ¡

**æ ¹æœ¬åŸå› ï¼š**
1. **æ•°æ®æ¥æºæ··ä¹±**ï¼šæ™®é€šçš„`/api/marketplace` APIä¼šè¿”å›ï¼š
   - æ•°æ®åº“ä¸­çš„20æ¡æœ¬åœ°æ•°æ®
   - ä»Chá»£ Tá»‘t APIæŠ“å–çš„1000+æ¡å¤–éƒ¨æ•°æ®
2. **å¤–éƒ¨æ•°æ®é—®é¢˜**ï¼šChá»£ Tá»‘tçš„æ•°æ®æ˜¯å…¶ä»–ç½‘ç«™çš„å•†å“ï¼Œåœ¨æˆ‘ä»¬ç½‘ç«™ä¸Šæ²¡æœ‰å¯¹åº”é¡µé¢
3. **sitemapä½¿ç”¨é”™è¯¯çš„API**ï¼šsitemapç›´æ¥è°ƒç”¨äº†åŒ…å«å¤–éƒ¨æ•°æ®çš„API

**æŠ€æœ¯åŸç†ï¼š**

```
é”™è¯¯æµç¨‹ï¼š
sitemap.xml â†’ /api/marketplace ï¼ˆè¿”å›æ•°æ®åº“+å¤–éƒ¨APIæ•°æ®ï¼‰
                      â†“
              åŒ…å«1000+æ¡å¤–éƒ¨é“¾æ¥
                      â†“
        GoogleæŠ“å–è¿™äº›é“¾æ¥å…¨éƒ¨404
                      â†“
              å½±å“ç½‘ç«™SEOè¯„åˆ†

æ­£ç¡®æµç¨‹ï¼š
sitemap.xml â†’ /api/sitemap/marketplace ï¼ˆåªè¿”å›æ•°æ®åº“æ•°æ®ï¼‰
                      â†“
              åªåŒ…å«20æ¡çœŸå®é¡µé¢
                      â†“
        GoogleæˆåŠŸæŠ“å–å¹¶ç´¢å¼•
```

**å½±å“èŒƒå›´ï¼š**
- marketplace sitemapï¼ˆæœ€ä¸¥é‡ï¼‰
- å…¶ä»–æ¨¡å—çš„sitemapä¹Ÿå¯èƒ½æœ‰ç±»ä¼¼é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**

**1. åˆ›å»ºä¸“ç”¨Sitemap API**

åœ¨åç«¯åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶ï¼š

```typescript
// backend/src/routes/sitemap.ts
import { Router } from 'express';
import { asyncHandler } from '../middleware/errorHandler';
import MarketplaceVehicle from '../models/MarketplaceVehicle';
import Car from '../models/Car';
import Motorcycle from '../models/Motorcycle';
import News from '../models/News';

const router = Router();

// åªæŸ¥è¯¢æ•°æ®åº“ï¼Œä¸åŒ…å«å¤–éƒ¨APIæ•°æ®
router.get('/motorcycles', asyncHandler(async (req: any, res: any) => {
  const motorcycles = await Motorcycle.findAll({
    where: { status: 'active' },
    attributes: ['id', 'updated_at', 'created_at'],
    limit: 1000,
  });

  res.json({
    success: true,
    data: motorcycles.map(m => ({
      id: m.id,
      lastmod: m.updated_at || m.created_at,
    })),
  });
}));

// å…¶ä»–ç«¯ç‚¹ç±»ä¼¼...
export default router;
```

**2. æ³¨å†ŒSitemapè·¯ç”±**

```typescript
// backend/src/index.ts
import sitemapRoutes from './routes/sitemap';

app.use('/api/sitemap', sitemapRoutes);
```

**3. æ›´æ–°å‰ç«¯Sitemapç”Ÿæˆä»£ç **

```typescript
// frontend/src/pages/sitemap-motorcycles.xml.ts

// âŒ é”™è¯¯ï¼šä½¿ç”¨æ™®é€šAPIï¼ˆå¯èƒ½åŒ…å«å¤–éƒ¨æ•°æ®ï¼‰
const response = await fetch(`${API_URL}/motorcycles`);

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¸“ç”¨sitemap APIï¼ˆåªæœ‰æ•°æ®åº“æ•°æ®ï¼‰
const response = await fetch(`${API_URL}/sitemap/motorcycles`);
```

**4. å®ç°åˆ†å‰²Sitemap**

åˆ›å»ºsitemapç´¢å¼•å’Œå¤šä¸ªå­sitemapï¼š

```typescript
// sitemap-index.xml -> ä¸»ç´¢å¼•
//   â”œâ”€ sitemap-static.xml (6ä¸ªé™æ€é¡µé¢)
//   â”œâ”€ sitemap-motorcycles.xml (126æ¡)
//   â”œâ”€ sitemap-cars.xml (124æ¡)
//   â”œâ”€ sitemap-reviews.xml (89æ¡)
//   â””â”€ sitemap-marketplace.xml (20æ¡ï¼Œåªæœ‰æ•°æ®åº“æ•°æ®)
```

**5. æ›´æ–°robots.txt**

```
# æŒ‡å‘æ–°çš„sitemapç´¢å¼•
Sitemap: https://vietmoto.top/sitemap-index.xml
```

**6. é‡æ–°éƒ¨ç½²**

```bash
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
sudo ./deploy.sh
```

**éªŒè¯æ–¹æ³•ï¼š**

```bash
# 1. æµ‹è¯•ä¸“ç”¨sitemap API
curl http://localhost:4001/api/sitemap/marketplace
# åº”è¯¥åªè¿”å›20æ¡å·¦å³ï¼ˆæ•°æ®åº“æ•°æ®ï¼‰

# 2. å¯¹æ¯”æ™®é€šAPI
curl http://localhost:4001/api/marketplace?limit=1000
# è¿”å›1000+æ¡ï¼ˆåŒ…å«å¤–éƒ¨æ•°æ®ï¼‰

# 3. æ£€æŸ¥sitemapæ–‡ä»¶
curl http://localhost:4321/sitemap-marketplace.xml | grep -c "<url>"
# åº”è¯¥æ˜¯20æ¡å·¦å³

# 4. æŸ¥çœ‹æ•°æ®åº“å®é™…æ•°é‡
sqlite3 /var/www/vietnam-moto-auto/backend/database/vietnam_moto_auto.sqlite \
  "SELECT COUNT(*) FROM marketplace_vehicles WHERE status='active';"
```

**é¢„æœŸç»“æœï¼š**

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| Sitemapæ€»URLæ•° | 1343 | ~365 |
| Marketplace URL | 1000+ | ~20 |
| Googleç´¢å¼•ç‡ | 69% (932/1343) | ~100% |
| æ— æ•ˆé“¾æ¥ | 400+ | 0 |

**é‡è¦æç¤ºï¼š**

1. **åŒºåˆ†APIç”¨é€”**ï¼š
   - å‰ç«¯å±•ç¤ºAPIï¼šå¯ä»¥åŒ…å«å¤–éƒ¨æ•°æ®ï¼ˆç”¨æˆ·å¯ä»¥è·³è½¬åˆ°å¤–éƒ¨ç½‘ç«™ï¼‰
   - Sitemap APIï¼šåªèƒ½åŒ…å«æœ¬ç«™çœŸå®é¡µé¢

2. **æ•°æ®åº“ä¼˜å…ˆ**ï¼š
   - Sitemapå¿…é¡»100%åŸºäºæ•°æ®åº“
   - ä¸è¦åŒ…å«ä»»ä½•å¤–éƒ¨APIæ•°æ®
   - ä¸è¦åŒ…å«ä¸´æ—¶æ•°æ®æˆ–ç¼“å­˜æ•°æ®

3. **å®šæœŸéªŒè¯**ï¼š
   ```bash
   # æ£€æŸ¥sitemap URLæ•°é‡æ˜¯å¦åˆç†
   curl http://localhost:4321/sitemap-index.xml
   
   # å¯¹æ¯”æ•°æ®åº“å®é™…æ•°é‡
   sqlite3 vietnam_moto_auto.sqlite "SELECT 
     (SELECT COUNT(*) FROM motorcycles WHERE status='active') as motos,
     (SELECT COUNT(*) FROM cars WHERE status='active') as cars,
     (SELECT COUNT(*) FROM news WHERE status='published') as reviews,
     (SELECT COUNT(*) FROM marketplace_vehicles WHERE status='active') as marketplace;"
   ```

4. **Google Search Consoleç›‘æ§**ï¼š
   - æäº¤æ–°sitemapåç­‰å¾…24-48å°æ—¶
   - æ£€æŸ¥"å·²å‘ç°çš„ç½‘é¡µ"æ•°é‡æ˜¯å¦åŒ¹é…
   - æŸ¥çœ‹æ˜¯å¦è¿˜æœ‰404é”™è¯¯

**é€‚ç”¨åœºæ™¯ï¼š**
- ä½¿ç”¨å¤–éƒ¨APIèšåˆæ•°æ®çš„ç½‘ç«™
- éœ€è¦ç²¾ç¡®æ§åˆ¶sitemapå†…å®¹çš„åœºæ™¯
- SEOä¼˜åŒ–å’ŒGoogleç´¢å¼•ç®¡ç†
- æ•°æ®æ¥æºå¤šæ ·åŒ–çš„å¹³å°

**ç›¸å…³æ–‡æ¡£ï¼š**
- APIè·¯ç”±å¼€å‘æ–‡æ¡£ï¼šSitemapæ¨¡å—APIç« èŠ‚
- SEOä¼˜åŒ–æ–‡æ¡£ï¼šSitemapæœ€ä½³å®è·µ

---

### æ¡ˆä¾‹8ï¼šéƒ¨ç½²è„šæœ¬è¦†ç›–æ‰‹åŠ¨ä¿®æ”¹ï¼ˆ2025-10-12ï¼‰

**é—®é¢˜æè¿°ï¼š**
- æ‰‹åŠ¨ä¿®æ”¹äº†ç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–‡ä»¶
- è¿è¡Œ `deploy.sh` åï¼Œä¿®æ”¹è¢«è¦†ç›–äº†

**æ ¹æœ¬åŸå› ï¼š**
- éƒ¨ç½²è„šæœ¬ä¼šä»æºç›®å½•å¤åˆ¶æ‰€æœ‰æ–‡ä»¶
- ç”Ÿäº§ç¯å¢ƒçš„æ‰‹åŠ¨ä¿®æ”¹ä¼šä¸¢å¤±

**æ­£ç¡®åšæ³•ï¼š**

âš ï¸ **æ°¸è¿œä¿®æ”¹æºæ–‡ä»¶ï¼Œä¸è¦ç›´æ¥ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒæ–‡ä»¶ï¼**

```bash
# âœ… æ­£ç¡®ï¼šä¿®æ”¹æºæ–‡ä»¶
vi /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/astro.config.mjs
vi /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/nginx/vietnam-moto-auto.conf

# ç„¶åé‡æ–°éƒ¨ç½²
sudo ./deploy.sh

# âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒ
vi /var/www/vietnam-moto-auto/frontend/astro.config.mjs  # ä¸‹æ¬¡éƒ¨ç½²ä¼šè¢«è¦†ç›–ï¼
```

**éœ€è¦ä¿®æ”¹æºæ–‡ä»¶çš„é…ç½®ï¼š**
1. `frontend/astro.config.mjs` - Astroé…ç½®
2. `frontend/.env.production` - å‰ç«¯ç¯å¢ƒå˜é‡
3. `nginx/vietnam-moto-auto.conf` - Nginxé…ç½®
4. `backend/.env.production` - åç«¯ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœæœ‰ï¼‰
5. `systemd/vietnam-moto-*.service` - SystemdæœåŠ¡é…ç½®

---

### æ¡ˆä¾‹9ï¼šCSSæ–‡ä»¶åå¤§å°å†™ä¸åŒ¹é…å¯¼è‡´æ ·å¼åŠ è½½å¤±è´¥ï¼ˆ2025-10-15ï¼‰âš ï¸ å…³é”®é—®é¢˜

**é—®é¢˜æè¿°ï¼š**
- ç½‘ç«™æ‰“å¼€åå®Œå…¨æ˜¯ç™½é¡µï¼Œæ‰€æœ‰æ ·å¼éƒ½æ²¡æœ‰åŠ è½½
- æµè§ˆå™¨æ§åˆ¶å°æŠ¥é”™ï¼š`Refused to apply style from 'https://vietmoto.top/_astro/_slug_.bmmjdtr-.css' because its MIME type ('text/html') is not a supported stylesheet MIME type`
- é”™è¯¯ä¿¡æ¯æ˜¾ç¤º `net::ERR_ABORTED 404 (Not Found)`
- æ£€æŸ¥å‘ç°CSSæ–‡ä»¶å®é™…åç§°æ˜¯ `_slug_.bmmJdTr-.css`ï¼ˆæ··åˆå¤§å°å†™ï¼‰ï¼Œä½†æµè§ˆå™¨è¯·æ±‚çš„æ˜¯ `_slug_.bmmjdtr-.css`ï¼ˆå…¨å°å†™ï¼‰

**é—®é¢˜å½±å“ï¼š**
- ğŸ”´ ä¸¥é‡æ€§ï¼šæé«˜ï¼ˆæ•´ä¸ªç½‘ç«™æ— æ³•ä½¿ç”¨ï¼‰
- ğŸ”´ ç”¨æˆ·ä½“éªŒï¼šæ‰€æœ‰è®¿å®¢çœ‹åˆ°ç™½é¡µ
- ğŸ”´ SEOå½±å“ï¼šGoogleä¼šè®¤ä¸ºç½‘ç«™æœ‰é—®é¢˜
- ğŸ”´ ä¸šåŠ¡å½±å“ï¼šå®Œå…¨æ— æ³•è®¿é—®

**æ ¹æœ¬åŸå› åˆ†æï¼š**

1. **Astro Hybrid æ¨¡å¼çš„æ„å»ºç‰¹æ€§**ï¼š
   - Viteåœ¨æ„å»ºæ—¶ä¼šå¯¹CSSæ–‡ä»¶åè¿›è¡Œå“ˆå¸Œå¤„ç†
   - å“ˆå¸Œå€¼åŒ…å«å¤§å°å†™å­—æ¯ï¼ˆå¦‚ `bmmJdTr-`ï¼‰
   - æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ä¼šç”ŸæˆåŒ…å«è¿™äº›å“ˆå¸Œçš„HTML

2. **æµè§ˆå™¨ç¼“å­˜é—®é¢˜**ï¼š
   - ç”¨æˆ·æµè§ˆå™¨å¯èƒ½ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„HTML
   - æ—§HTMLä¸­å¼•ç”¨çš„CSSæ–‡ä»¶åå¯èƒ½æ˜¯å°å†™çš„
   - æ–°æ„å»ºç”Ÿæˆçš„æ–‡ä»¶åæ˜¯æ··åˆå¤§å°å†™çš„

3. **Linuxæ–‡ä»¶ç³»ç»ŸåŒºåˆ†å¤§å°å†™**ï¼š
   - Linuxç³»ç»Ÿä¸¥æ ¼åŒºåˆ†æ–‡ä»¶åå¤§å°å†™
   - `bmmJdTr-` å’Œ `bmmjdtr-` æ˜¯ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶
   - Nginxé»˜è®¤ä¹ŸåŒºåˆ†å¤§å°å†™

4. **Nginxé…ç½®é—®é¢˜**ï¼š
   - é™æ€èµ„æºé€šè¿‡Nginxç›´æ¥æä¾›ï¼ˆä½¿ç”¨aliasï¼‰
   - Nginxåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾ä¸åˆ°å°å†™æ–‡ä»¶å
   - è¿”å›404ï¼Œä½†content-typeæ˜¯text/htmlï¼ˆNginxçš„404é¡µé¢ï¼‰

**æŠ€æœ¯ç»†èŠ‚ï¼š**

```bash
# å®é™…æ„å»ºäº§ç‰©
/var/www/vietnam-moto-auto/frontend/dist/client/_astro/_slug_.bmmJdTr-.css  âœ… å­˜åœ¨

# æµè§ˆå™¨è¯·æ±‚ï¼ˆå¯èƒ½æ¥è‡ªç¼“å­˜çš„æ—§HTMLï¼‰
GET /_astro/_slug_.bmmjdtr-.css  âŒ 404é”™è¯¯

# Nginxé…ç½®
location /_astro/ {
    alias /var/www/vietnam-moto-auto/frontend/dist/client/_astro/;
    # æ–‡ä»¶ç³»ç»ŸæŸ¥æ‰¾å¤±è´¥ â†’ 404
}
```

**è§£å†³æ–¹æ¡ˆï¼ˆä¸‰å±‚é˜²æŠ¤ï¼‰ï¼š**

**ä¸´æ—¶æ–¹æ¡ˆï¼ˆåº”æ€¥ä¿®å¤ï¼‰ï¼š**
```bash
# åˆ›å»ºå°å†™æ–‡ä»¶åçš„ç¬¦å·é“¾æ¥
cd /var/www/vietnam-moto-auto/frontend/dist/client/_astro
ln -sf _slug_.bmmJdTr-.css _slug_.bmmjdtr-.css

# éªŒè¯
ls -la | grep slug
# åº”è¯¥çœ‹åˆ°ï¼š
# lrwxrwxrwx _slug_.bmmjdtr-.css -> _slug_.bmmJdTr-.css
# -rw-r--r-- _slug_.bmmJdTr-.css
```

**æ°¸ä¹…æ–¹æ¡ˆ1ï¼šåœ¨éƒ¨ç½²è„šæœ¬ä¸­è‡ªåŠ¨å¤„ç†**

ä¿®æ”¹ `deploy.sh` å’Œ `quick-deploy.sh`ï¼Œåœ¨æ„å»ºå®Œæˆåè‡ªåŠ¨åˆ›å»ºç¬¦å·é“¾æ¥ï¼š

```bash
# åœ¨å‰ç«¯æ„å»ºå®Œæˆåæ·»åŠ ä»¥ä¸‹ä»£ç 

log_info "åˆ›å»ºCSSæ–‡ä»¶åå¤§å°å†™å…¼å®¹ç¬¦å·é“¾æ¥..."
cd "$TARGET_DIR/frontend/dist/client/_astro"

# ä¸ºæ‰€æœ‰CSSæ–‡ä»¶åˆ›å»ºå°å†™ç‰ˆæœ¬çš„ç¬¦å·é“¾æ¥
for file in *.css; do
    lowercase=$(echo "$file" | tr '[:upper:]' '[:lower:]')
    if [ "$file" != "$lowercase" ]; then
        ln -sf "$file" "$lowercase"
        log_success "åˆ›å»ºé“¾æ¥: $lowercase -> $file"
    fi
done

cd -
```

**æ°¸ä¹…æ–¹æ¡ˆ2ï¼šé…ç½®Nginxå¤§å°å†™ä¸æ•æ„Ÿ**

```nginx
# /etc/nginx/conf.d/vietmoto.conf

# ä¸º_astroç›®å½•æ·»åŠ å¤§å°å†™ä¸æ•æ„Ÿå¤„ç†
location ~ ^/_astro/(.*)$ {
    alias /var/www/vietnam-moto-auto/frontend/dist/client/_astro/$1;
    
    # å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°è¯•å°å†™ç‰ˆæœ¬
    try_files $uri $uri/ =404;
    
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
}
```

**æ°¸ä¹…æ–¹æ¡ˆ3ï¼šæ¸…ç†æµè§ˆå™¨ç¼“å­˜çš„æœºåˆ¶**

åœ¨HTMLçš„`<head>`ä¸­æ·»åŠ cache-bustingæœºåˆ¶ï¼š

```html
<!-- åœ¨BaseLayout.astroä¸­ -->
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
```

æˆ–è€…ä½¿ç”¨ç‰ˆæœ¬å·ï¼š

```javascript
// astro.config.mjs
export default defineConfig({
  vite: {
    build: {
      rollupOptions: {
        output: {
          // ä½¿ç”¨æ›´ç®€å•çš„å“ˆå¸Œç­–ç•¥
          entryFileNames: '_astro/[name].[hash].js',
          chunkFileNames: '_astro/[name].[hash].js',
          assetFileNames: '_astro/[name].[hash][extname]'
        }
      }
    }
  }
});
```

**ä¿®å¤åçš„éƒ¨ç½²æµç¨‹ï¼š**

```bash
# 1. æ¸…ç†æ—§æ„å»º
cd /var/www/vietnam-moto-auto/frontend
rm -rf dist .astro

# 2. é‡æ–°æ„å»º
npm run build

# 3. åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
cd dist/client/_astro
for file in *.css *.js; do
    lowercase=$(echo "$file" | tr '[:upper:]' '[:lower:]')
    if [ "$file" != "$lowercase" ]; then
        ln -sf "$file" "$lowercase"
    fi
done

# 4. é‡å¯æœåŠ¡
systemctl restart vietnam-moto-frontend
systemctl reload nginx

# 5. éªŒè¯
curl -I https://vietmoto.top/_astro/_slug_.bmmJdTr-.css  # åº”è¯¥200
curl -I https://vietmoto.top/_astro/_slug_.bmmjdtr-.css  # ä¹Ÿåº”è¯¥200
```

**éªŒè¯æ–¹æ³•ï¼š**

```bash
# 1. æ£€æŸ¥æ‰€æœ‰CSSæ–‡ä»¶
ls -la /var/www/vietnam-moto-auto/frontend/dist/client/_astro/*.css

# 2. æµ‹è¯•æ‰€æœ‰ç‰ˆæœ¬éƒ½èƒ½è®¿é—®
curl -I https://vietmoto.top/_astro/_slug_.bmmJdTr-.css
curl -I https://vietmoto.top/_astro/_slug_.bmmjdtr-.css
curl -I https://vietmoto.top/_astro/_slug_.BMMJDTR-.css

# 3. æ£€æŸ¥ç¬¦å·é“¾æ¥
ls -la /var/www/vietnam-moto-auto/frontend/dist/client/_astro/ | grep -E "\.css|\.js"

# 4. æµè§ˆå™¨æµ‹è¯•
# æ‰“å¼€ https://vietmoto.top
# æŒ‰F12æŸ¥çœ‹Networkæ ‡ç­¾
# ç¡®è®¤æ‰€æœ‰CSSæ–‡ä»¶éƒ½æ˜¯200çŠ¶æ€
```

**é¢„é˜²æªæ–½ï¼ˆæ·»åŠ åˆ°éƒ¨ç½²æ£€æŸ¥æ¸…å•ï¼‰ï¼š**

1. **éƒ¨ç½²å‰æ£€æŸ¥**ï¼š
   ```bash
   # æ£€æŸ¥æ˜¯å¦æœ‰å¤§å°å†™æ··åˆçš„æ–‡ä»¶å
   find dist/client/_astro -name "*[A-Z]*" -o -name "*[a-z]*"
   ```

2. **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼š
   ```bash
   # åœ¨deploy.shä¸­æ·»åŠ CSSåŠ è½½æµ‹è¯•
   log_info "æµ‹è¯•CSSæ–‡ä»¶è®¿é—®..."
   for css in $(ls dist/client/_astro/*.css | head -3); do
       filename=$(basename "$css")
       if ! curl -f "http://localhost:4321/_astro/$filename" > /dev/null 2>&1; then
           log_error "CSSæ–‡ä»¶è®¿é—®å¤±è´¥: $filename"
           exit 1
       fi
   done
   log_success "CSSæ–‡ä»¶è®¿é—®æµ‹è¯•é€šè¿‡"
   ```

3. **ç›‘æ§å‘Šè­¦**ï¼š
   ```bash
   # è®¾ç½®ç›‘æ§è„šæœ¬
   #!/bin/bash
   # /root/check-css-loading.sh
   
   # æ£€æŸ¥CSS 404é”™è¯¯
   css_404=$(tail -100 /var/log/nginx/vietmoto.access.log | grep "\.css" | grep " 404 " | wc -l)
   
   if [ $css_404 -gt 0 ]; then
       echo "è­¦å‘Šï¼šæ£€æµ‹åˆ° $css_404 ä¸ªCSSæ–‡ä»¶404é”™è¯¯"
       # å‘é€å‘Šè­¦é€šçŸ¥
   fi
   ```

**æ ¹æœ¬åŸå› æ€»ç»“ï¼š**

è¿™ä¸ªé—®é¢˜æš´éœ²äº†å‡ ä¸ªç³»ç»Ÿæ€§é—®é¢˜ï¼š

1. **æ„å»ºç³»ç»Ÿä¸ç¡®å®šæ€§**ï¼šViteçš„å“ˆå¸Œç®—æ³•å¯èƒ½åœ¨ä¸åŒæ„å»ºä¸­äº§ç”Ÿä¸åŒå¤§å°å†™
2. **ç¼“å­˜ç®¡ç†ä¸å½“**ï¼šæ²¡æœ‰æœ‰æ•ˆçš„ç¼“å­˜å¤±æ•ˆæœºåˆ¶
3. **éƒ¨ç½²æµç¨‹ä¸å®Œå–„**ï¼šæ²¡æœ‰éªŒè¯èµ„æºæ–‡ä»¶çš„å¯è®¿é—®æ€§
4. **ç›‘æ§ç¼ºå¤±**ï¼šæ²¡æœ‰åŠæ—¶å‘ç°CSSåŠ è½½å¤±è´¥

**é•¿æœŸæ”¹è¿›è®¡åˆ’ï¼š**

1. **æ ‡å‡†åŒ–æ„å»ºè¾“å‡º**ï¼š
   - é…ç½®Viteä½¿ç”¨å…¨å°å†™æˆ–å…¨å¤§å†™å“ˆå¸Œ
   - æˆ–è€…ä½¿ç”¨ç‰ˆæœ¬å·æ›¿ä»£å“ˆå¸Œ

2. **å®Œå–„éƒ¨ç½²è„šæœ¬**ï¼š
   - è‡ªåŠ¨åˆ›å»ºå¤§å°å†™å…¼å®¹çš„ç¬¦å·é“¾æ¥
   - æ·»åŠ èµ„æºæ–‡ä»¶è®¿é—®æ€§æµ‹è¯•
   - éƒ¨ç½²åè‡ªåŠ¨éªŒè¯å…³é”®CSSæ–‡ä»¶

3. **æ”¹è¿›ç¼“å­˜ç­–ç•¥**ï¼š
   - ä½¿ç”¨ç‰ˆæœ¬å·ç®¡ç†é™æ€èµ„æº
   - æ·»åŠ å¼ºåˆ¶åˆ·æ–°æœºåˆ¶
   - é…ç½®åˆç†çš„Cache-Controlå¤´

4. **ç›‘æ§å’Œå‘Šè­¦**ï¼š
   - ç›‘æ§404é”™è¯¯ç‡
   - ç›‘æ§CSSåŠ è½½å¤±è´¥
   - è®¾ç½®å‘Šè­¦é˜ˆå€¼

**é€‚ç”¨åœºæ™¯ï¼š**
- ä½¿ç”¨Astroæˆ–Viteæ„å»ºçš„é¡¹ç›®
- Linuxç”Ÿäº§ç¯å¢ƒï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ä½¿ç”¨Nginxæä¾›é™æ€èµ„æº
- æœ‰é•¿æœŸç¼“å­˜ç­–ç•¥çš„ç½‘ç«™

**ç›¸å…³é…ç½®æ–‡ä»¶ï¼š**
- `/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/deploy.sh` - éœ€è¦æ·»åŠ ç¬¦å·é“¾æ¥åˆ›å»º
- `/root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/quick-deploy.sh` - éœ€è¦æ·»åŠ ç¬¦å·é“¾æ¥åˆ›å»º
- `/etc/nginx/conf.d/vietmoto.conf` - Nginxé™æ€èµ„æºé…ç½®
- `frontend/astro.config.mjs` - Astroæ„å»ºé…ç½®

**é‡è¦æç¤ºï¼š**

âš ï¸ **è¿™æ˜¯ä¸€ä¸ªçœ‹ä¼¼ç®€å•ä½†å½±å“å·¨å¤§çš„é—®é¢˜**ï¼š
- ç—‡çŠ¶ï¼šæ•´ä¸ªç½‘ç«™ç™½å±
- åŸå› ï¼šä¸€ä¸ªCSSæ–‡ä»¶404
- æ ¹æºï¼šæ–‡ä»¶åå¤§å°å†™ä¸åŒ¹é…
- æ•™è®­ï¼šç»†èŠ‚å†³å®šæˆè´¥

âœ… **ä¿®å¤åå¿…é¡»åšçš„äº‹**ï¼š
1. æ¸…ç©ºæ‰€æœ‰æµè§ˆå™¨ç¼“å­˜
2. ä½¿ç”¨éšç§æ¨¡å¼æµ‹è¯•
3. æ£€æŸ¥æ‰€æœ‰CSSæ–‡ä»¶éƒ½èƒ½æ­£å¸¸åŠ è½½
4. æ›´æ–°éƒ¨ç½²è„šæœ¬ï¼Œé˜²æ­¢å¤å‘

---

## ğŸ“ æ›´æ–°æ—¥å¿—

**v4.0.0 (2025-10-15)** ğŸ“š æ–‡æ¡£æ•´åˆé‡å¤§æ›´æ–°
- âœ… **æ•´åˆä¸‰ä¸ªéƒ¨ç½²æ–‡æ¡£ä¸ºä¸€ä¸ªç»Ÿä¸€ä¸»æ–‡æ¡£**
- âœ… æ–°å¢å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•ç« èŠ‚ï¼ˆ100+æ£€æŸ¥é¡¹ï¼‰
- âœ… æ•´åˆè‡ªåŠ¨åŒ–å¥åº·æ£€æŸ¥å·¥å…·è¯´æ˜
- âœ… æ›´æ–°ä¸ºå½“å‰ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆSSRæ¨¡å¼ã€åŸŸå+SSLï¼‰
- âœ… åˆ é™¤é‡å¤æ–‡æ¡£ï¼šéƒ¨ç½²æ£€æŸ¥æ¸…å•.mdã€éƒ¨ç½²ç¯èŠ‚ç³»ç»Ÿæ’æŸ¥æ€»ç»“.md
- âœ… ç»Ÿä¸€éƒ¨ç½²æµç¨‹å’Œæœ€ä½³å®è·µ
- âœ… å®Œå–„å¸¸è§é—®é¢˜å¿«é€Ÿä¿®å¤æŒ‡å—
- âš ï¸ é‡è¦ï¼šç°åœ¨åªéœ€å‚è€ƒè¿™ä¸€ä¸ªéƒ¨ç½²æ–‡æ¡£

**v3.5.0 (2025-10-15)** ğŸ”´ å…³é”®æ›´æ–°
- âœ… **ä¿®å¤CSSæ–‡ä»¶åå¤§å°å†™ä¸åŒ¹é…é—®é¢˜ï¼ˆæ¡ˆä¾‹9ï¼‰**
- âœ… æ·»åŠ è‡ªåŠ¨åˆ›å»ºç¬¦å·é“¾æ¥æœºåˆ¶
- âœ… æ›´æ–°éƒ¨ç½²è„šæœ¬é˜²æ­¢CSSåŠ è½½å¤±è´¥
- âœ… æ·»åŠ CSSæ–‡ä»¶è®¿é—®æ€§æµ‹è¯•
- âœ… å®Œå–„Nginxé™æ€èµ„æºé…ç½®
- âœ… æ·»åŠ ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- âš ï¸ è¿™æ˜¯ä¸€ä¸ªä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒçš„å…³é”®ä¿®å¤

**v3.4.0 (2025-10-14 ä¸‹åˆ)**
- âœ… æ–°å¢Sitemapæ•°æ®ä¸å‡†ç¡®é—®é¢˜æ¡ˆä¾‹ï¼ˆæ¡ˆä¾‹7ï¼‰
- âœ… æ·»åŠ ä¸“ç”¨Sitemap APIåˆ›å»ºæŒ‡å—
- âœ… å®Œå–„SEO sitemapæœ€ä½³å®è·µæ–‡æ¡£
- âœ… æ·»åŠ æ•°æ®æ¥æºéªŒè¯æ–¹æ³•
- âœ… æ›´æ–°Googleç´¢å¼•ä¼˜åŒ–å»ºè®®

**v3.3.0 (2025-10-14 ä¸‹åˆ)**
- âœ… æ–°å¢SSRè¯¦æƒ…é¡µä¿®å¤å®Œæ•´æ¡ˆä¾‹ï¼ˆæ¡ˆä¾‹6ï¼‰
- âœ… ä¿®å¤5ä¸ªè¯¦æƒ…é¡µSSRæ¸²æŸ“é—®é¢˜
- âœ… åŒºåˆ†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯APIè°ƒç”¨æ–¹å¼
- âœ… æ·»åŠ SSRç¯å¢ƒAPIè°ƒç”¨æœ€ä½³å®è·µ
- âœ… æ›´æ–°prerenderé…ç½®è¯´æ˜
- âœ… å®Œå–„SSRå’ŒCSRè¯·æ±‚æµç¨‹å¯¹æ¯”

**v3.2.0 (2025-10-14 ä¸Šåˆ)**
- âœ… æ–°å¢åŸŸå+SSLéƒ¨ç½²å®Œæ•´æ¡ˆä¾‹ï¼ˆæ¡ˆä¾‹5ï¼‰
- âœ… ä¿®å¤HTTPSæ··åˆå†…å®¹é”™è¯¯ï¼ˆMixed Contentï¼‰
- âœ… ä¿®å¤11ä¸ªå‰ç«¯æ–‡ä»¶çš„APIè°ƒç”¨è·¯å¾„
- âœ… æ·»åŠ åŸŸå+SSLéƒ¨ç½²æ£€æŸ¥è„šæœ¬
- âœ… æ›´æ–°éƒ¨ç½²è„šæœ¬ï¼šè‡ªåŠ¨åˆ é™¤.env.production
- âœ… å®Œå–„å‰ç«¯APIè·¯å¾„ä½¿ç”¨è§„èŒƒ
- âœ… æ–°å¢SSLéƒ¨ç½²æœ€ä½³å®è·µæ–‡æ¡£

**v3.1.0 (2025-10-14)**
- âœ… æ–°å¢ `pre-deploy-check.sh` éƒ¨ç½²å‰æ£€æŸ¥è„šæœ¬
- âœ… ä¿®å¤å‰ç«¯æ„å»ºæ£€æŸ¥ï¼ˆæ”¯æŒ Astro Hybrid æ¨¡å¼ï¼‰
- âœ… æ–°å¢æ•°æ®åº“è¡¨ç»“æ„è‡ªåŠ¨åŒæ­¥åŠŸèƒ½
- âœ… è‡ªåŠ¨éªŒè¯ marketplace_vehicles å’Œ reviews è¡¨
- âœ… ä¿®æ­£å¼€å‘ç¯å¢ƒæ•°æ®åº“è·¯å¾„
- âœ… å®Œå–„ `quick-deploy.sh` å¥åº·æ£€æŸ¥
- âœ… æ”¯æŒ dist/client å’Œ dist/server ç»“æ„
- âœ… å®Œå–„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶

**v2.1 (2025-10-12 ä¸‹åˆ)**
- âœ… ä¿®å¤å‰ç«¯æœåŠ¡æœªè‡ªåŠ¨å¯åŠ¨é—®é¢˜
- âœ… æ·»åŠ å‰ç«¯æœåŠ¡å¥åº·æ£€æŸ¥
- âœ… ä¿®å¤Nginxé…ç½®å†²çªé—®é¢˜
- âœ… æ›´æ–°è®¿é—®åœ°å€è¯´æ˜ï¼ˆ4321ä¸ºä¸»è¦ç«¯å£ï¼‰
- âœ… æ·»åŠ éƒ¨ç½²é—®é¢˜æ¡ˆä¾‹æ–‡æ¡£
- âœ… æ¸…ç†cryptopulseé…ç½®æ–‡ä»¶

**v2.0 (2025-10-12 ä¸Šåˆ)**
- âœ… å½»åº•é‡å†™éƒ¨ç½²è„šæœ¬
- âœ… æ·»åŠ ä¸‰é‡æ•°æ®åº“ä¿æŠ¤æœºåˆ¶
- âœ… å®ç°è‡ªåŠ¨å›æ»šåŠŸèƒ½
- âœ… æ·»åŠ å®Œæ•´çš„éªŒè¯æ£€æŸ¥
- âœ… æ”¹ç”¨taræ›¿ä»£rsyncï¼ˆä¸ä¾èµ–å¤–éƒ¨å·¥å…·ï¼‰
- âœ… ä¼˜åŒ–12æ­¥éƒ¨ç½²æµç¨‹

**v1.0 (2025-10-11)**
- åˆå§‹ç‰ˆæœ¬
- åŸºç¡€éƒ¨ç½²åŠŸèƒ½
- MySQLåˆ°SQLiteè¿ç§»

---

**æœ€åæ›´æ–°**ï¼š2025å¹´10æœˆ15æ—¥  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv4.0.0ï¼ˆæ–‡æ¡£æ•´åˆç‰ˆï¼‰  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ  
**é‡è¦è¯´æ˜**ï¼šæœ¬æ–‡æ¡£æ•´åˆäº†åŸæœ‰çš„ä¸‰ä¸ªéƒ¨ç½²æ–‡æ¡£ï¼Œç°åœ¨æ˜¯å”¯ä¸€çš„éƒ¨ç½²å‚è€ƒæ–‡æ¡£

---

## ğŸ” åŸŸå+SSLéƒ¨ç½²æŒ‡å—

### åŸŸåå’ŒSSLéƒ¨ç½²ä¸IPéƒ¨ç½²çš„åŒºåˆ«

**IPåœ°å€éƒ¨ç½²ï¼ˆHTTPï¼‰ï¼š**
```bash
å‰ç«¯: http://47.237.79.9:4321
åç«¯: http://47.237.79.9:4001
ç‰¹ç‚¹: å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®åç«¯åœ°å€
```

**åŸŸå+SSLéƒ¨ç½²ï¼ˆHTTPSï¼‰ï¼š**
```bash
å‰ç«¯: https://vietmoto.top
åç«¯: https://vietmoto.top/api (é€šè¿‡Nginxä»£ç†)
ç‰¹ç‚¹: å¿…é¡»ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæ‰€æœ‰APIé€šè¿‡Nginxä»£ç†
```

### åŸŸå+SSLéƒ¨ç½²æ£€æŸ¥æ¸…å•

**éƒ¨ç½²å‰æ£€æŸ¥ï¼š**
- [ ] åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨IP
- [ ] SSLè¯ä¹¦å·²ç”³è¯·å¹¶é…ç½®
- [ ] Nginxå·²é…ç½®HTTPSå’ŒAPIä»£ç†
- [ ] åˆ é™¤æ‰€æœ‰å‰ç«¯ `.env*` æ–‡ä»¶
- [ ] æ£€æŸ¥å‰ç«¯ä»£ç æ— ç¡¬ç¼–ç HTTPåœ°å€

**æ£€æŸ¥å‘½ä»¤ï¼š**
```bash
# 1. æ£€æŸ¥åŸŸåè§£æ
nslookup vietmoto.top

# 2. æ£€æŸ¥SSLè¯ä¹¦
openssl s_client -connect vietmoto.top:443 -servername vietmoto.top < /dev/null

# 3. æ£€æŸ¥Nginxé…ç½®
nginx -t
grep -A 10 "location /api" /etc/nginx/conf.d/*.conf

# 4. æ£€æŸ¥å‰ç«¯ç¯å¢ƒå˜é‡
ls -la /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/.env*

# 5. æ£€æŸ¥ç¡¬ç¼–ç åœ°å€
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend
grep -r "localhost:4001\|47\.237\.79\.9" src/
```

### å¸¸è§é”™è¯¯å’Œè§£å†³

**é”™è¯¯1ï¼šMixed Content**
```
åŸå› ï¼šHTTPSé¡µé¢è¯·æ±‚HTTPèµ„æº
è§£å†³ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ /apiï¼Œé€šè¿‡Nginxä»£ç†
```

**é”™è¯¯2ï¼šAPIè¿”å›404**
```
åŸå› ï¼šNginxæœªæ­£ç¡®é…ç½®APIä»£ç†
è§£å†³ï¼šæ£€æŸ¥ location /api/ é…ç½®
```

**é”™è¯¯3ï¼šSSLè¯ä¹¦é”™è¯¯**
```
åŸå› ï¼šè¯ä¹¦è¿‡æœŸæˆ–åŸŸåä¸åŒ¹é…
è§£å†³ï¼šé‡æ–°ç”³è¯·è¯ä¹¦æˆ–æ£€æŸ¥åŸŸåé…ç½®
```

### éƒ¨ç½²æµç¨‹ï¼ˆåŸŸå+SSLï¼‰

```bash
# 1. åˆ é™¤ç¯å¢ƒå˜é‡æ–‡ä»¶
rm -f /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend/.env*

# 2. æ£€æŸ¥APIè·¯å¾„
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™/frontend
grep -r "localhost:4001\|47\.237\.79\.9" src/
# åº”è¯¥æ— ç»“æœ

# 3. æ­£å¸¸éƒ¨ç½²
cd /root/è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™
sudo ./deploy.sh

# 4. éªŒè¯
curl https://vietmoto.top/api/health
curl https://vietmoto.top/
```
