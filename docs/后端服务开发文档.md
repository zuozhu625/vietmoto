# è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™ - åç«¯æœåŠ¡å¼€å‘æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•è¶Šå—æ‘©æ‰˜æ±½è½¦ç½‘ç«™åç«¯æœåŠ¡çš„æ¶æ„ã€APIè®¾è®¡ã€æ•°æ®æ¨¡å‹ã€ä¸­é—´ä»¶å’ŒåŠŸèƒ½å®ç°ã€‚

### é¡¹ç›®ä¿¡æ¯
- **è¿è¡Œç¯å¢ƒ**: Node.js 20+
- **Webæ¡†æ¶**: Express.js 5.x
- **æ•°æ®åº“**: SQLite 3.x
- **ORM**: Sequelize 6.x
- **è¯­è¨€**: TypeScript 5.x
- **ç¼“å­˜**: Redis 7.xï¼ˆå¯é€‰ï¼‰
- **è®¤è¯**: JWT

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### 1. æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å®¢æˆ·ç«¯ï¼ˆå‰ç«¯ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/HTTPS
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Nginx åå‘ä»£ç†                        â”‚
â”‚        (è·¯ç”±åˆ†å‘ + é™æ€èµ„æº)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Express.js åº”ç”¨                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     ä¸­é—´ä»¶å±‚ (Middleware Layer)          â”‚  â”‚
â”‚  â”‚  â€¢ CORS                                  â”‚  â”‚
â”‚  â”‚  â€¢ Helmet (å®‰å…¨å¤´)                       â”‚  â”‚
â”‚  â”‚  â€¢ Rate Limiter (é€Ÿç‡é™åˆ¶)               â”‚  â”‚
â”‚  â”‚  â€¢ Morgan (æ—¥å¿—)                         â”‚  â”‚
â”‚  â”‚  â€¢ Body Parser                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       è·¯ç”±å±‚ (Route Layer)               â”‚  â”‚
â”‚  â”‚  â€¢ /api/news                             â”‚  â”‚
â”‚  â”‚  â€¢ /api/vehicles                         â”‚  â”‚
â”‚  â”‚  â€¢ /api/qa                               â”‚  â”‚
â”‚  â”‚  â€¢ /api/marketplace                      â”‚  â”‚
â”‚  â”‚  â€¢ /api/auth                             â”‚  â”‚
â”‚  â”‚  â€¢ /api/users                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    æ§åˆ¶å™¨å±‚ (Controller Layer)           â”‚  â”‚
â”‚  â”‚  â€¢ NewsController                        â”‚  â”‚
â”‚  â”‚  â€¢ VehicleController                     â”‚  â”‚
â”‚  â”‚  â€¢ QAController                          â”‚  â”‚
â”‚  â”‚  â€¢ MarketplaceController                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    æœåŠ¡å±‚ (Service Layer)                â”‚  â”‚
â”‚  â”‚  â€¢ ä¸šåŠ¡é€»è¾‘å¤„ç†                          â”‚  â”‚
â”‚  â”‚  â€¢ æ•°æ®éªŒè¯                              â”‚  â”‚
â”‚  â”‚  â€¢ äº‹åŠ¡ç®¡ç†                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     æ¨¡å‹å±‚ (Model Layer)                 â”‚  â”‚
â”‚  â”‚  â€¢ Sequelize Models                      â”‚  â”‚
â”‚  â”‚  â€¢ æ•°æ®éªŒè¯è§„åˆ™                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SQLite    â”‚      â”‚    Redis    â”‚
â”‚   æ•°æ®åº“    â”‚      â”‚    ç¼“å­˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.ts       # æ•°æ®åº“é…ç½®
â”‚   â”‚   â””â”€â”€ redis.ts          # Redisé…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ NewsController.ts
â”‚   â”‚   â””â”€â”€ MotorcycleController.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ News.ts
â”‚   â”‚   â””â”€â”€ Motorcycle.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/           # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ news.ts
â”‚   â”‚   â”œâ”€â”€ vehicles.ts
â”‚   â”‚   â”œâ”€â”€ qa.ts
â”‚   â”‚   â”œâ”€â”€ marketplace.ts
â”‚   â”‚   â”œâ”€â”€ sitemap.ts        # âœ¨ SEO sitemapä¸“ç”¨API
â”‚   â”‚   â”œâ”€â”€ users.ts
â”‚   â”‚   â””â”€â”€ upload.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ NewsService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.ts
â”‚   â”‚   â”œâ”€â”€ notFound.ts
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â””â”€â”€ validator.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ validators/       # æ•°æ®éªŒè¯
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/          # è„šæœ¬æ–‡ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ index.ts          # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ database/             # æ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ vietnam_moto_auto.sqlite
â”‚   â””â”€â”€ init-database.js
â”‚
â”œâ”€â”€ uploads/              # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ dist/                 # ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ tests/                # æµ‹è¯•æ–‡ä»¶
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ nodemon.json
```

---

## ğŸ”§ æ ¸å¿ƒé…ç½®

### 1. ç¯å¢ƒå˜é‡

**æ–‡ä»¶**: `.env` æˆ– `.env.production`

```env
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=4001
HOST=0.0.0.0

# æ•°æ®åº“é…ç½®ï¼ˆSQLiteï¼‰
DB_TYPE=sqlite
DB_PATH=./database/vietnam_moto_auto.sqlite
DB_LOGGING=false

# Redisé…ç½®ï¼ˆå¯é€‰ï¼‰
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d

# æ–‡ä»¶ä¸Šä¼ 
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_DIR=./logs

# CORSå…è®¸çš„æº
ALLOWED_ORIGINS=http://localhost:4321,https://vietmoto.top
```

---

### 2. æ•°æ®åº“é…ç½®

**æ–‡ä»¶**: `src/config/database.ts`

```typescript
import { Sequelize } from 'sequelize';
import dotenv from 'dotenv';
import path from 'path';

dotenv.config();

const {
  DB_PATH = path.join(__dirname, '../../database/vietnam_moto_auto.sqlite'),
  NODE_ENV = 'development'
} = process.env;

export const dbConfig = new Sequelize({
  dialect: 'sqlite',
  storage: DB_PATH,
  logging: NODE_ENV === 'development' ? console.log : false,
  pool: {
    max: 5,
    min: 0,
    acquire: 30000,
    idle: 10000,
  },
  define: {
    timestamps: true,
    underscored: true,
    freezeTableName: true,
  },
});

// æ•°æ®åº“è¿æ¥æµ‹è¯•
export const testConnection = async (): Promise<boolean> => {
  try {
    await dbConfig.authenticate();
    console.log('âœ… Database connection established successfully.');
    return true;
  } catch (error) {
    console.error('âŒ Unable to connect to the database:', error);
    return false;
  }
};
```

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ SQLite ä½œä¸ºæ•°æ®åº“
- è¿æ¥æ± é…ç½®
- å¼€å‘ç¯å¢ƒå¯ç”¨SQLæ—¥å¿—
- è‡ªåŠ¨timestampså’Œä¸‹åˆ’çº¿å‘½å

---

### 3. Redisé…ç½®

**æ–‡ä»¶**: `src/config/redis.ts`

```typescript
import { createClient } from 'redis';

const redisConfig = createClient({
  url: `redis://${process.env.REDIS_HOST || 'localhost'}:${process.env.REDIS_PORT || 6379}`,
  database: parseInt(process.env.REDIS_DB || '0'),
});

redisConfig.on('error', (err) => {
  console.error('Redis Client Error:', err);
});

redisConfig.on('connect', () => {
  console.log('âœ… Redis connected successfully');
});

export { redisConfig };
```

**ç”¨é€”**ï¼š
- ä¼šè¯å­˜å‚¨
- APIå“åº”ç¼“å­˜
- é€Ÿç‡é™åˆ¶è®¡æ•°
- å®æ—¶æ•°æ®ç¼“å­˜

---

## ğŸŒ API æ¥å£è®¾è®¡

### 1. æ¥å£è§„èŒƒ

#### åŸºç¡€URL
- **å¼€å‘ç¯å¢ƒ**: `http://localhost:4001/api`
- **ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰**: `https://vietmoto.top/api` â­ æ¨è
- **ç”Ÿäº§ç¯å¢ƒï¼ˆIPè®¿é—®ï¼‰**: `http://47.237.79.9:4001/api` âš ï¸ å·²å¼ƒç”¨

**âš ï¸ é‡è¦è¯´æ˜**ï¼šå½“å‰ç”Ÿäº§ç¯å¢ƒä½¿ç”¨åŸŸå+SSLéƒ¨ç½²
- å‰ç«¯é€šè¿‡ç›¸å¯¹è·¯å¾„ `/api` è°ƒç”¨API
- Nginxè‡ªåŠ¨ä»£ç†ï¼š`https://vietmoto.top/api/*` â†’ `http://127.0.0.1:4001/*`
- æµè§ˆå™¨çœ‹åˆ°çš„éƒ½æ˜¯HTTPSè¯·æ±‚
- ä¸è¦åœ¨å‰ç«¯ç¡¬ç¼–ç  `http://47.237.79.9:4001`

#### è¯·æ±‚æ ¼å¼
```
HTTP Method: GET | POST | PUT | DELETE
Content-Type: application/json
Authorization: Bearer <token>  (éœ€è¦è®¤è¯çš„æ¥å£)
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº”**ï¼š
```json
{
  "success": true,
  "message": "Operation successful",
  "data": { },
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "totalPages": 10
  }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "success": false,
  "message": "Error description",
  "error": "Detailed error message",
  "code": "ERROR_CODE"
}
```

---

### 2. æ–°é—»æ¨¡å— API

**è·¯ç”±æ–‡ä»¶**: `src/routes/news.ts`

#### a) åˆ›å»ºæ–°é—»
```
POST /api/news
POST /api/news/webhook  (n8n webhook)
```

**è¯·æ±‚ä½“**ï¼ˆå­—æ®µå¿…é¡»ä¸æ•°æ®åº“åŒ¹é…ï¼‰ï¼š
```json
{
  "title": "Honda Winner X 2024 ra máº¯t",
  "content": "<p>Ná»™i dung chi tiáº¿t...</p>",
  "summary": "TÃ³m táº¯t ngáº¯n",
  "category": "Xe mÃ¡y",
  "author_name": "Nguyá»…n VÄƒn A",
  "featured_image": "https://example.com/image.jpg",
  "status": "published"
}
```

**æ³¨æ„**ï¼šå­—æ®µåå¿…é¡»ä½¿ç”¨ï¼š
- `featured_image`ï¼ˆä¸æ˜¯ `cover_image`ï¼‰
- `author_name`ï¼ˆä¸æ˜¯ `author_id`ï¼‰
- `summary`ï¼ˆå¯é€‰ï¼‰

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "News created successfully",
  "data": {
    "id": 1,
    "title": "Honda Winner X 2024 ra máº¯t",
    "slug": "honda-winner-x-2024-ra-mat",
    "created_at": "2025-10-12T00:00:00.000Z"
  }
}
```

---

#### b) è·å–æ–°é—»åˆ—è¡¨
```
GET /api/news
```

**æŸ¥è¯¢å‚æ•°**ï¼š
```
page=1              # é¡µç ï¼ˆé»˜è®¤1ï¼‰
limit=10            # æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
category=Xe mÃ¡y     # åˆ†ç±»ç­›é€‰
status=published    # çŠ¶æ€ç­›é€‰
is_featured=true    # æ˜¯å¦ç²¾é€‰ï¼ˆæ³¨æ„ï¼šæ˜¯is_featuredï¼Œä¸æ˜¯featuredï¼‰
search=Honda        # æœç´¢å…³é”®è¯
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "Honda Winner X 2024 ra máº¯t",
      "slug": "honda-winner-x-2024-ra-mat",
      "summary": "TÃ³m táº¯t...",
      "featured_image": "https://...",
      "category": "Xe mÃ¡y",
      "view_count": 1250,
      "published_at": "2025-10-11T00:00:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 45,
    "totalPages": 5
  }
}
```

---

#### c) è·å–æ–°é—»è¯¦æƒ…
```
GET /api/news/:id              # é€šè¿‡IDè·å–
GET /api/news/slug/:slug       # é€šè¿‡slugè·å–
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "Honda Winner X 2024 ra máº¯t",
    "slug": "honda-winner-x-2024-ra-mat",
    "content": "<p>Ná»™i dung Ä‘áº§y Ä‘á»§...</p>",
    "summary": "TÃ³m táº¯t...",
    "featured_image": "https://...",
    "category": "Xe mÃ¡y",
    "author_name": "Nguyá»…n VÄƒn A",
    "view_count": 1251,
    "is_featured": false,
    "status": "published",
    "published_at": "2025-10-11T00:00:00.000Z",
    "created_at": "2025-10-11T00:00:00.000Z",
    "updated_at": "2025-10-12T00:00:00.000Z"
  }
}
```

---

#### d) è·å–æœ€æ–°æ–°é—»
```
GET /api/news/latest?limit=6
```

---

#### e) è·å–ç›¸å…³æ–°é—»
```
GET /api/news/slug/:slug/related?limit=4
```

---

#### f) è·å–æ‰€æœ‰åˆ†ç±»
```
GET /api/news/categories
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": [
    { "category": "Xe mÃ¡y", "count": 25 },
    { "category": "Ã” tÃ´", "count": 30 },
    { "category": "Tin tá»©c", "count": 15 }
  ]
}
```

---

#### g) æ›´æ–°æ–°é—»
```
PUT /api/news/:id
```

**è¯·æ±‚ä½“**: åŒåˆ›å»ºæ–°é—»ï¼ˆå­—æ®µå¯é€‰ï¼‰

---

#### h) åˆ é™¤æ–°é—»
```
DELETE /api/news/:id
```

---

### 3. è½¦è¾†æ¨¡å— API

**è·¯ç”±æ–‡ä»¶**: `src/routes/vehicles.ts`

#### a) è·å–æ‘©æ‰˜è½¦åˆ—è¡¨
```
GET /api/vehicles/motorcycles
```

**æŸ¥è¯¢å‚æ•°**ï¼š
```
page=1
limit=12
brand=Honda
category=Sport              # æ³¨æ„ï¼šä½¿ç”¨categoryï¼Œä¸æ˜¯type
fuel_type=Gasoline
min_price=50000000
max_price=100000000
year=2024
status=active
search=Winner
```

**æ³¨æ„**ï¼š
- ä½¿ç”¨ `category` å‚æ•°ï¼ˆä¸æ˜¯ `type`ï¼‰
- ä»·æ ¼ç­›é€‰ä½¿ç”¨ `min_price` å’Œ `max_price`
- æ‰€æœ‰å­—æ®µåå¿…é¡»ä¸æ•°æ®åº“å­—æ®µåŒ¹é…

---

#### b) è·å–æ‘©æ‰˜è½¦è¯¦æƒ…
```
GET /api/vehicles/motorcycles/:id
```

---

#### c) è·å–æ±½è½¦åˆ—è¡¨
```
GET /api/vehicles/cars
```

**æŸ¥è¯¢å‚æ•°**ï¼š
```
page=1
limit=12
brand=Toyota
type=Sedan | SUV | MPV
min_price=500000000
max_price=1000000000
seats=5 | 7
fuel_type=Petrol | Diesel | Electric | Hybrid
transmission=Manual | Automatic
drive=FWD | RWD | AWD
```

---

#### d) è·å–æ±½è½¦è¯¦æƒ…
```
GET /api/vehicles/cars/:id
```

---

#### e) è·å–å“ç‰Œåˆ—è¡¨
```
GET /api/vehicles/brands?type=motorcycle | car
```

---

### 4. é—®ç­”æ¨¡å— API

**è·¯ç”±æ–‡ä»¶**: `src/routes/qa.ts`

#### a) è·å–é—®é¢˜åˆ—è¡¨
```
GET /api/qa/questions
```

**æŸ¥è¯¢å‚æ•°**ï¼š
```
page=1
limit=20
status=open | answered | closed
tag=maintenance | buying-guide
sort=latest | most_answered | most_liked
```

---

#### b) è·å–é—®é¢˜è¯¦æƒ…
```
GET /api/qa/questions/:id
```

**å“åº”åŒ…å«**ï¼š
- é—®é¢˜è¯¦æƒ…
- æ‰€æœ‰å›ç­”ï¼ˆé‡‡çº³ç­”æ¡ˆç½®é¡¶ï¼‰
- å›ç­”ç»Ÿè®¡

---

#### c) å‘å¸ƒé—®é¢˜
```
POST /api/qa/questions
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "title": "Honda Winner X 2024 cÃ³ nÃªn nÃ¢ng cáº¥p phanh ABS khÃ´ng?",
  "content": "Chi tiáº¿t cÃ¢u há»i...",
  "tags": ["Honda", "Winner X", "ABS", "NÃ¢ng cáº¥p"]
}
```

---

#### d) å›ç­”é—®é¢˜
```
POST /api/qa/questions/:id/answers
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "content": "Ná»™i dung tráº£ lá»i..."
}
```

---

#### e) æŠ•ç¥¨ï¼ˆç‚¹èµ/ç‚¹è¸©ï¼‰
```
POST /api/qa/answers/:id/vote
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "vote_type": "up" | "down"
}
```

---

#### f) é‡‡çº³ç­”æ¡ˆ
```
POST /api/qa/answers/:id/accept
Authorization: Bearer <token>  (ä»…æé—®è€…)
```

---

### 5. äºŒæ‰‹äº¤æ˜“æ¨¡å— API

**è·¯ç”±æ–‡ä»¶**: `src/routes/marketplace.ts`

#### a) è·å–å•†å“åˆ—è¡¨
```
GET /api/marketplace/listings
```

**æŸ¥è¯¢å‚æ•°**ï¼š
```
page=1
limit=12
type=motorcycle | car
brand=Honda
min_price=10000000
max_price=50000000
year_from=2020
year_to=2024
max_mileage=10000
condition=excellent | good | fair
location=HÃ  Ná»™i | TP.HCM
sort=latest | price_asc | price_desc | mileage
```

---

#### b) è·å–å•†å“è¯¦æƒ…
```
GET /api/marketplace/listings/:id
```

---

#### c) å‘å¸ƒå•†å“
```
POST /api/marketplace/listings
Authorization: Bearer <token>
```

---

### 6. Sitemapæ¨¡å— API âœ¨ æ–°å¢

**è·¯ç”±æ–‡ä»¶**: `src/routes/sitemap.ts`

**è¯´æ˜**: Sitemapæ¨¡å—æ˜¯ä¸“é—¨ä¸ºSEOä¼˜åŒ–è®¾è®¡çš„APIç«¯ç‚¹ï¼Œä¸æ™®é€šAPIçš„ä¸»è¦åŒºåˆ«ï¼š
- **åªè¿”å›æ•°æ®åº“æ•°æ®**ï¼šä¸åŒ…å«ä»»ä½•å¤–éƒ¨APIæ•°æ®
- **åªè¿”å›æœ‰æ•ˆçŠ¶æ€**ï¼šä»…è¿”å›active/publishedçš„è®°å½•
- **ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½**ï¼šåªæŸ¥è¯¢å¿…è¦å­—æ®µï¼ˆid, slug, lastmodï¼‰
- **å›ºå®šæ•°é‡é™åˆ¶**ï¼šæ¯ä¸ªç«¯ç‚¹æœ€å¤šè¿”å›1000æ¡è®°å½•

#### a) è·å–æ‘©æ‰˜è½¦Sitemapæ•°æ®
```
GET /api/sitemap/motorcycles
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "lastmod": "2025-10-14T10:30:00.000Z"
    }
  ]
}
```

**å®ç°ä»£ç **ï¼š
```typescript
router.get('/motorcycles', asyncHandler(async (req: any, res: any) => {
  const motorcycles = await Motorcycle.findAll({
    where: { status: 'active' },
    attributes: ['id', 'updated_at', 'created_at'],
    limit: 1000,
  });

  res.json({
    success: true,
    data: motorcycles.map(m => ({
      id: m.id,
      lastmod: m.updated_at || m.created_at,
    })),
  });
}));
```

---

#### b) è·å–æ±½è½¦Sitemapæ•°æ®
```
GET /api/sitemap/cars
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "slug": "toyota-vios-2024",
      "lastmod": "2025-10-14T10:30:00.000Z"
    }
  ]
}
```

---

#### c) è·å–æµ‹è¯„Sitemapæ•°æ®
```
GET /api/sitemap/reviews
```

**æŸ¥è¯¢æ¡ä»¶**ï¼š
- `status = 'published'`
- `slug IS NOT NULL`ï¼ˆå¿…é¡»æœ‰slugæ‰èƒ½ç”ŸæˆURLï¼‰

---

#### d) è·å–äºŒæ‰‹å¸‚åœºSitemapæ•°æ®
```
GET /api/sitemap/marketplace
```

**é‡è¦è¯´æ˜**ï¼šæ­¤ç«¯ç‚¹ä¸ `/api/marketplace` çš„åŒºåˆ«ï¼š
- `/api/marketplace`ï¼šè¿”å›æ•°æ®åº“æ•°æ® + Chá»£ Tá»‘t APIå¤–éƒ¨æ•°æ®ï¼ˆç”¨äºå‰ç«¯å±•ç¤ºï¼‰
- `/api/sitemap/marketplace`ï¼š**åªè¿”å›æ•°æ®åº“æ•°æ®**ï¼ˆç”¨äºSEO sitemapï¼‰

**ä¸ºä»€ä¹ˆè¦åˆ†å¼€**ï¼š
- å¤–éƒ¨æ•°æ®ï¼ˆChá»£ Tá»‘tï¼‰çš„å•†å“åœ¨æˆ‘ä»¬ç½‘ç«™ä¸Šæ²¡æœ‰å¯¹åº”é¡µé¢
- å¦‚æœsitemapåŒ…å«è¿™äº›å¤–éƒ¨é“¾æ¥ï¼ŒGoogleä¼šæŠ“å–åˆ°404é”™è¯¯
- å½±å“ç½‘ç«™çš„SEOè¯„åˆ†å’Œç´¢å¼•è´¨é‡

---

#### Sitemap APIè®¾è®¡åŸåˆ™

1. **æ•°æ®æ¥æºçº¯å‡€**
   ```typescript
   // âœ… æ­£ç¡®ï¼šåªæŸ¥è¯¢æ•°æ®åº“
   const data = await Model.findAll({ where: { status: 'active' } });
   
   // âŒ é”™è¯¯ï¼šæ··åˆå¤–éƒ¨APIæ•°æ®
   const dbData = await Model.findAll();
   const externalData = await fetchFromExternalAPI();
   return [...dbData, ...externalData];
   ```

2. **æœ€å°åŒ–æŸ¥è¯¢å­—æ®µ**
   ```typescript
   // âœ… æ­£ç¡®ï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
   attributes: ['id', 'slug', 'updated_at', 'created_at']
   
   // âŒ é”™è¯¯ï¼šæŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆæµªè´¹èµ„æºï¼‰
   // ä¸æŒ‡å®šattributesä¼šæŸ¥è¯¢æ‰€æœ‰å­—æ®µ
   ```

3. **ä¸¥æ ¼çš„çŠ¶æ€è¿‡æ»¤**
   ```typescript
   // âœ… æ­£ç¡®ï¼šåªè¿”å›æœ‰æ•ˆæ•°æ®
   where: { 
     status: 'published',
     slug: { [Op.ne]: null }
   }
   
   // âŒ é”™è¯¯ï¼šè¿”å›æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬è‰ç¨¿ã€åˆ é™¤çš„ï¼‰
   where: {}
   ```

4. **åˆç†çš„æ•°é‡é™åˆ¶**
   ```typescript
   // âœ… æ­£ç¡®ï¼šé™åˆ¶æ•°é‡ï¼Œé˜²æ­¢è¿‡è½½
   limit: 1000
   
   // âŒ é”™è¯¯ï¼šæ— é™åˆ¶ï¼ˆå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼‰
   // ä¸è®¾ç½®limit
   ```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "title": "Honda Winner X 2023 zin 100%, cháº¡y 5000km",
  "description": "MÃ´ táº£ chi tiáº¿t...",
  "vehicle_type": "motorcycle",
  "brand": "Honda",
  "model": "Winner X",
  "year": 2023,
  "mileage": 5000,
  "price": 42000000,
  "condition": "excellent",
  "location": "HÃ  Ná»™i",
  "images": ["url1", "url2", "url3"],
  "tags": ["ChÃ­nh chá»§", "Bao test", "CÃ³ sáºµn"]
}
```

---

#### d) æ›´æ–°å•†å“
```
PUT /api/marketplace/listings/:id
Authorization: Bearer <token>  (ä»…æ‰€æœ‰è€…)
```

---

#### e) åˆ é™¤å•†å“
```
DELETE /api/marketplace/listings/:id
Authorization: Bearer <token>  (ä»…æ‰€æœ‰è€…)
```

---

### 6. ç”¨æˆ·è®¤è¯ API

**è·¯ç”±æ–‡ä»¶**: `src/routes/auth.ts`

#### a) ç”¨æˆ·æ³¨å†Œ
```
POST /api/auth/register
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "nguyenvana",
  "email": "nguyenvana@example.com",
  "password": "SecurePassword123!",
  "full_name": "Nguyá»…n VÄƒn A",
  "phone": "0912345678"
}
```

---

#### b) ç”¨æˆ·ç™»å½•
```
POST /api/auth/login
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "email": "nguyenvana@example.com",
  "password": "SecurePassword123!"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "uuid-123",
      "username": "nguyenvana",
      "email": "nguyenvana@example.com",
      "full_name": "Nguyá»…n VÄƒn A",
      "role": "user"
    }
  }
}
```

---

#### c) è·å–å½“å‰ç”¨æˆ·
```
GET /api/users/me
Authorization: Bearer <token>
```

---

#### d) åˆ·æ–°Token
```
POST /api/auth/refresh
Authorization: Bearer <refresh_token>
```

---

### 7. æ–‡ä»¶ä¸Šä¼  API

**è·¯ç”±æ–‡ä»¶**: `src/routes/upload.ts`

#### a) ä¸Šä¼ å•ä¸ªæ–‡ä»¶
```
POST /api/upload/single
Authorization: Bearer <token>
Content-Type: multipart/form-data
```

**è¡¨å•æ•°æ®**ï¼š
```
file: <binary file>
type: image | document | video
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "url": "/uploads/images/2025/10/filename.jpg",
    "filename": "filename.jpg",
    "size": 245678,
    "mimetype": "image/jpeg"
  }
}
```

---

#### b) ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
```
POST /api/upload/multiple
Authorization: Bearer <token>
Content-Type: multipart/form-data
```

**è¡¨å•æ•°æ®**ï¼š
```
files[]: <binary file 1>
files[]: <binary file 2>
files[]: <binary file 3>
```

---

## ğŸ“¦ æ•°æ®æ¨¡å‹

### 1. News Model (æ–°é—»æ¨¡å‹)

**æ–‡ä»¶**: `src/models/News.ts`

**å­—æ®µå®šä¹‰**ï¼ˆåŒ¹é…ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ï¼‰ï¼š
```typescript
interface NewsAttributes {
  id: number;                    // ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
  title: string;                 // æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰
  slug: string;                  // URLå‹å¥½æ ‡è¯†ï¼ˆå”¯ä¸€ï¼‰
  content: string;               // å†…å®¹ï¼ˆå¿…å¡«ï¼‰
  summary?: string;              // æ‘˜è¦
  excerpt?: string;              // ç®€çŸ­æ‘˜è¦ï¼ˆä»summaryæå–ï¼‰
  featured_image?: string;       // ç‰¹è‰²å›¾ç‰‡URL
  category?: string;             // åˆ†ç±»
  author_name?: string;          // ä½œè€…åç§°
  status: string;                // çŠ¶æ€ï¼ˆdraft/published/archivedï¼‰
  is_featured: boolean;          // æ˜¯å¦ç²¾é€‰ï¼ˆå¸ƒå°”å€¼ï¼‰
  view_count: number;            // æµè§ˆæ¬¡æ•°
  published_at?: Date;           // å‘å¸ƒæ—¶é—´
  created_at: Date;              // åˆ›å»ºæ—¶é—´
  updated_at: Date;              // æ›´æ–°æ—¶é—´
}
```

**éªŒè¯è§„åˆ™**ï¼š
- `title`: éç©º
- `slug`: å”¯ä¸€ï¼Œéç©º
- `content`: éç©º
- `is_featured`: å¸ƒå°”å€¼ï¼Œé»˜è®¤false
- `view_count`: æ•´æ•°ï¼Œé»˜è®¤0

**ç´¢å¼•**ï¼š
- PRIMARY KEY: `id`
- UNIQUE: `slug`
- INDEX: `category`, `status`, `is_featured`, `published_at`

**é‡è¦è¯´æ˜**ï¼š
- å­—æ®µåä½¿ç”¨ `is_featured`ï¼ˆä¸æ˜¯ `featured`ï¼‰
- å­—æ®µåä½¿ç”¨ `view_count`ï¼ˆä¸æ˜¯ `views`ï¼‰
- å­—æ®µåä½¿ç”¨ `featured_image`ï¼ˆä¸æ˜¯ `cover_image`ï¼‰
- å­—æ®µåä½¿ç”¨ `author_name`ï¼ˆä¸æ˜¯ `author_id`ï¼‰

---

### 2. Motorcycle Model (æ‘©æ‰˜è½¦æ¨¡å‹)

**æ–‡ä»¶**: `src/models/Motorcycle.ts`

**å­—æ®µå®šä¹‰**ï¼ˆåŒ¹é…ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ï¼Œå…±52ä¸ªå­—æ®µï¼‰ï¼š
```typescript
interface MotorcycleAttributes {
  id: number;                    // ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
  brand: string;                 // å“ç‰Œ
  model: string;                 // å‹å·
  year: number;                  // å¹´ä»½
  category: string;              // ç±»å‹åˆ†ç±»
  price_vnd: number;             // ä»·æ ¼ï¼ˆè¶Šå—ç›¾ï¼‰
  
  // å‘åŠ¨æœºç³»ç»Ÿ
  engine_cc?: number;            // æ’é‡(cc)
  engine_type?: string;          // å¼•æ“ç±»å‹
  power_hp?: number;             // æœ€å¤§åŠŸç‡(HP)
  power_rpm?: number;            // åŠŸç‡è½¬é€Ÿ
  torque_nm?: number;            // æœ€å¤§æ‰­çŸ©(Nm)
  torque_rpm?: number;           // æ‰­çŸ©è½¬é€Ÿ
  compression_ratio?: string;    // å‹ç¼©æ¯”
  bore_stroke?: string;          // ç¼¸å¾„Ã—è¡Œç¨‹
  valve_system?: string;         // é…æ°”æœºæ„
  
  // ä¼ åŠ¨ç³»ç»Ÿ
  transmission?: string;         // å˜é€Ÿç®±
  clutch_type?: string;          // ç¦»åˆå™¨ç±»å‹
  fuel_type?: string;            // ç‡ƒæ–™ç±»å‹
  fuel_supply?: string;          // ä¾›æ²¹æ–¹å¼
  starter?: string;              // å¯åŠ¨æ–¹å¼
  ignition?: string;             // ç‚¹ç«æ–¹å¼
  
  // ç”µåŠ¨è½¦å‚æ•°
  battery_kwh?: number;          // ç”µæ± å®¹é‡(kWh)
  range_km?: number;             // ç»­èˆªé‡Œç¨‹(km)
  charge_time_h?: number;        // å……ç”µæ—¶é—´(å°æ—¶)
  
  // åº•ç›˜ç³»ç»Ÿ
  frame_type?: string;           // è½¦æ¶ç±»å‹
  front_suspension?: string;     // å‰æ‚¬æŒ‚
  rear_suspension?: string;      // åæ‚¬æŒ‚
  front_brake?: string;          // å‰åˆ¶åŠ¨
  rear_brake?: string;           // ååˆ¶åŠ¨
  front_tire?: string;           // å‰è½®èƒ
  rear_tire?: string;            // åè½®èƒ
  
  // å°ºå¯¸é‡é‡
  dimensions_mm?: string;        // å°ºå¯¸(mm)
  wheelbase_mm?: number;         // è½´è·(mm)
  ground_clearance_mm?: number;  // ç¦»åœ°é—´éš™(mm)
  seat_height_mm?: number;       // åº§é«˜(mm)
  weight_kg?: number;            // æ•´è½¦é‡é‡(kg)
  fuel_capacity_l?: number;      // æ²¹ç®±å®¹é‡(L)
  
  // é…ç½®ä¿¡æ¯
  abs: boolean;                  // æ˜¯å¦æœ‰ABS
  smart_key: boolean;            // æ˜¯å¦æœ‰æ™ºèƒ½é’¥åŒ™
  display_type?: string;         // ä»ªè¡¨ç±»å‹
  lighting?: string;             // ç¯å…‰é…ç½®
  features?: string;             // ç‰¹è‰²åŠŸèƒ½
  
  // å…¶ä»–ä¿¡æ¯
  description?: string;          // æè¿°
  warranty?: string;             // è´¨ä¿
  fuel_consumption?: string;     // æ²¹è€—
  colors?: string;               // é¢œè‰²
  image_url?: string;            // å›¾ç‰‡URL
  rating?: number;               // è¯„åˆ†
  view_count: number;            // æµè§ˆæ¬¡æ•°
  status: string;                // çŠ¶æ€
  created_at: Date;              // åˆ›å»ºæ—¶é—´
  updated_at: Date;              // æ›´æ–°æ—¶é—´
}
```

**é‡è¦è¯´æ˜**ï¼š
- å­—æ®µåä½¿ç”¨ `category`ï¼ˆä¸æ˜¯ `type`ï¼‰
- å­—æ®µåä½¿ç”¨ `view_count`ï¼ˆä¸æ˜¯ `views`ï¼‰
- å­—æ®µåä½¿ç”¨ `price_vnd`ï¼ˆä¸æ˜¯ `price` æˆ– `official_price`ï¼‰
- åŒ…å« `abs` å’Œ `smart_key` å¸ƒå°”å­—æ®µ
- å‘åŠ¨æœºã€ä¼ åŠ¨ã€åº•ç›˜ç­‰ç³»ç»Ÿå­—æ®µé½å…¨
- æ€»å…±52ä¸ªå­—æ®µï¼Œæ¶µç›–æ‘©æ‰˜è½¦æ‰€æœ‰è¯¦ç»†å‚æ•°

---

### 3. User Model (ç”¨æˆ·æ¨¡å‹)

**å­—æ®µå®šä¹‰**ï¼š
```typescript
interface UserAttributes {
  id: string;                    // UUID
  username: string;              // ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
  email: string;                 // é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰
  password_hash: string;         // å¯†ç å“ˆå¸Œ
  full_name?: string;            // çœŸå®å§“å
  phone?: string;                // æ‰‹æœºå·
  avatar?: string;               // å¤´åƒURL
  bio?: string;                  // ä¸ªäººç®€ä»‹
  role: 'user' | 'moderator' | 'admin';  // è§’è‰²
  reputation_points: number;     // å£°æœ›ç§¯åˆ†
  verified: boolean;             // æ˜¯å¦è®¤è¯
  status: 'active' | 'suspended' | 'deleted';  // è´¦å·çŠ¶æ€
  last_login?: Date;             // æœ€åç™»å½•
  created_at: Date;
  updated_at: Date;
}
```

**å®‰å…¨æªæ–½**ï¼š
- å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†
- å¯†ç ä¸è¿”å›ç»™å®¢æˆ·ç«¯
- JWT token è®¤è¯

---

## ğŸ¯ æ§åˆ¶å™¨å±‚

### 1. NewsController

**æ–‡ä»¶**: `src/controllers/NewsController.ts`

**æ–¹æ³•åˆ—è¡¨**ï¼š

```typescript
class NewsController {
  // åˆ›å»ºæ–°é—»
  static async create(req: Request, res: Response): Promise<void>
  
  // è·å–æ–°é—»åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µã€ç­›é€‰ï¼‰
  static async getList(req: Request, res: Response): Promise<void>
  
  // é€šè¿‡slugè·å–æ–°é—»è¯¦æƒ…
  static async getBySlug(req: Request, res: Response): Promise<void>
  
  // é€šè¿‡IDè·å–æ–°é—»è¯¦æƒ…
  static async getById(req: Request, res: Response): Promise<void>
  
  // è·å–æœ€æ–°æ–°é—»
  static async getLatest(req: Request, res: Response): Promise<void>
  
  // è·å–ç›¸å…³æ–°é—»
  static async getRelated(req: Request, res: Response): Promise<void>
  
  // è·å–æ‰€æœ‰åˆ†ç±»
  static async getCategories(req: Request, res: Response): Promise<void>
  
  // æ›´æ–°æ–°é—»
  static async update(req: Request, res: Response): Promise<void>
  
  // åˆ é™¤æ–°é—»
  static async delete(req: Request, res: Response): Promise<void>
}
```

**å®ç°ç¤ºä¾‹**ï¼š
```typescript
static async create(req: Request, res: Response): Promise<void> {
  try {
    const { title, content, summary, category } = req.body;

    // éªŒè¯å¿…å¡«å­—æ®µ
    if (!title || !content) {
      res.status(400).json({
        success: false,
        message: 'Title and content are required',
      });
      return;
    }

    // è°ƒç”¨Serviceå±‚
    const news = await NewsService.createNews({
      title,
      content,
      summary,
      category,
    });

    res.status(201).json({
      success: true,
      message: 'News created successfully',
      data: news,
    });
  } catch (error: any) {
    console.error('åˆ›å»ºæ–°é—»å¤±è´¥:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to create news',
      error: error.message,
    });
  }
}
```

**èŒè´£**ï¼š
- è¯·æ±‚å‚æ•°éªŒè¯
- è°ƒç”¨Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
- å“åº”æ ¼å¼åŒ–
- é”™è¯¯å¤„ç†

---

## ğŸ§© æœåŠ¡å±‚

### 1. NewsService

**æ–‡ä»¶**: `src/services/NewsService.ts`

**æ–¹æ³•åˆ—è¡¨**ï¼š

```typescript
class NewsService {
  // åˆ›å»ºæ–°é—»
  static async createNews(data: NewsCreationData): Promise<News>
  
  // è·å–æ–°é—»åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µç­›é€‰ï¼‰
  static async getNewsList(options: NewsListOptions): Promise<NewsListResult>
  
  // é€šè¿‡slugè·å–æ–°é—»
  static async getNewsBySlug(slug: string): Promise<News | null>
  
  // å¢åŠ æµè§ˆæ¬¡æ•°
  static async incrementViewCount(newsId: number): Promise<void>
  
  // è·å–ç›¸å…³æ–°é—»
  static async getRelatedNews(newsId: number, limit: number): Promise<News[]>
  
  // ç”Ÿæˆslug
  static generateSlug(title: string): string
}
```

**ä¸šåŠ¡é€»è¾‘ç¤ºä¾‹**ï¼š
```typescript
static async createNews(data: NewsCreationData): Promise<News> {
  // ç”Ÿæˆslug
  const slug = this.generateSlug(data.title);
  
  // è‡ªåŠ¨æå–æ‘˜è¦ï¼ˆå¦‚æœæ²¡æœ‰æä¾›ï¼‰
  const excerpt = data.excerpt || this.extractExcerpt(data.content);
  
  // è®¾ç½®å‘å¸ƒæ—¶é—´
  const published_at = data.status === 'published' 
    ? new Date() 
    : null;
  
  // åˆ›å»ºæ–°é—»
  const news = await News.create({
    ...data,
    slug,
    excerpt,
    published_at,
    view_count: 0,
    is_featured: data.is_featured || false,
  });
  
  // æ¸…é™¤ç¼“å­˜
  await this.clearNewsCache();
  
  return news;
}

static generateSlug(title: string): string {
  return title
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')  // ç§»é™¤éŸ³è°ƒç¬¦å·
    .replace(/[^a-z0-9\s-]/g, '')
    .trim()
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-');
}
```

**èŒè´£**ï¼š
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- æ•°æ®éªŒè¯å’Œè½¬æ¢
- æ•°æ®åº“æ“ä½œ
- ç¼“å­˜ç®¡ç†
- å¤æ‚è®¡ç®—

---

## ğŸ›¡ï¸ ä¸­é—´ä»¶

### 1. é”™è¯¯å¤„ç†ä¸­é—´ä»¶

**æ–‡ä»¶**: `src/middleware/errorHandler.ts`

```typescript
// å¼‚æ­¥é”™è¯¯å¤„ç†åŒ…è£…å™¨
export const asyncHandler = (fn: Function) => {
  return (req: Request, res: Response, next: NextFunction) => {
    Promise.resolve(fn(req, res, next)).catch(next);
  };
};

// å…¨å±€é”™è¯¯å¤„ç†å™¨
export const errorHandler = (
  err: any,
  req: Request,
  res: Response,
  next: NextFunction
) => {
  console.error('Error:', err);

  const statusCode = err.statusCode || 500;
  const message = err.message || 'Internal Server Error';

  res.status(statusCode).json({
    success: false,
    message,
    error: process.env.NODE_ENV === 'development' ? err.stack : undefined,
  });
};
```

---

### 2. 404å¤„ç†ä¸­é—´ä»¶

**æ–‡ä»¶**: `src/middleware/notFound.ts`

```typescript
export const notFound = (req: Request, res: Response) => {
  res.status(404).json({
    success: false,
    message: `Route not found: ${req.method} ${req.originalUrl}`,
  });
};
```

---

### 3. è®¤è¯ä¸­é—´ä»¶

**æ–‡ä»¶**: `src/middleware/auth.ts`

```typescript
import jwt from 'jsonwebtoken';

export const authenticate = async (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');

    if (!token) {
      return res.status(401).json({
        success: false,
        message: 'No token provided',
      });
    }

    const decoded = jwt.verify(token, process.env.JWT_SECRET!);
    req.user = decoded;
    next();
  } catch (error) {
    res.status(401).json({
      success: false,
      message: 'Invalid token',
    });
  }
};

// è§’è‰²æ£€æŸ¥
export const authorize = (...roles: string[]) => {
  return (req: Request, res: Response, next: NextFunction) => {
    if (!req.user || !roles.includes(req.user.role)) {
      return res.status(403).json({
        success: false,
        message: 'Insufficient permissions',
      });
    }
    next();
  };
};
```

---

### 4. æ•°æ®éªŒè¯ä¸­é—´ä»¶

**æ–‡ä»¶**: `src/middleware/validator.ts`

ä½¿ç”¨ `express-validator`:

```typescript
import { validationResult } from 'express-validator';

export const validate = (req: Request, res: Response, next: NextFunction) => {
  const errors = validationResult(req);
  
  if (!errors.isEmpty()) {
    return res.status(400).json({
      success: false,
      message: 'Validation errors',
      errors: errors.array(),
    });
  }
  
  next();
};
```

---

## ğŸ”’ å®‰å…¨æªæ–½

### 1. Helmet å®‰å…¨å¤´
```typescript
app.use(helmet({
  crossOriginEmbedderPolicy: false,
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      scriptSrc: ["'self'"],
      imgSrc: ["'self'", "data:", "https:"],
    },
  },
}));
```

---

### 2. CORS é…ç½®

**âš ï¸ ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆåŸŸå+SSLï¼‰**ï¼š
```typescript
const allowedOrigins = [
  'http://localhost:4321',       // å¼€å‘ç¯å¢ƒ
  'https://vietmoto.top',        // ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰â­
  'http://47.237.79.9:4321',     // å¤‡ç”¨ï¼ˆå·²å¼ƒç”¨ï¼‰
  'http://127.0.0.1:4321'        // æœ¬åœ°æµ‹è¯•
];

app.use(cors({
  origin: (origin, callback) => {
    // å…è®¸æ— originçš„è¯·æ±‚ï¼ˆå¦‚æœåŠ¡ç«¯è°ƒç”¨ã€Postmanç­‰ï¼‰
    if (!origin) return callback(null, true);
    
    if (allowedOrigins.indexOf(origin) !== -1) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization'],
}));
```

**è¯´æ˜**ï¼š
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»åŒ…å« `https://vietmoto.top`
- ä¸å†éœ€è¦ `http://47.237.79.9:4321`ï¼ˆå‰ç«¯é€šè¿‡Nginxä»£ç†ï¼Œoriginæ˜¯åŸŸåï¼‰
- å‰ç«¯è¯·æ±‚originè‡ªåŠ¨ä¸º `https://vietmoto.top`

---

### 3. é€Ÿç‡é™åˆ¶
```typescript
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,  // 15åˆ†é’Ÿ
  max: 100,                  // æœ€å¤š100ä¸ªè¯·æ±‚
  message: {
    error: 'Too many requests, please try again later.',
  },
  standardHeaders: true,
  legacyHeaders: false,
});

app.use('/api/', limiter);
```

---

### 4. SQLæ³¨å…¥é˜²æŠ¤
- ä½¿ç”¨ Sequelize ORM
- å‚æ•°åŒ–æŸ¥è¯¢
- è¾“å…¥éªŒè¯å’Œæ¸…ç†

---

### 5. XSSé˜²æŠ¤
- è¾“å…¥æ¸…ç†
- Content-Security-Policyå¤´
- è¾“å‡ºè½¬ä¹‰

---

## ğŸ“ æ—¥å¿—ç³»ç»Ÿ

### 1. Morgan HTTPæ—¥å¿—
```typescript
app.use(morgan('combined'));
```

æ—¥å¿—æ ¼å¼ï¼š
```
::1 - - [12/Oct/2025:00:00:00 +0000] "GET /api/news HTTP/1.1" 200 1234 "-" "Mozilla/5.0..."
```

---

### 2. è‡ªå®šä¹‰æ—¥å¿—

**å»ºè®®ä½¿ç”¨ Winston**:

```typescript
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
  ],
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple(),
  }));
}

export default logger;
```

---

## ğŸ§ª æµ‹è¯•

### 1. å•å…ƒæµ‹è¯•

ä½¿ç”¨ Jest:

```typescript
// tests/services/NewsService.test.ts
import NewsService from '../../src/services/NewsService';

describe('NewsService', () => {
  describe('generateSlug', () => {
    it('åº”è¯¥æ­£ç¡®ç”Ÿæˆslug', () => {
      const slug = NewsService.generateSlug('Honda Winner X 2024 ra máº¯t');
      expect(slug).toBe('honda-winner-x-2024-ra-mat');
    });
  });

  describe('createNews', () => {
    it('åº”è¯¥æˆåŠŸåˆ›å»ºæ–°é—»', async () => {
      const newsData = {
        title: 'Test News',
        content: 'Test content',
      };
      
      const news = await NewsService.createNews(newsData);
      expect(news).toHaveProperty('id');
      expect(news.slug).toBe('test-news');
    });
  });
});
```

---

### 2. APIæµ‹è¯•

ä½¿ç”¨ Supertest:

```typescript
// tests/api/news.test.ts
import request from 'supertest';
import app from '../../src/index';

describe('News API', () => {
  describe('GET /api/news', () => {
    it('åº”è¯¥è¿”å›æ–°é—»åˆ—è¡¨', async () => {
      const response = await request(app)
        .get('/api/news')
        .expect('Content-Type', /json/)
        .expect(200);

      expect(response.body.success).toBe(true);
      expect(response.body.data).toBeInstanceOf(Array);
    });
  });

  describe('POST /api/news', () => {
    it('åº”è¯¥åˆ›å»ºæ–°é—»', async () => {
      const newsData = {
        title: 'Test News',
        content: 'Test content',
      };

      const response = await request(app)
        .post('/api/news')
        .send(newsData)
        .expect(201);

      expect(response.body.success).toBe(true);
      expect(response.body.data).toHaveProperty('id');
    });
  });
});
```

---

## ğŸš€ éƒ¨ç½²ä¸è¿ç»´

### 1. ç¼–è¯‘ TypeScript
```bash
npm run build
```

è¾“å‡ºç›®å½•: `dist/`

---

### 2. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```bash
# ä½¿ç”¨ Node.js
npm start

# ä½¿ç”¨ Systemdï¼ˆæ¨èï¼‰
sudo systemctl start vietnam-moto-backend
```

---

### 3. å¥åº·æ£€æŸ¥

**å¼€å‘ç¯å¢ƒ**ï¼š
```bash
curl http://localhost:4001/health
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆåŸŸå+SSLï¼‰**ï¼š
```bash
# é€šè¿‡åŸŸåè®¿é—®ï¼ˆæ¨èï¼‰
curl https://vietmoto.top/api/health

# ç›´æ¥è®¿é—®åç«¯ï¼ˆå†…ç½‘ï¼‰
curl http://localhost:4001/health
```

å“åº”:
```json
{
  "status": "OK",
  "timestamp": "2025-10-14T00:00:00.000Z",
  "uptime": 12345,
  "environment": "production"
}
```

**è¯´æ˜**ï¼š
- ç”Ÿäº§ç¯å¢ƒæ¨èé€šè¿‡åŸŸåè®¿é—®ï¼Œæµ‹è¯•å®Œæ•´çš„HTTPS + Nginxä»£ç†é“¾è·¯
- ç›´æ¥è®¿é—® `localhost:4001` åªæµ‹è¯•åç«¯æœåŠ¡æœ¬èº«

**âš ï¸ SSRç¯å¢ƒç‰¹åˆ«è¯´æ˜ï¼ˆ2025-10-14ï¼‰**ï¼š
- Astro SSRé¡µé¢åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ—¶ï¼Œå¿…é¡»ä½¿ç”¨å®Œæ•´URLï¼š`http://localhost:4001/api`
- æ— æ³•ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯æ²¡æœ‰åŸŸåä¸Šä¸‹æ–‡
- å®¢æˆ·ç«¯JavaScriptå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡Nginxä»£ç†

---

### 4. ç›‘æ§å’Œæ—¥å¿—
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status vietnam-moto-backend

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u vietnam-moto-backend -f

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/combined.log
```

---

## ğŸ“š å¼€å‘è§„èŒƒ

### 1. ä»£ç é£æ ¼
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- ESLint + Prettier
- é©¼å³°å‘½åæ³•ï¼ˆcamelCaseï¼‰
- æ¥å£ä½¿ç”¨ PascalCase

---

### 2. æäº¤è§„èŒƒ
```
feat: æ–°å¢åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
refactor: ä»£ç é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·é“¾
```

---

### 3. æ³¨é‡Šè§„èŒƒ
```typescript
/**
 * åˆ›å»ºæ–°é—»
 * @param data æ–°é—»æ•°æ®
 * @returns åˆ›å»ºçš„æ–°é—»å¯¹è±¡
 * @throws {ValidationError} éªŒè¯å¤±è´¥æ—¶æŠ›å‡º
 */
static async createNews(data: NewsCreationData): Promise<News> {
  // å®ç°ä»£ç 
}
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - é¡¹ç›®æ€»è§ˆ
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md](./æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md) - æ•°æ®åº“è¯¦ç»†è®¾è®¡
- [å‰ç«¯é¡µé¢è®¾è®¡å¼€å‘æ–‡æ¡£.md](./å‰ç«¯é¡µé¢è®¾è®¡å¼€å‘æ–‡æ¡£.md) - å‰ç«¯å¼€å‘æ–‡æ¡£
- [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–‡æ¡£.md](./ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–‡æ¡£.md) - éƒ¨ç½²è¯´æ˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰åç«¯å¼€å‘ç›¸å…³é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- Express.js æ–‡æ¡£: https://expressjs.com
- Sequelize æ–‡æ¡£: https://sequelize.org
- TypeScript æ–‡æ¡£: https://www.typescriptlang.org

---

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.2.0 (2025å¹´10æœˆ14æ—¥ ä¸‹åˆ)
**Sitemapæ¨¡å—æ–°å¢**
- âœ… æ–°å¢Sitemapä¸“ç”¨APIæ¨¡å—ï¼ˆ4ä¸ªç«¯ç‚¹ï¼‰
- âœ… æ·»åŠ sitemapè·¯ç”±æ–‡ä»¶è¯´æ˜
- âœ… å®Œå–„Sitemap APIè®¾è®¡åŸåˆ™
- âœ… åŒºåˆ†æ™®é€šAPIå’ŒSitemap APIçš„ç”¨é€”
- âœ… æ·»åŠ æ•°æ®æ¥æºçº¯å‡€æ€§ä¿è¯
- âœ… ä¼˜åŒ–SEO sitemapæ•°æ®è´¨é‡

### v2.1.0 (2025å¹´10æœˆ14æ—¥ ä¸‹åˆ)
**SSRç¯å¢ƒAPIè°ƒç”¨ä¿®å¤**
- âœ… æ·»åŠ SSRç¯å¢ƒç‰¹åˆ«è¯´æ˜
- âœ… åŒºåˆ†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯APIè°ƒç”¨æ–¹å¼
- âœ… ä¿®å¤è¯¦æƒ…é¡µSSRæ¸²æŸ“é—®é¢˜
- âœ… æ›´æ–°CORSé…ç½®ç¤ºä¾‹
- âœ… å®Œå–„å¥åº·æ£€æŸ¥è¯´æ˜

### v2.0.0 (2025å¹´10æœˆ14æ—¥ ä¸Šåˆ)
**ç”Ÿäº§ç¯å¢ƒï¼šåŸŸå+SSLéƒ¨ç½²æ›´æ–°**
- âœ… æ›´æ–°APIåŸºç¡€URLï¼šå¢åŠ åŸŸå+SSLé…ç½®è¯´æ˜
- âœ… æ›´æ–°ç¯å¢ƒå˜é‡ï¼šALLOWED_ORIGINS åŒ…å« `https://vietmoto.top`
- âœ… æ›´æ–°CORSé…ç½®ï¼šæ”¯æŒHTTPSåŸŸåè®¿é—®
- âœ… æ›´æ–°å¥åº·æ£€æŸ¥ï¼šæä¾›åŸŸåå’Œå†…ç½‘ä¸¤ç§æ–¹å¼
- âœ… æ·»åŠ å‰ç«¯APIè°ƒç”¨è§„èŒƒè¯´æ˜
- âœ… å¼ºè°ƒä¸è¦ç¡¬ç¼–ç HTTPåœ°å€å’Œä½¿ç”¨ç¯å¢ƒå˜é‡

### v1.0.0 (2025å¹´10æœˆ12æ—¥)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®Œæ•´çš„åç«¯APIæ–‡æ¡£
- æ•°æ®æ¨¡å‹å®šä¹‰
- ä¸­é—´ä»¶å’Œå®‰å…¨æªæ–½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.2.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ14æ—¥  
**ç»´æŠ¤è€…**: åç«¯å¼€å‘å›¢é˜Ÿ

